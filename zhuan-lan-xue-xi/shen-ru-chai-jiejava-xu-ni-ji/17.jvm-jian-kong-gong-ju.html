<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>17.JVM监控和工具 | zxk&#39;s book</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/books/Avatar.jpg">
    <meta name="description" content="兴趣使然的备忘库">
    <link rel="preload" href="/books/assets/css/0.styles.253527df.css" as="style"><link rel="preload" href="/books/assets/js/app.a32f3f13.js" as="script"><link rel="preload" href="/books/assets/js/2.f434c5a6.js" as="script"><link rel="preload" href="/books/assets/js/118.b518ee54.js" as="script"><link rel="prefetch" href="/books/assets/js/10.dceff922.js"><link rel="prefetch" href="/books/assets/js/100.e86d25aa.js"><link rel="prefetch" href="/books/assets/js/101.654d6902.js"><link rel="prefetch" href="/books/assets/js/102.6e048095.js"><link rel="prefetch" href="/books/assets/js/103.26ec951e.js"><link rel="prefetch" href="/books/assets/js/104.f413fdc7.js"><link rel="prefetch" href="/books/assets/js/105.0b5517ef.js"><link rel="prefetch" href="/books/assets/js/106.025ff37f.js"><link rel="prefetch" href="/books/assets/js/107.3fd4a2da.js"><link rel="prefetch" href="/books/assets/js/108.c33413cd.js"><link rel="prefetch" href="/books/assets/js/109.69c58c80.js"><link rel="prefetch" href="/books/assets/js/11.f4ff5e98.js"><link rel="prefetch" href="/books/assets/js/110.da669047.js"><link rel="prefetch" href="/books/assets/js/111.27221683.js"><link rel="prefetch" href="/books/assets/js/112.ae80afd9.js"><link rel="prefetch" href="/books/assets/js/113.d17c58d7.js"><link rel="prefetch" href="/books/assets/js/114.26c4f4c1.js"><link rel="prefetch" href="/books/assets/js/115.5491e5a0.js"><link rel="prefetch" href="/books/assets/js/116.a209ce38.js"><link rel="prefetch" href="/books/assets/js/117.c3a25178.js"><link rel="prefetch" href="/books/assets/js/119.e017c898.js"><link rel="prefetch" href="/books/assets/js/12.6dae06d9.js"><link rel="prefetch" href="/books/assets/js/120.1baf3023.js"><link rel="prefetch" href="/books/assets/js/121.71a13847.js"><link rel="prefetch" href="/books/assets/js/122.e058174e.js"><link rel="prefetch" href="/books/assets/js/123.5252e439.js"><link rel="prefetch" href="/books/assets/js/124.e919844e.js"><link rel="prefetch" href="/books/assets/js/125.b4b936d5.js"><link rel="prefetch" href="/books/assets/js/126.0ff2a40d.js"><link rel="prefetch" href="/books/assets/js/127.0e27fcc5.js"><link rel="prefetch" href="/books/assets/js/128.b0d65cea.js"><link rel="prefetch" href="/books/assets/js/129.3f7c4fb2.js"><link rel="prefetch" href="/books/assets/js/13.fd393096.js"><link rel="prefetch" href="/books/assets/js/130.22907055.js"><link rel="prefetch" href="/books/assets/js/131.9b6a7fa1.js"><link rel="prefetch" href="/books/assets/js/132.0141d721.js"><link rel="prefetch" href="/books/assets/js/133.62368e0f.js"><link rel="prefetch" href="/books/assets/js/134.c22be34f.js"><link rel="prefetch" href="/books/assets/js/135.9c30742f.js"><link rel="prefetch" href="/books/assets/js/136.8e29ebad.js"><link rel="prefetch" href="/books/assets/js/137.9bd0b5ba.js"><link rel="prefetch" href="/books/assets/js/138.41a78831.js"><link rel="prefetch" href="/books/assets/js/139.a9376eeb.js"><link rel="prefetch" href="/books/assets/js/14.208ec185.js"><link rel="prefetch" href="/books/assets/js/140.b4f63a2e.js"><link rel="prefetch" href="/books/assets/js/141.6a4888c7.js"><link rel="prefetch" href="/books/assets/js/142.d675963b.js"><link rel="prefetch" href="/books/assets/js/143.501abfa1.js"><link rel="prefetch" href="/books/assets/js/144.fdbc09d5.js"><link rel="prefetch" href="/books/assets/js/145.5bb6218a.js"><link rel="prefetch" href="/books/assets/js/146.b5ba45c3.js"><link rel="prefetch" href="/books/assets/js/147.e0a80eb4.js"><link rel="prefetch" href="/books/assets/js/148.27910016.js"><link rel="prefetch" href="/books/assets/js/149.013194c7.js"><link rel="prefetch" href="/books/assets/js/15.16c314bd.js"><link rel="prefetch" href="/books/assets/js/150.3154742d.js"><link rel="prefetch" href="/books/assets/js/151.78fc6a13.js"><link rel="prefetch" href="/books/assets/js/152.e97f9998.js"><link rel="prefetch" href="/books/assets/js/153.3d92ef79.js"><link rel="prefetch" href="/books/assets/js/154.70c9f7a4.js"><link rel="prefetch" href="/books/assets/js/155.4b924a86.js"><link rel="prefetch" href="/books/assets/js/156.59e71763.js"><link rel="prefetch" href="/books/assets/js/157.8c8cd5ed.js"><link rel="prefetch" href="/books/assets/js/158.739ecc99.js"><link rel="prefetch" href="/books/assets/js/159.5a22b675.js"><link rel="prefetch" href="/books/assets/js/16.d3259c7f.js"><link rel="prefetch" href="/books/assets/js/160.3cc481bb.js"><link rel="prefetch" href="/books/assets/js/161.5cdebd7a.js"><link rel="prefetch" href="/books/assets/js/162.d56ac8d7.js"><link rel="prefetch" href="/books/assets/js/163.a89f22d0.js"><link rel="prefetch" href="/books/assets/js/164.e5e25ddb.js"><link rel="prefetch" href="/books/assets/js/165.406cc447.js"><link rel="prefetch" href="/books/assets/js/166.0f09d541.js"><link rel="prefetch" href="/books/assets/js/167.afee8669.js"><link rel="prefetch" href="/books/assets/js/168.1ae1f6ce.js"><link rel="prefetch" href="/books/assets/js/169.1bfb929c.js"><link rel="prefetch" href="/books/assets/js/17.6ea641b2.js"><link rel="prefetch" href="/books/assets/js/170.0baab93a.js"><link rel="prefetch" href="/books/assets/js/171.65e2e3b6.js"><link rel="prefetch" href="/books/assets/js/172.9a0d4dfd.js"><link rel="prefetch" href="/books/assets/js/173.0690d3f4.js"><link rel="prefetch" href="/books/assets/js/174.52a3d4eb.js"><link rel="prefetch" href="/books/assets/js/175.33e4696f.js"><link rel="prefetch" href="/books/assets/js/176.6c865e6e.js"><link rel="prefetch" href="/books/assets/js/177.1b2a7c93.js"><link rel="prefetch" href="/books/assets/js/178.37c33f6b.js"><link rel="prefetch" href="/books/assets/js/179.ef76c85c.js"><link rel="prefetch" href="/books/assets/js/18.d3146ce7.js"><link rel="prefetch" href="/books/assets/js/180.0e457253.js"><link rel="prefetch" href="/books/assets/js/181.dee67b63.js"><link rel="prefetch" href="/books/assets/js/182.069a8f30.js"><link rel="prefetch" href="/books/assets/js/183.0330f5ce.js"><link rel="prefetch" href="/books/assets/js/184.efd2fde2.js"><link rel="prefetch" href="/books/assets/js/185.7d64b540.js"><link rel="prefetch" href="/books/assets/js/186.82e60409.js"><link rel="prefetch" href="/books/assets/js/187.0d54afe4.js"><link rel="prefetch" href="/books/assets/js/188.81a9510a.js"><link rel="prefetch" href="/books/assets/js/189.279c7f6f.js"><link rel="prefetch" href="/books/assets/js/19.ef650392.js"><link rel="prefetch" href="/books/assets/js/190.e5a7480c.js"><link rel="prefetch" href="/books/assets/js/191.f365d8de.js"><link rel="prefetch" href="/books/assets/js/192.84ea0f67.js"><link rel="prefetch" href="/books/assets/js/193.bb2e01d9.js"><link rel="prefetch" href="/books/assets/js/194.ef6b690e.js"><link rel="prefetch" href="/books/assets/js/195.1ee66346.js"><link rel="prefetch" href="/books/assets/js/196.f34cbe99.js"><link rel="prefetch" href="/books/assets/js/197.cbbdab75.js"><link rel="prefetch" href="/books/assets/js/198.845810f3.js"><link rel="prefetch" href="/books/assets/js/199.5e1147de.js"><link rel="prefetch" href="/books/assets/js/20.21272222.js"><link rel="prefetch" href="/books/assets/js/200.57f5e124.js"><link rel="prefetch" href="/books/assets/js/201.a572c554.js"><link rel="prefetch" href="/books/assets/js/202.5ce9f4a7.js"><link rel="prefetch" href="/books/assets/js/203.bc6f8876.js"><link rel="prefetch" href="/books/assets/js/204.126953e5.js"><link rel="prefetch" href="/books/assets/js/205.9aeca759.js"><link rel="prefetch" href="/books/assets/js/206.ec099168.js"><link rel="prefetch" href="/books/assets/js/207.6e5b496b.js"><link rel="prefetch" href="/books/assets/js/208.6624d24c.js"><link rel="prefetch" href="/books/assets/js/209.3d8ff15b.js"><link rel="prefetch" href="/books/assets/js/21.a956aa7a.js"><link rel="prefetch" href="/books/assets/js/210.6429663d.js"><link rel="prefetch" href="/books/assets/js/211.1d8725a1.js"><link rel="prefetch" href="/books/assets/js/212.d1ff2873.js"><link rel="prefetch" href="/books/assets/js/213.e213f9d1.js"><link rel="prefetch" href="/books/assets/js/214.a9b5c7ec.js"><link rel="prefetch" href="/books/assets/js/215.fd7a5238.js"><link rel="prefetch" href="/books/assets/js/216.96394ddb.js"><link rel="prefetch" href="/books/assets/js/217.3f41d192.js"><link rel="prefetch" href="/books/assets/js/218.622af412.js"><link rel="prefetch" href="/books/assets/js/219.772992ff.js"><link rel="prefetch" href="/books/assets/js/22.fb2ff9d3.js"><link rel="prefetch" href="/books/assets/js/220.99efbde4.js"><link rel="prefetch" href="/books/assets/js/221.9932f6ce.js"><link rel="prefetch" href="/books/assets/js/222.e9c2624f.js"><link rel="prefetch" href="/books/assets/js/223.c87d79a7.js"><link rel="prefetch" href="/books/assets/js/224.6fc0bed5.js"><link rel="prefetch" href="/books/assets/js/225.443418f3.js"><link rel="prefetch" href="/books/assets/js/226.d0e9e921.js"><link rel="prefetch" href="/books/assets/js/227.b29a9627.js"><link rel="prefetch" href="/books/assets/js/228.6b9c5eb3.js"><link rel="prefetch" href="/books/assets/js/229.a2dee41e.js"><link rel="prefetch" href="/books/assets/js/23.77b92b70.js"><link rel="prefetch" href="/books/assets/js/230.b36a47b9.js"><link rel="prefetch" href="/books/assets/js/231.d7a52023.js"><link rel="prefetch" href="/books/assets/js/232.5c445a90.js"><link rel="prefetch" href="/books/assets/js/233.398e8141.js"><link rel="prefetch" href="/books/assets/js/234.86f5ff7b.js"><link rel="prefetch" href="/books/assets/js/235.d8271e43.js"><link rel="prefetch" href="/books/assets/js/236.41b92eb4.js"><link rel="prefetch" href="/books/assets/js/237.4d52bf88.js"><link rel="prefetch" href="/books/assets/js/238.209dd5d8.js"><link rel="prefetch" href="/books/assets/js/239.a977d564.js"><link rel="prefetch" href="/books/assets/js/24.96161161.js"><link rel="prefetch" href="/books/assets/js/240.56008448.js"><link rel="prefetch" href="/books/assets/js/241.95144dec.js"><link rel="prefetch" href="/books/assets/js/242.deacfcf7.js"><link rel="prefetch" href="/books/assets/js/243.6bd3a203.js"><link rel="prefetch" href="/books/assets/js/244.20662085.js"><link rel="prefetch" href="/books/assets/js/245.3079d8db.js"><link rel="prefetch" href="/books/assets/js/246.59cbb76d.js"><link rel="prefetch" href="/books/assets/js/247.dab4d54b.js"><link rel="prefetch" href="/books/assets/js/248.dd78e28c.js"><link rel="prefetch" href="/books/assets/js/249.47cfb0fb.js"><link rel="prefetch" href="/books/assets/js/25.bb622e2d.js"><link rel="prefetch" href="/books/assets/js/250.8b7c06de.js"><link rel="prefetch" href="/books/assets/js/251.90d4bb83.js"><link rel="prefetch" href="/books/assets/js/252.4b70df27.js"><link rel="prefetch" href="/books/assets/js/253.baa34cc9.js"><link rel="prefetch" href="/books/assets/js/254.64c84394.js"><link rel="prefetch" href="/books/assets/js/255.4245dca1.js"><link rel="prefetch" href="/books/assets/js/256.4bd25081.js"><link rel="prefetch" href="/books/assets/js/257.44a180fd.js"><link rel="prefetch" href="/books/assets/js/258.ef8eb1df.js"><link rel="prefetch" href="/books/assets/js/259.ca38bbda.js"><link rel="prefetch" href="/books/assets/js/26.800c4d14.js"><link rel="prefetch" href="/books/assets/js/260.fc42b0a6.js"><link rel="prefetch" href="/books/assets/js/27.be0559b4.js"><link rel="prefetch" href="/books/assets/js/28.cdb01ee8.js"><link rel="prefetch" href="/books/assets/js/29.27c415ce.js"><link rel="prefetch" href="/books/assets/js/3.7dd1ae11.js"><link rel="prefetch" href="/books/assets/js/30.da6f6371.js"><link rel="prefetch" href="/books/assets/js/31.c824c17b.js"><link rel="prefetch" href="/books/assets/js/32.45c04f7c.js"><link rel="prefetch" href="/books/assets/js/33.315cf7d5.js"><link rel="prefetch" href="/books/assets/js/34.b532da2f.js"><link rel="prefetch" href="/books/assets/js/35.0af657d1.js"><link rel="prefetch" href="/books/assets/js/36.2df4655c.js"><link rel="prefetch" href="/books/assets/js/37.a4887720.js"><link rel="prefetch" href="/books/assets/js/38.68a08b9d.js"><link rel="prefetch" href="/books/assets/js/39.bf63d04a.js"><link rel="prefetch" href="/books/assets/js/4.e8102eb5.js"><link rel="prefetch" href="/books/assets/js/40.a3c5cdd1.js"><link rel="prefetch" href="/books/assets/js/41.116ef3fc.js"><link rel="prefetch" href="/books/assets/js/42.f3b8b588.js"><link rel="prefetch" href="/books/assets/js/43.b1d59c70.js"><link rel="prefetch" href="/books/assets/js/44.579ee856.js"><link rel="prefetch" href="/books/assets/js/45.807bba31.js"><link rel="prefetch" href="/books/assets/js/46.db611eda.js"><link rel="prefetch" href="/books/assets/js/47.d4d02273.js"><link rel="prefetch" href="/books/assets/js/48.7f011fb9.js"><link rel="prefetch" href="/books/assets/js/49.3aac265b.js"><link rel="prefetch" href="/books/assets/js/5.638928ae.js"><link rel="prefetch" href="/books/assets/js/50.8b75be66.js"><link rel="prefetch" href="/books/assets/js/51.576e782b.js"><link rel="prefetch" href="/books/assets/js/52.85987e06.js"><link rel="prefetch" href="/books/assets/js/53.6a8c240c.js"><link rel="prefetch" href="/books/assets/js/54.6a97379c.js"><link rel="prefetch" href="/books/assets/js/55.97955477.js"><link rel="prefetch" href="/books/assets/js/56.3d477c83.js"><link rel="prefetch" href="/books/assets/js/57.56aa4dff.js"><link rel="prefetch" href="/books/assets/js/58.833c8652.js"><link rel="prefetch" href="/books/assets/js/59.24ca7ee9.js"><link rel="prefetch" href="/books/assets/js/6.32ee54fa.js"><link rel="prefetch" href="/books/assets/js/60.1fc1c4a2.js"><link rel="prefetch" href="/books/assets/js/61.14b84590.js"><link rel="prefetch" href="/books/assets/js/62.8a2d2de8.js"><link rel="prefetch" href="/books/assets/js/63.0dcfee0b.js"><link rel="prefetch" href="/books/assets/js/64.8c28a59c.js"><link rel="prefetch" href="/books/assets/js/65.6d1ae46c.js"><link rel="prefetch" href="/books/assets/js/66.5a616c98.js"><link rel="prefetch" href="/books/assets/js/67.bead4bdc.js"><link rel="prefetch" href="/books/assets/js/68.1d20f97a.js"><link rel="prefetch" href="/books/assets/js/69.76ec2223.js"><link rel="prefetch" href="/books/assets/js/7.b59836f2.js"><link rel="prefetch" href="/books/assets/js/70.6066afd2.js"><link rel="prefetch" href="/books/assets/js/71.d25994bf.js"><link rel="prefetch" href="/books/assets/js/72.94ab8cdd.js"><link rel="prefetch" href="/books/assets/js/73.6682438b.js"><link rel="prefetch" href="/books/assets/js/74.d8d9aac9.js"><link rel="prefetch" href="/books/assets/js/75.c178891f.js"><link rel="prefetch" href="/books/assets/js/76.2292d907.js"><link rel="prefetch" href="/books/assets/js/77.940c9473.js"><link rel="prefetch" href="/books/assets/js/78.1e9432ad.js"><link rel="prefetch" href="/books/assets/js/79.f548c8c7.js"><link rel="prefetch" href="/books/assets/js/8.c9e4b615.js"><link rel="prefetch" href="/books/assets/js/80.e03d9a9c.js"><link rel="prefetch" href="/books/assets/js/81.222e5797.js"><link rel="prefetch" href="/books/assets/js/82.bea6ed3c.js"><link rel="prefetch" href="/books/assets/js/83.cb05beb1.js"><link rel="prefetch" href="/books/assets/js/84.6e31c3ad.js"><link rel="prefetch" href="/books/assets/js/85.b0ce07ff.js"><link rel="prefetch" href="/books/assets/js/86.ae6fb79f.js"><link rel="prefetch" href="/books/assets/js/87.6863b804.js"><link rel="prefetch" href="/books/assets/js/88.ba149380.js"><link rel="prefetch" href="/books/assets/js/89.343c2068.js"><link rel="prefetch" href="/books/assets/js/9.61e3915f.js"><link rel="prefetch" href="/books/assets/js/90.8f71cab6.js"><link rel="prefetch" href="/books/assets/js/91.6334c0db.js"><link rel="prefetch" href="/books/assets/js/92.8a7e8c1d.js"><link rel="prefetch" href="/books/assets/js/93.bd68832a.js"><link rel="prefetch" href="/books/assets/js/94.4083af3f.js"><link rel="prefetch" href="/books/assets/js/95.775d1cde.js"><link rel="prefetch" href="/books/assets/js/96.e244a8c4.js"><link rel="prefetch" href="/books/assets/js/97.27aa8f2b.js"><link rel="prefetch" href="/books/assets/js/98.9d03fea6.js"><link rel="prefetch" href="/books/assets/js/99.488c24e9.js">
    <link rel="stylesheet" href="/books/assets/css/0.styles.253527df.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/books/" class="router-link-active home-link"><img src="/books/Avatar.jpg" alt="zxk's book" class="logo"> <span class="site-name">zxk's book</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          大数据
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          编程语言
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          编程基础
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          专栏学习
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>
          Linux
        </span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/books/ruan-jian/">
          软件
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/books/" class="router-link-active">
          Home
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/Rianico/books" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>深入拆解Java虚拟机</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/" aria-current="page" title="介绍" class="sidebar-link">介绍</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/01.-lei-de-jia-zai.html" title="/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/01.-lei-de-jia-zai.html" class="sidebar-link">/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/01.-lei-de-jia-zai.html</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/02.-fang-fa-diao-yong.html" title="/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/02.-fang-fa-diao-yong.html" class="sidebar-link">/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/02.-fang-fa-diao-yong.html</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/03.-yi-chang-chu-li.html" title="03.异常处理" class="sidebar-link">03.异常处理</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/04.-fan-she.html" title="04.反射" class="sidebar-link">04.反射</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/05.java-dui-xiang-de-nei-cun-bu-ju.html" title="05.Java对象的内存布局" class="sidebar-link">05.Java对象的内存布局</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/06.gc-xiang-guan.html" title="06.GC相关" class="sidebar-link">06.GC相关</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/07.java-nei-cun-mo-xing.html" title="07.Java内存模型" class="sidebar-link">07.Java内存模型</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/07.-xiang-guan-gong-ju.html" title="07.相关工具" class="sidebar-link">07.相关工具</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/08.-ji-shi-bian-yi.html" title="08.即时编译" class="sidebar-link">08.即时编译</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/09.java-zi-jie-ma.html" title="09.Java字节码" class="sidebar-link">09.Java字节码</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/10.-fang-fa-nei-lian.html" title="10.方法内联" class="sidebar-link">10.方法内联</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/11.hotspot-deintrinsic.html" title="11.HotSpot的intrinsic" class="sidebar-link">11.HotSpot的intrinsic</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/12.-tao-yi-fen-xi.html" title="12.逃逸分析" class="sidebar-link">12.逃逸分析</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/13.-zi-duan-fang-wen-you-hua-yu-si-dai-ma-xiao-chu.html" title="13.字段访问优化与死代码消除" class="sidebar-link">13.字段访问优化与死代码消除</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/14.-xun-huan-you-hua.html" title="14.循环优化" class="sidebar-link">14.循环优化</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/15.-xiang-liang-hua-yusimd.html" title="15.向量化与SIMD" class="sidebar-link">15.向量化与SIMD</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/16.jmh-ji-zhun-ce-shi.html" title="16.JMH基准测试" class="sidebar-link">16.JMH基准测试</a></li><li><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html" aria-current="page" title="17.JVM监控和工具" class="active sidebar-link">17.JVM监控和工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html#_1-jps" title="1. jps" class="sidebar-link">1. jps</a></li><li class="sidebar-sub-header"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html#_2-jstat" title="2. jstat" class="sidebar-link">2. jstat</a></li><li class="sidebar-sub-header"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html#_3-jmap" title="3. jmap" class="sidebar-link">3. jmap</a></li><li class="sidebar-sub-header"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html#_4-jstack" title="4. jstack" class="sidebar-link">4. jstack</a></li><li class="sidebar-sub-header"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html#_5-jinfo" title="5. jinfo" class="sidebar-link">5. jinfo</a></li><li class="sidebar-sub-header"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html#_6-jcmd（瑞士军刀）" title="6. jcmd（瑞士军刀）" class="sidebar-link">6. jcmd（瑞士军刀）</a></li><li class="sidebar-sub-header"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/17.jvm-jian-kong-gong-ju.html#_7-jmc-与-jfr" title="7. JMC 与 JFR" class="sidebar-link">7. JMC 与 JFR</a></li></ul></li></ul></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h2 id="_1-jps"><a href="#_1-jps" class="header-anchor">#</a> 1. jps</h2> <p><a href="https://docs.oracle.com/en/java/javase/11/tools/jps.html#GUID-6EB65B96-F9DD-4356-B825-6146E9EEC81E" target="_blank" rel="noopener noreferrer">jps<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：打印所有正在运行的 Java 进程的相关信息。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ jps -mlv
<span class="token number">18331</span> org.example.Foo Hello World
<span class="token number">18332</span> jdk.jcmd/sun.tools.jps.Jps -mlv -Dapplication.home<span class="token operator">=</span>/Library/Java/JavaVirtualMachines/jdk-11.jdk/Contents/Home -Xms8m -Djdk.module.main<span class="token operator">=</span>jdk.jcmd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>-q：输出本地 JVM 进程的 class name, JAR file name 以及传递给 main 方法的参数。</li> <li>-m：打印传递给 main 方法的参数。</li> <li>-l：打印 main 方法完整的包名，或者 JAR  的完整路径。</li> <li>-v：打印传递给 JVM 的参数。</li> <li>-V：同 -q。</li></ul> <p>jps 还可以查看远端机器上的 Java 进程：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>jps -l remote.domain
<span class="token number">3002</span> /opt/jdk1.7.0/demo/jfc/Java2D/Java2Demo.JAR
<span class="token number">2857</span> sun.tools.jstatd.jstatd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果 JVM 关闭了默认开启的 <code>UserPerData</code> （-XX:-UsePerfData），则 jps 将无法探测到该 JVM。</p> <h2 id="_2-jstat"><a href="#_2-jstat" class="header-anchor">#</a> 2. jstat</h2> <p><a href="https://docs.oracle.com/en/java/javase/11/tools/jstat.html#GUID-5F72A7F9-5D5A-4486-8201-E1D1BA8ACCB5" target="_blank" rel="noopener noreferrer">jstat<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：打印目标 Java 进程的性能数据。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>jstat outputOptions <span class="token punctuation">[</span>-t<span class="token punctuation">]</span> <span class="token punctuation">[</span>-h lines<span class="token punctuation">]</span> vmid <span class="token punctuation">[</span>interval <span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>-t：在首列打印出目标 Java 进程的启动时间，单位为 s</li> <li>-h：每过 n 行打印一次 header，默认为 0，仅在首行打印一次</li></ul> <p>其中的 outputOptions 如下：</p> <ul><li>-class：打印类加载器的行为统计信息。</li> <li>-compiler：打印 JIT 编译器的行为统计信息。</li> <li>-gc</li> <li>-gccapacity</li> <li>-gccause</li> <li>-gcmetacapacity</li> <li>-gcnew</li> <li>-gcnewcapacity</li> <li>-gcold</li> <li>-gcoldcapacity</li> <li>-gcutil</li> <li>-printcompilation：打印 JVM 编译方法的统计信息。</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># Usage: jstat -outputOptions [-t] [-hlines] VMID [interval [count]]</span>
$ jstat -gc <span class="token number">22126</span> 1s <span class="token number">4</span>
S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT   
<span class="token number">17472,0</span> <span class="token number">17472,0</span>  <span class="token number">0,0</span>    <span class="token number">0,0</span>   <span class="token number">139904,0</span> <span class="token number">47146,4</span>   <span class="token number">349568,0</span>   <span class="token number">21321,0</span>   <span class="token number">30020,0</span> <span class="token number">28001,8</span> <span class="token number">4864,0</span> <span class="token number">4673,4</span>     <span class="token number">22</span>    <span class="token number">0,080</span>   <span class="token number">3</span>      <span class="token number">0,270</span>   <span class="token number">0</span>      <span class="token number">0,000</span>    <span class="token number">0,350</span>
<span class="token number">17472,0</span> <span class="token number">17472,0</span> <span class="token number">420,6</span>   <span class="token number">0,0</span>   <span class="token number">139904,0</span> <span class="token number">11178,4</span>   <span class="token number">349568,0</span>   <span class="token number">21321,0</span>   <span class="token number">30020,0</span> <span class="token number">28090,1</span> <span class="token number">4864,0</span> <span class="token number">4674,2</span>     <span class="token number">28</span>    <span class="token number">0,084</span>   <span class="token number">3</span>      <span class="token number">0,270</span>   <span class="token number">0</span>      <span class="token number">0,000</span>    <span class="token number">0,354</span>
<span class="token number">17472,0</span> <span class="token number">17472,0</span>  <span class="token number">0,0</span>   <span class="token number">403,9</span>  <span class="token number">139904,0</span> <span class="token number">139538,4</span>  <span class="token number">349568,0</span>   <span class="token number">21323,4</span>   <span class="token number">30020,0</span> <span class="token number">28137,2</span> <span class="token number">4864,0</span> <span class="token number">4674,2</span>     <span class="token number">34</span>    <span class="token number">0,088</span>   <span class="token number">4</span>      <span class="token number">0,359</span>   <span class="token number">0</span>      <span class="token number">0,000</span>    <span class="token number">0,446</span>
<span class="token number">17472,0</span> <span class="token number">17472,0</span>  <span class="token number">0,0</span>    <span class="token number">0,0</span>   <span class="token number">139904,0</span>   <span class="token number">0,0</span>     <span class="token number">349568,0</span>   <span class="token number">21326,1</span>   <span class="token number">30020,0</span> <span class="token number">28093,6</span> <span class="token number">4864,0</span> <span class="token number">4673,4</span>     <span class="token number">38</span>    <span class="token number">0,091</span>   <span class="token number">5</span>      <span class="token number">0,445</span>   <span class="token number">0</span>      <span class="token number">0,000</span>    <span class="token number">0,536</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>jstat 还可以用于判断是否出现了内存泄漏，每隔一段时间，通过 jstat 获取 OU 的情况，取其最小值，如果这些值随着时间呈上涨趋势，那么意味着无法回收的对象在不断增加，因此很可能出现了内存泄漏。</p> <p>使用 G1 GC 时，jstat 的输出会存在一些特征：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ jstat -gc <span class="token number">22208</span> 1s
S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT   
<span class="token number">0.0</span>   <span class="token number">16384.0</span>  <span class="token number">0.0</span>   <span class="token number">16384.0</span> <span class="token number">210944.0</span> <span class="token number">192512.0</span>  <span class="token number">133120.0</span>    <span class="token number">5332.5</span>   <span class="token number">28848.0</span> <span class="token number">26886.4</span> <span class="token number">4864.0</span> <span class="token number">4620.5</span>     <span class="token number">19</span>    <span class="token number">0.067</span>   <span class="token number">1</span>      <span class="token number">0.016</span>   <span class="token number">2</span>      <span class="token number">0.002</span>    <span class="token number">0.084</span>
<span class="token number">0.0</span>   <span class="token number">16384.0</span>  <span class="token number">0.0</span>   <span class="token number">16384.0</span> <span class="token number">210944.0</span> <span class="token number">83968.0</span>   <span class="token number">133120.0</span>    <span class="token number">5749.9</span>   <span class="token number">29104.0</span> <span class="token number">27132.8</span> <span class="token number">4864.0</span> <span class="token number">4621.0</span>     <span class="token number">21</span>    <span class="token number">0.078</span>   <span class="token number">1</span>      <span class="token number">0.016</span>   <span class="token number">2</span>      <span class="token number">0.002</span>    <span class="token number">0.095</span>
<span class="token number">0.0</span>    <span class="token number">0.0</span>    <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">71680.0</span>  <span class="token number">18432.0</span>   <span class="token number">45056.0</span>    <span class="token number">20285.1</span>   <span class="token number">29872.0</span> <span class="token number">27952.4</span> <span class="token number">4864.0</span> <span class="token number">4671.6</span>     <span class="token number">23</span>    <span class="token number">0.089</span>   <span class="token number">2</span>      <span class="token number">0.063</span>   <span class="token number">2</span>      <span class="token number">0.002</span>    <span class="token number">0.153</span>
<span class="token number">0.0</span>   <span class="token number">2048.0</span>  <span class="token number">0.0</span>   <span class="token number">2048.0</span> <span class="token number">69632.0</span>  <span class="token number">28672.0</span>   <span class="token number">45056.0</span>    <span class="token number">18608.1</span>   <span class="token number">30128.0</span> <span class="token number">28030.4</span> <span class="token number">4864.0</span> <span class="token number">4672.4</span>     <span class="token number">32</span>    <span class="token number">0.093</span>   <span class="token number">2</span>      <span class="token number">0.063</span>   <span class="token number">2</span>      <span class="token number">0.002</span>    <span class="token number">0.158</span>
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可以看到 S0C、S0U 始终为 0 ，而 S1C、S10 有时会变为 0。</p> <ul><li>S0 区域：由于 G1 中不再设置 Eden、Survivor、Old 区的内存边界，而是将对划分为若干个等长内存区域，因此也就没有以前 GC 算法中 FROM、TO 之间的划分了。</li> <li>S1 区域：G1 GC 时，可能会出现 Survivor 区内的所有对象都被回收或者晋升的对象，此时内存中完全没有 Survivor 区域。</li> <li>CGC &amp; CGCT：分别代表并发 GC Stop-The-World 的次数和时间。</li></ul> <h2 id="_3-jmap"><a href="#_3-jmap" class="header-anchor">#</a> 3. jmap</h2> <p><a href="https://docs.oracle.com/en/java/javase/11/tools/jmap.html#GUID-D2340719-82BA-4077-B0F3-2803269B7F41" target="_blank" rel="noopener noreferrer">jmap<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：可以用于分析 Java 虚拟机堆中的对象。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>jmap <span class="token punctuation">[</span>options<span class="token punctuation">]</span> pid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>options 如下：</p> <ul><li>-clstats，该子命令将打印被加载类的信息。</li> <li>-finalizerinfo，该子命令将打印所有待 finalize 的对象。</li> <li>-histo，该子命令将统计各个类的实例数目以及占用内存，并按照内存使用量从多至少的顺序排列。此外，-histo:live 只统计堆中的存活对象。</li> <li>-dump，该子命令将导出 Java 虚拟机堆的快照。同样，-dump:live只保存堆中的存活对象。</li></ul> <p>通常使用 <code>jmap -dump:live,format=b,file=filename.bin</code> 命令将堆中存活的对象导出到一个文件中。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ jmap -histo <span class="token number">22574</span>
 num     <span class="token comment">#instances         #bytes  class name (module)</span>
-------------------------------------------------------
   <span class="token number">1</span>:        <span class="token number">500004</span>       <span class="token number">20000160</span>  org.python.core.PyComplex
   <span class="token number">2</span>:        <span class="token number">570866</span>       <span class="token number">18267712</span>  org.python.core.PyFloat
   <span class="token number">3</span>:        <span class="token number">360295</span>       <span class="token number">18027024</span>  <span class="token punctuation">[</span>B <span class="token punctuation">(</span>java.base@11<span class="token punctuation">)</span>
   <span class="token number">4</span>:        <span class="token number">339394</span>       <span class="token number">11429680</span>  <span class="token punctuation">[</span>Lorg.python.core.PyObject<span class="token punctuation">;</span>
   <span class="token number">5</span>:        <span class="token number">308637</span>       <span class="token number">11194264</span>  <span class="token punctuation">[</span>Ljava.lang.Object<span class="token punctuation">;</span> <span class="token punctuation">(</span>java.base@11<span class="token punctuation">)</span>
   <span class="token number">6</span>:        <span class="token number">301378</span>        <span class="token number">9291664</span>  <span class="token punctuation">[</span>I <span class="token punctuation">(</span>java.base@11<span class="token punctuation">)</span>
   <span class="token number">7</span>:        <span class="token number">225103</span>        <span class="token number">9004120</span>  java.math.BigInteger <span class="token punctuation">(</span>java.base@11<span class="token punctuation">)</span>
   <span class="token number">8</span>:        <span class="token number">507362</span>        <span class="token number">8117792</span>  org.python.core.PySequence<span class="token variable">$1</span>
   <span class="token number">9</span>:        <span class="token number">285009</span>        <span class="token number">6840216</span>  org.python.core.PyLong
  <span class="token number">10</span>:        <span class="token number">282908</span>        <span class="token number">6789792</span>  java.lang.String <span class="token punctuation">(</span>java.base@11<span class="token punctuation">)</span>
  <span class="token punctuation">..</span>.
<span class="token number">2281</span>:             <span class="token number">1</span>             <span class="token number">16</span>  traceback<span class="token variable">$py</span>
<span class="token number">2282</span>:             <span class="token number">1</span>             <span class="token number">16</span>  unicodedata<span class="token variable">$py</span>
Total       <span class="token number">5151277</span>      <span class="token number">167944400</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>jmap 将会访问堆中所有的对象，为了保证此过程不会受到应用程序线程干扰，jmap 需要借助安全点机制，让所有线程停留在不改变堆中数据的状态。</p> <blockquote><p>如果某个线程长时间无法跑到安全点，jmap将一直等下去。与 jstat 不同，垃圾回收器会主动将jstat所需要的摘要数据保存至固定位置之中，而jstat只需直接读取即可。</p></blockquote> <h2 id="_4-jstack"><a href="#_4-jstack" class="header-anchor">#</a> 4. jstack</h2> <p><a href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html#GUID-721096FC-237B-473C-A461-DBBBB79E4F6A" target="_blank" rel="noopener noreferrer">jstack<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：打印目标 Java 进程中各个线程的栈轨迹，以及这些线程所持有的锁。</p> <p>jstack的其中一个应用场景便是死锁检测：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ jstack <span class="token number">31634</span>
<span class="token punctuation">..</span>.

<span class="token string">&quot;Thread-0&quot;</span> <span class="token comment">#12 prio=5 os_prio=31 cpu=1.32ms elapsed=34.24s tid=0x00007fb08601c800 nid=0x5d03 waiting for monitor entry  [0x000070000bc7e000]</span>
   java.lang.Thread.State: BLOCKED <span class="token punctuation">(</span>on object monitor<span class="token punctuation">)</span>
 at DeadLock.foo<span class="token punctuation">(</span>DeadLock.java:18<span class="token punctuation">)</span>
 - waiting to lock <span class="token operator">&lt;</span>0x000000061ff904c<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 - locked <span class="token operator">&lt;</span>0x000000061ff904b<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 at DeadLock<span class="token variable">$$</span>Lambda<span class="token variable">$1</span>/0x0000000800060840.run<span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>
 at java.lang.Thread.run<span class="token punctuation">(</span>java.base@11/Thread.java:834<span class="token punctuation">)</span>

<span class="token string">&quot;Thread-1&quot;</span> <span class="token comment">#13 prio=5 os_prio=31 cpu=1.43ms elapsed=34.24s tid=0x00007fb08601f800 nid=0x5f03 waiting for monitor entry  [0x000070000bd81000]</span>
   java.lang.Thread.State: BLOCKED <span class="token punctuation">(</span>on object monitor<span class="token punctuation">)</span>
 at DeadLock.bar<span class="token punctuation">(</span>DeadLock.java:33<span class="token punctuation">)</span>
 - waiting to lock <span class="token operator">&lt;</span>0x000000061ff904b<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 - locked <span class="token operator">&lt;</span>0x000000061ff904c<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 at DeadLock<span class="token variable">$$</span>Lambda<span class="token variable">$2</span>/0x0000000800063040.run<span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>
 at java.lang.Thread.run<span class="token punctuation">(</span>java.base@11/Thread.java:834<span class="token punctuation">)</span>

<span class="token punctuation">..</span>.

JNI global refs: <span class="token number">6</span>, weak refs: <span class="token number">0</span>


Found one Java-level deadlock:
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token string">&quot;Thread-0&quot;</span><span class="token builtin class-name">:</span>
  waiting to lock monitor 0x00007fb083015900 <span class="token punctuation">(</span>object 0x000000061ff904c0, a java.lang.Object<span class="token punctuation">)</span>,
  <span class="token function">which</span> is held by <span class="token string">&quot;Thread-1&quot;</span>
<span class="token string">&quot;Thread-1&quot;</span><span class="token builtin class-name">:</span>
  waiting to lock monitor 0x00007fb083015800 <span class="token punctuation">(</span>object 0x000000061ff904b0, a java.lang.Object<span class="token punctuation">)</span>,
  <span class="token function">which</span> is held by <span class="token string">&quot;Thread-0&quot;</span>

Java stack information <span class="token keyword">for</span> the threads listed above:
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token string">&quot;Thread-0&quot;</span><span class="token builtin class-name">:</span>
 at DeadLock.foo<span class="token punctuation">(</span>DeadLock.java:18<span class="token punctuation">)</span>
 - waiting to lock <span class="token operator">&lt;</span>0x000000061ff904c<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 - locked <span class="token operator">&lt;</span>0x000000061ff904b<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 at DeadLock<span class="token variable">$$</span>Lambda<span class="token variable">$1</span>/0x0000000800060840.run<span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>
 at java.lang.Thread.run<span class="token punctuation">(</span>java.base@11/Thread.java:834<span class="token punctuation">)</span>
<span class="token string">&quot;Thread-1&quot;</span><span class="token builtin class-name">:</span>
 at DeadLock.bar<span class="token punctuation">(</span>DeadLock.java:33<span class="token punctuation">)</span>
 - waiting to lock <span class="token operator">&lt;</span>0x000000061ff904b<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 - locked <span class="token operator">&lt;</span>0x000000061ff904c<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> <span class="token punctuation">(</span>a java.lang.Object<span class="token punctuation">)</span>
 at DeadLock<span class="token variable">$$</span>Lambda<span class="token variable">$2</span>/0x0000000800063040.run<span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>
 at java.lang.Thread.run<span class="token punctuation">(</span>java.base@11/Thread.java:834<span class="token punctuation">)</span>

Found <span class="token number">1</span> deadlock.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>可以看到，jstack不仅会打印线程的栈轨迹、线程状态（BLOCKED）、持有的锁（locked …）以及正在请求的锁（waiting to lock …），而且还会分析出具体的死锁。</p> <h2 id="_5-jinfo"><a href="#_5-jinfo" class="header-anchor">#</a> 5. jinfo</h2> <p><a href="https://docs.oracle.com/en/java/javase/11/tools/jinfo.html#GUID-69246B58-28C4-477D-B375-278F5F9830A5" target="_blank" rel="noopener noreferrer">jinfo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：可用来查看目标 Java 进程的参数，如传递给 Java 虚拟机的-X（即输出中的 jvm_args）、-XX参数（即输出中的 VM Flags），以及可在 Java 层面通过System.getProperty获取的-D参数（即输出中的 System Properties）。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ jinfo <span class="token number">31185</span>
Java System Properties:

<span class="token assign-left variable">gopherProxySet</span><span class="token operator">=</span>false
awt.toolkit<span class="token operator">=</span>sun.lwawt.macosx.LWCToolkit
java.specification.version<span class="token operator">=</span><span class="token number">11</span>
sun.cpu.isalist<span class="token operator">=</span>
sun.jnu.encoding<span class="token operator">=</span>UTF-8
<span class="token punctuation">..</span>.

VM Flags:
-XX:CICompilerCount<span class="token operator">=</span><span class="token number">4</span> -XX:ConcGCThreads<span class="token operator">=</span><span class="token number">3</span> -XX:G1ConcRefinementThreads<span class="token operator">=</span><span class="token number">10</span> -XX:G1HeapRegionSize<span class="token operator">=</span><span class="token number">2097152</span> -XX:GCDrainStackTargetSize<span class="token operator">=</span><span class="token number">64</span> -XX:InitialHeapSize<span class="token operator">=</span><span class="token number">536870912</span> -XX:MarkStackSize<span class="token operator">=</span><span class="token number">4194304</span> -XX:MaxHeapSize<span class="token operator">=</span><span class="token number">8589934592</span> -XX:MaxNewSize<span class="token operator">=</span><span class="token number">5152702464</span> -XX:MinHeapDeltaBytes<span class="token operator">=</span><span class="token number">2097152</span> -XX:NonNMethodCodeHeapSize<span class="token operator">=</span><span class="token number">5835340</span> -XX:NonProfiledCodeHeapSize<span class="token operator">=</span><span class="token number">122911450</span> -XX:ProfiledCodeHeapSize<span class="token operator">=</span><span class="token number">122911450</span> -XX:ReservedCodeCacheSize<span class="token operator">=</span><span class="token number">251658240</span> -XX:+SegmentedCodeCache -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC

VM Arguments:
jvm_args: -Xlog:gc -Xmx1024m
java_command: org.example.Foo
java_class_path <span class="token punctuation">(</span>initial<span class="token punctuation">)</span>: <span class="token builtin class-name">.</span>
Launcher Type: SUN_STANDARD
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>jinfo还可以用来修改目标 Java 进程的 “manageable” 虚拟机参数（如 HeapDumpAfterFullGC）：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 查看 manageable 参数</span>
$ java -XX:+PrintFlagsFinal -version <span class="token operator">|</span> <span class="token function">grep</span> manageable   
     intx CMSAbortablePrecleanWaitMillis           <span class="token operator">=</span> <span class="token number">100</span>                                    <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
     intx CMSTriggerInterval                       <span class="token operator">=</span> -1                                     <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
     intx CMSWaitDuration                          <span class="token operator">=</span> <span class="token number">2000</span>                                   <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
     bool HeapDumpAfterFullGC                      <span class="token operator">=</span> <span class="token boolean">false</span>                                  <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
     bool HeapDumpBeforeFullGC                     <span class="token operator">=</span> <span class="token boolean">false</span>                                  <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
     bool HeapDumpOnOutOfMemoryError               <span class="token operator">=</span> <span class="token boolean">false</span>                                  <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
    ccstr HeapDumpPath                             <span class="token operator">=</span>                                        <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
    uintx MaxHeapFreeRatio                         <span class="token operator">=</span> <span class="token number">70</span>                                     <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
    uintx MinHeapFreeRatio                         <span class="token operator">=</span> <span class="token number">40</span>                                     <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
     bool PrintClassHistogram                      <span class="token operator">=</span> <span class="token boolean">false</span>                                  <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
     bool PrintConcurrentLocks                     <span class="token operator">=</span> <span class="token boolean">false</span>                                  <span class="token punctuation">{</span>manageable<span class="token punctuation">}</span> <span class="token punctuation">{</span>default<span class="token punctuation">}</span>
java version <span class="token string">&quot;11&quot;</span> <span class="token number">2018</span>-09-25
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token number">18.9</span> <span class="token punctuation">(</span>build <span class="token number">11</span>+28<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token number">18.9</span> <span class="token punctuation">(</span>build <span class="token number">11</span>+28, mixed mode<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_6-jcmd（瑞士军刀）"><a href="#_6-jcmd（瑞士军刀）" class="header-anchor">#</a> 6. jcmd（瑞士军刀）</h2> <p><a href="https://docs.oracle.com/en/java/javase/11/tools/jcmd.html" target="_blank" rel="noopener noreferrer">jcmd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：可以用于替代前面除了jstat之外的所有命令。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>jcmd <span class="token punctuation">[</span>pid <span class="token operator">|</span> main-class<span class="token punctuation">]</span> command<span class="token punctuation">..</span>.<span class="token operator">|</span>PerfCounter.print<span class="token operator">|</span> 
-f filename
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>pid，Java 进程的 id。</li> <li>main-class，jcmd 会将命令发送给所有匹配到该 main 方法类的 Java 进程。</li> <li>command，传递给 JVM 的命令才行，可以通过 <code>jcmd pid help</code> 查看有效命令。如果 pid 为 0，则命令将会被发送给所有 Java 进程。</li> <li>-f，从指定的文件读取并执行命令。</li></ul> <p>监控项如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># example： jcmd &lt;pid&gt; Compiler.CodeHeap_Analytics</span>
Compiler.CodeHeap_Analytics
Compiler.codecache
Compiler.codelist
Compiler.directives_add
Compiler.directives_clear
Compiler.directives_print
Compiler.directives_remove
Compiler.queue
GC.class_histogram
GC.class_stats
GC.finalizer_info
GC.heap_dump
GC.heap_info
GC.run
GC.run_finalization
VM.class_hierarchy
VM.classloader_stats
VM.classloaders
VM.command_line
VM.dynlibs
VM.flags
VM.info
VM.log
VM.metaspace
VM.native_memory
VM.print_touched_methods
VM.set_flag
VM.stringtable
VM.symboltable
VM.system_properties
VM.systemdictionary
VM.unlock_commercial_features
VM.uptime
VM.version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="_7-jmc-与-jfr"><a href="#_7-jmc-与-jfr" class="header-anchor">#</a> 7. JMC 与 JFR</h2> <p><a href="http://jdk.java.net/jmc/" target="_blank" rel="noopener noreferrer">Java Mission Control（JMC)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是 Java 虚拟机平台上的性能监控工具。它包含一个 GUI 客户端，以及众多用来收集 Java 虚拟机性能数据的插件，如 JMX Console（能够访问用来存放虚拟机各个子系统运行数据的 <a href="https://en.wikipedia.org/wiki/Java_Management_Extensions#Managed_beans" target="_blank" rel="noopener noreferrer">MXBeans<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），以及虚拟机内置的高效 profiling 工具 <strong>Java Flight Recorder（JFR）</strong>。</p> <p>JFR 的性能开销很小，在默认配置下平均低于 1%。与其他工具相比，JFR 能够直接访问虚拟机内的数据，并且不会影响虚拟机的优化，适用于生产环境下满负荷运行的 Java 程序。</p> <p>当启用时，JFR 将记录运行过程中发生的一系列事件。其中包括 Java 层面的事件，如线程事件、锁事件，以及 Java 虚拟机内部的事件，如新建对象、垃圾回收和即时编译事件：</p> <ol><li>瞬时事件（Instant Event），用户关心的是它们发生与否，例如异常、线程启动事件。</li> <li>持续事件（Duration Event），用户关心的是它们的持续时间，例如垃圾回收事件。</li> <li>计时事件（Timed Event），是时长超出指定阈值的持续事件。</li> <li>取样事件（Sample Event），是周期性取样的事件。取样事件的其中一个常见例子便是方法抽样（Method Sampling），即每隔一段时间统计各个线程的栈轨迹。如果在这些抽样取得的栈轨迹中存在一个反复出现的方法，那么我们可以推测该方法是热点方法。</li></ol> <p>开启 JFR 的几种方式：</p> <ol><li><p>启动 JVM 时添加 <code>-XX:StartFlightRecording=xxx</code> 参数，如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># Time fixed</span>
<span class="token comment"># JFR 将会在 Java 虚拟机启动 5s 后（对应delay=5s）收集数据，持续 20s（对应duration=20s）。当收集完毕后，JFR 会将收集得到的数据保存至指定的文件中。</span>
$ java -XX:StartFlightRecording<span class="token operator">=</span>delay<span class="token operator">=</span>5s,duration<span class="token operator">=</span>20s,filename<span class="token operator">=</span>myrecording.jfr,settings<span class="token operator">=</span>profile MyApp


<span class="token comment"># Continuous, dump on exit</span>
<span class="token comment"># dumponexit=true 指定 JVM 在退出时保存 JFR 的数据到制定的文件</span>
$ java -XX:StartFlightRecording<span class="token operator">=</span>dumponexit<span class="token operator">=</span>true,filename<span class="token operator">=</span>myrecording.jfr MyApp


<span class="token comment"># Continuous, dump on demand</span>
$ java -XX:StartFlightRecording<span class="token operator">=</span>maxage<span class="token operator">=</span>10m,maxsize<span class="token operator">=</span>100m,name<span class="token operator">=</span>SomeLabel MyApp
Started recording <span class="token number">1</span>.
<span class="token comment"># 上述 JVM 不会在退出时主动保存 JFR 信息，需要使用 jcmd 输出到文件中。</span>
<span class="token comment"># Use jcmd 38502 JFR.dump name=SomeLabel filename=FILEPATH to copy recording data to file.</span>
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>settings=profile 指定了 JFR 所收集的事件类型。默认情况下，JFR 将加载配置文件<em>JDK/lib/jfr/default.jfc</em>，并识别其中所包含的事件类型。当使用了 settings=profile 配置时，JFR 将加载配置文件 <em>JDK/lib/jfr/profile.jfc</em>。该配置文件所包含的事件类型要多于默认的 default.jfc，因此性能开销也要大一些（约为 2%）。default.jfc以及profile.jfc均为 XML 文件。</p></blockquote></li> <li><p>使用 jcmd 开启 JFR，有 JFR.start、JFR.dump 和 JFR.stop 三种命令：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
$ jcmd <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span> JFR.start <span class="token assign-left variable">settings</span><span class="token operator">=</span>profile <span class="token assign-left variable">maxage</span><span class="token operator">=</span>10m <span class="token assign-left variable">maxsize</span><span class="token operator">=</span>150m <span class="token assign-left variable">name</span><span class="token operator">=</span>SomeLabel

$ jcmd <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span> JFR.dump <span class="token assign-left variable">name</span><span class="token operator">=</span>SomeLabel <span class="token assign-left variable">filename</span><span class="token operator">=</span>myrecording.jfr

$ jcmd <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span> JFR.stop <span class="token assign-left variable">name</span><span class="token operator">=</span>SomeLabel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>更详细的方法见 <a href="https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/comline.htm#JFRRT185" target="_blank" rel="noopener noreferrer">帮助文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></li> <li><p>使用 JMC 中的 JFR 插件，在图形界面中连接上 Java 进程后，便可以通过图形界面开启 JFR。</p> <p><img src="https://static001.geekbang.org/resource/image/39/16/395900f606fd93570196a6dcbac75e16.png" alt=""></p> <p><img src="https://static001.geekbang.org/resource/image/31/6a/31f86bc1cafc569f51e0364d716cab6a.png" alt=""></p></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/11/2021, 3:28:21 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/books/zhuan-lan-xue-xi/shen-ru-chai-jiejava-xu-ni-ji/16.jmh-ji-zhun-ce-shi.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        16.JMH基准测试
      </a></span> <!----></p></div> </main> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/books/assets/js/app.a32f3f13.js" defer></script><script src="/books/assets/js/2.f434c5a6.js" defer></script><script src="/books/assets/js/118.b518ee54.js" defer></script>
  </body>
</html>