(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{916:function(e,s,a){"use strict";a.r(s);var r=a(70),t=Object(r.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"hdp下-timeline-service-配置注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hdp下-timeline-service-配置注意事项"}},[e._v("#")]),e._v(" HDP下 Timeline Service 配置注意事项")]),e._v(" "),a("p",[e._v("如果 Yarn 的 Timeline Service 切换为外部 Hbase，需要先关闭集群默认 ats-hbase，参考 "),a("a",{attrs:{href:"https://docs.cloudera.com/HDPDocuments/HDP3/HDP-3.0.1/data-operating-system/content/remove_ats_hbase_before_switching_between_clusters.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Remove ats-hbase before switching between clusters"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("p",[e._v("之后按照如下步骤进行切换：")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("在 Timeline Service 所在节点备份 hbase 配置："),a("code",[e._v("mv /usr/hdp/3.1.0.0-78/hadoop/conf/embedded-yarn-ats-hbase/hbase-site.xml /usr/hdp/3.1.0.0-78/hadoop/conf/embedded-yarn-ats-hbase/hbase-site.xml.bak")]),e._v("。")])]),e._v(" "),a("li",[a("p",[e._v("Yarn 服务下配置开启外部 Hbase，并修改 "),a("code",[e._v("hbase.master.info.bindAddress")]),e._v(" 为外部 Hbase 所在节点。")])]),e._v(" "),a("li",[a("p",[e._v("Yarn 服务下修改 "),a("code",[e._v("zookeeper.znode.parent")]),e._v(" 为 "),a("code",[e._v("hbase-unsecure")]),e._v("。")])]),e._v(" "),a("li",[a("p",[e._v("创建 Timeline Service 所需要的 Hbase 表：")]),e._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("HBASE_CLASSPATH_PREFIX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/usr/hdp/current/hadoop-yarn-client/timelineservice/*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("/usr/hdp/current/hbase-client/bin/hbase org.apache.hadoop.yarn.server.timelineservice.storage.TimelineSchemaCreator -Dhbase.client.retries.number"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("35")]),e._v(" -create -s\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("去 Hbase 服务下开启简单认证并重启:")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/zhxuankun/Image/raw/master/ARTS_Tips/image-20210610224821620.png",alt:"image-20210610224821620"}})])]),e._v(" "),a("li",[a("p",[e._v("以 hbase 超级用户启动 Hbase Shell："),a("code",[e._v("sudo -u hbase hbase shell")]),e._v("，执行以下语句授权：")]),e._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("grant")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'yarn'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'RWXCA'")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("grant")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'yarn-ats'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'RWXCA'")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("在 Timeline Service 节点上手动复制 Hbase 配置文件："),a("code",[e._v("cp /etc/hbase/conf/hbase-site.xml /usr/hdp/3.1.0.0-78/hadoop/conf/embedded-yarn-ats-hbase/")]),e._v("。")])]),e._v(" "),a("li",[a("p",[e._v("重启 Yarn。")])])]),e._v(" "),a("h3",{attrs:{id:"安全集群环境下切换"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全集群环境下切换"}},[e._v("#")]),e._v(" 安全集群环境下切换")]),e._v(" "),a("p",[e._v("如果是在安全集群下 timeservice 切换为外部 Hbase，还需要进行一些清理工作，参考官网链接：https://docs.cloudera.com/HDPDocuments/HDP3/HDP-3.0.1/data-operating-system/content/remove_ats_hbase_before_switching_between_clusters.html。")]),e._v(" "),a("p",[e._v("开启安全集群后，Ambari 默认会给 timeservice 配置内置 Hbase 的 keytab 以及 principal ，这个会导致 timeservice 与外部 Hbase 连接认证错误，需要手动修改：")]),e._v(" "),a("ol",[a("li",[e._v("Yarn 服务建立新的配置组。")]),e._v(" "),a("li",[e._v("修改 Yarn 服务下的 "),a("code",[e._v("zookeeper.znode.parent")]),e._v(" 为 Hbase 的 "),a("code",[e._v("ZooKeeper Znode Parent")]),e._v("（PS：开启安全后，Hbase 的 znode 会有变化）。")]),e._v(" "),a("li",[e._v("修改 Yarn 服务下的 Hbase 安全配置：\n"),a("ul",[a("li",[e._v("hbase.master.kerberos.principal ：hbase/_HOST@HAOHAN.COM")]),e._v(" "),a("li",[e._v("hbase.master.keytab.file ：/etc/security/keytabs/hbase.service.keytab")]),e._v(" "),a("li",[e._v("/etc/security/keytabs/hbase.service.keytab：hbase/_HOST@HAOHAN.COM")]),e._v(" "),a("li",[e._v("hbase.regionserver.keytab.file ：hbase.regionserver.keytab.file")])])])]),e._v(" "),a("p",[e._v("之后 "),a("code",[e._v("yarn")]),e._v(" 以及 "),a("code",[e._v("yarn-ats")]),e._v(" 的授权需要先 kinit 为 hbase 的用户："),a("code",[e._v("kinit -kt /etc/security/keytabs/hbase.service.keytab hbase/server.haohan.com@HAOHAN.COM")]),e._v("，然后进入 hbase shell 进行授权，或者开启 Ranger 插件，在 Ranger 中授权。")]),e._v(" "),a("h3",{attrs:{id:"安全集群下-hbase-ranger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全集群下-hbase-ranger"}},[e._v("#")]),e._v(" 安全集群下 Hbase + Ranger")]),e._v(" "),a("p",[e._v("安全集群下，需要为 Hbase 创建一个用户，用于在 Ranger 管理 Hbase 的 repository。")]),e._v(" "),a("p",[e._v("这里以 Freeipa 为例，首先使用 Freeipa 创建一个 "),a("code",[e._v("rangerhbaselookup")]),e._v(" 用户，密码为 "),a("code",[e._v("12345678")]),e._v(" ，并要确保该用户已经同步到 Ranger 中。")]),e._v(" "),a("p",[e._v("接着在 Hbase 服务下配置一下几个参数：")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Enable Ranger for HBASE：勾选")])]),e._v(" "),a("li",[a("p",[e._v("Ranger repository config user：rangerhbaselookup@example.com")])]),e._v(" "),a("li",[a("p",[e._v("Ranger repository config password：12345678")])])]),e._v(" "),a("p",[e._v("保存并重启 Hbase 服务。")]),e._v(" "),a("p",[e._v("参考官网：https://docs.cloudera.com/HDPDocuments/HDP2/HDP-2.3.0/bk_Ranger_Install_Guide/content/hbase_plugin_kerberos.html。")]),e._v(" "),a("p",[e._v("同时发现，HDFS/HIVE 也需要进行类似配置，这一步应该是为了组件能够自动在 Ranger 建立对应的 repository。")])])}),[],!1,null,null,null);s.default=t.exports}}]);