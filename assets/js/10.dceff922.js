(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{735:function(t,s,a){"use strict";a.r(s);var e=a(70),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"ntp-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ntp-服务"}},[t._v("#")]),t._v(" NTP 服务")]),t._v(" "),a("p",[t._v("Linux 系统远程同步时间的方式主要有 ntp 和 ntpdate 两种方式：")]),t._v(" "),a("ul",[a("li",[t._v("ntp：渐进式同步时间，跨度平滑（推荐）。")]),t._v(" "),a("li",[t._v("ntpdate：立刻校准时间，存在较大跨度。")])]),t._v(" "),a("p",[t._v("ntp 在时间差距较大的时候，校准需要花费较长时间，因此通常都是先使用 ntpdate 强制同步到最新时间，再开启 ntp 服务持续校准时间。")]),t._v(" "),a("p",[t._v("ntp 服务配置位于 "),a("code",[t._v("/etc/ntp.conf")]),t._v("，默认内容如下：")]),t._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # For more information about this file, see the man pages")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # ntp.conf(5), ntp_acc(5), ntp_auth(5), ntp_clock(5), ntp_misc(5), ntp_mon(5).")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" driftfile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/var/lib/ntp/drift")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Permit time synchronization with our time source, but do not")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # permit the source to query or modify the service on this system.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" restrict")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("default kod nomodify notrap nopeer noquery")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" restrict")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("-6 default kod nomodify notrap nopeer noquery")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Permit all access over the loopback interface.  This could")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # be tightened as well, but to do so would effect some of")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # the administrative functions.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" restrict")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("127.0.0.1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" restrict")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("-6 ::1")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Hosts on local network are less restricted.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Use public servers from the pool.ntp.org project.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Please consider joining the pool (http://www.pool.ntp.org/join.html).")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("0.rhel.pool.ntp.org iburst")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("1.rhel.pool.ntp.org iburst")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("2.rhel.pool.ntp.org iburst")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("3.rhel.pool.ntp.org iburst")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #broadcast 192.168.1.255 autokey        # broadcast server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #broadcastclient                        # broadcast client")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #broadcast 224.0.1.1 autokey            # multicast server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #multicastclient 224.0.1.1              # multicast client")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #manycastserver 239.255.254.254         # manycast server")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #manycastclient 239.255.254.254 autokey # manycast client")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Enable public key cryptography.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #crypto")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" includefile")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/etc/ntp/crypto/pw")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Key file containing the keys and key identifiers used when operating")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # with symmetric key cryptography.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" keys")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("/etc/ntp/keys")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Specify the key identifiers which are trusted.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #trustedkey 4 8 42")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Specify the key identifier to use with the ntpdc utility.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #requestkey 8")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Specify the key identifier to use with the ntpq utility.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #controlkey 8")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" # Enable writing of statistics records.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v(" #statistics clockstats cryptostats loopstats peerstats")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br"),a("span",{staticClass:"line-number"},[t._v("53")]),a("br"),a("span",{staticClass:"line-number"},[t._v("54")]),a("br")])]),a("h3",{attrs:{id:"_1-restrict"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-restrict"}},[t._v("#")]),t._v(" 1. restrict")]),t._v(" "),a("p",[t._v("restrict 表示权限控制，语法："),a("code",[t._v("restrict [IP] mask [IP MASK] [options]")]),t._v("， "),a("code",[t._v("default")]),t._v(" 表示所有 IP，此时可以省略 IP 以及 IP 掩码。")]),t._v(" "),a("p",[t._v("各个参数的选项如下：")]),t._v(" "),a("ul",[a("li",[t._v("ignore：拒绝连接到NTP服务器")]),t._v(" "),a("li",[t._v("nomodiy： 忽略所有改变NTP服务器配置的报文，但可以查询配置信息")]),t._v(" "),a("li",[t._v("noquery： 忽略所有mode字段为6或7的报文，客户端不能改变NTP服务器配置，也不能查询配置信息")]),t._v(" "),a("li",[t._v("notrap： 不提供trap远程登录功能，trap服务是一种远程时间日志服务。")]),t._v(" "),a("li",[t._v("notrust： 不作为同步的时钟源。")]),t._v(" "),a("li",[t._v("nopeer： 提供时间服务，但不作为对等体。")]),t._v(" "),a("li",[t._v("kod： 向不安全的访问者发送Kiss-Of-Death报文")])]),t._v(" "),a("h3",{attrs:{id:"_2-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-server"}},[t._v("#")]),t._v(" 2. server")]),t._v(" "),a("p",[t._v("server 指定了远程同步的宿主机，可以指定多个，语法："),a("strong",[t._v("server host [ key n ] [ version n ] [ prefer ] [ mode n ] [ minpoll n ] [ maxpoll n ] [ iburst ]")]),t._v("，各参数含义如下：")]),t._v(" "),a("ul",[a("li",[t._v("key： 表示所有发往服务器的报文包含有秘钥加密的认证信息，n 是 32 位的整数，表示秘钥号。")]),t._v(" "),a("li",[t._v("version： 表示发往上层服务器的报文使用的版本号，n 默认是 3，可以是 1 或者 2。")]),t._v(" "),a("li",[t._v("prefer： 如果有多个 server 选项，具有该参数的服务器有限使用。")]),t._v(" "),a("li",[t._v("mode： 指定数据报文 mode 字段的值。")]),t._v(" "),a("li",[t._v("minpoll： 指定与查询该服务器的最小时间间隔为 2 的 n 次方秒，n 默认为 6，范围为 4 -14。")]),t._v(" "),a("li",[t._v("maxpoll： 指定与查询该服务器的最大时间间隔为 2 的 n 次方秒，n 默认为 10，范围为 4 - 14。")]),t._v(" "),a("li",[t._v("iburst： 当初始同步请求时，采用突发方式接连发送 8 个报文，时间间隔为 2 秒。")])]),t._v(" "),a("p",[t._v("如果需要以本地机器作为时间源，则可以配置为 "),a("code",[t._v("server 127.127.1.0 iburst")])]),t._v(" "),a("h3",{attrs:{id:"_3-检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-检查"}},[t._v("#")]),t._v(" 3. 检查")]),t._v(" "),a("p",[t._v("可以执行 "),a("code",[t._v("ntpq -p")]),t._v(" 或者 "),a("code",[t._v("watch 'ntpq -p'")]),t._v(" 来查看 ntp 服务同步情况：")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v(" remote           refid            st t when poll reach   delay   offset  jitter\n "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\n  LOCAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("        .LOCL.           "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" l  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("164")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("74")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.000")]),t._v("\n *ip1.com         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.115    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" u   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("77")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.052")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.411")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.093")]),t._v("\n +ip2.com         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.116    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" u   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("28")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("77")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.065")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.210")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.234")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("remote")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("refid")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("st")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("when")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("poll")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("reach")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("delay")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("offset")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("jitter")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("同步的远程主机，* 表示优先，+ 表示次优先")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("参考的上一层ntp主机地址")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("正在响应ntp请求的主机级别")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("多少秒前曾经同步过时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ntp同步隔")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("八进制，表示最近接受的8个packet情况，通常为 377，否则表示最近有packet丢失")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ntp往返的网络延迟")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("时间补偿")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("表示offset方差，越小代表越稳定")])])])])])}),[],!1,null,null,null);s.default=n.exports}}]);