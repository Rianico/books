(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{803:function(s,e,n){"use strict";n.r(e);var a=n(70),t=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"ansible-并发执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ansible-并发执行"}},[s._v("#")]),s._v(" Ansible 并发执行")]),s._v(" "),n("p",[s._v("Ansible默认是"),n("strong",[s._v("同步阻塞")]),s._v("模式，它会等待所有的机器都执行完毕才会在前台返回，因此，当机器数量一多的时候，等待一台台执行完是相当耗费时间的。")]),s._v(" "),n("p",[s._v("基于以上，我们可以让Ansible以异步并发的方式执行批量操作。")]),s._v(" "),n("p",[s._v("Ansible默认只会创建5个进程并发执行任务，所以一次任务只能同时控制5台机器执行，该值可以通过"),n("code",[s._v("-f 5")]),s._v("修改。")]),s._v(" "),n("p",[s._v("Ansible并发执行的时候，会将每台机器的job挂在后台，并不断去轮询状态，即使job先完成了，Ansible直到去轮询对应job状态的时候才会认为完成，可以通过"),n("code",[s._v("-P 1")]),s._v("控制轮询间隔。")]),s._v(" "),n("p",[s._v("e.g. 开启5个线程并异步执行：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -B200 表示启用异步模式，200s后任务还没完成则为超时")]),s._v("\nansible mycluster -B200 -P "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -m "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" -a "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sleep 5"')]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);