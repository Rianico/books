(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{842:function(s,a,t){"use strict";t.r(a);var n=t(70),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-jps"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-jps"}},[s._v("#")]),s._v(" 1. jps")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jps.html#GUID-6EB65B96-F9DD-4356-B825-6146E9EEC81E",target:"_blank",rel:"noopener noreferrer"}},[s._v("jps"),t("OutboundLink")],1),s._v("：打印所有正在运行的 Java 进程的相关信息。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ jps -mlv\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18331")]),s._v(" org.example.Foo Hello World\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18332")]),s._v(" jdk.jcmd/sun.tools.jps.Jps -mlv -Dapplication.home"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/Library/Java/JavaVirtualMachines/jdk-11.jdk/Contents/Home -Xms8m -Djdk.module.main"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jdk.jcmd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("-q：输出本地 JVM 进程的 class name, JAR file name 以及传递给 main 方法的参数。")]),s._v(" "),t("li",[s._v("-m：打印传递给 main 方法的参数。")]),s._v(" "),t("li",[s._v("-l：打印 main 方法完整的包名，或者 JAR  的完整路径。")]),s._v(" "),t("li",[s._v("-v：打印传递给 JVM 的参数。")]),s._v(" "),t("li",[s._v("-V：同 -q。")])]),s._v(" "),t("p",[s._v("jps 还可以查看远端机器上的 Java 进程：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("jps -l remote.domain\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3002")]),s._v(" /opt/jdk1.7.0/demo/jfc/Java2D/Java2Demo.JAR\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2857")]),s._v(" sun.tools.jstatd.jstatd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("如果 JVM 关闭了默认开启的 "),t("code",[s._v("UserPerData")]),s._v(" （-XX:-UsePerfData），则 jps 将无法探测到该 JVM。")]),s._v(" "),t("h2",{attrs:{id:"_2-jstat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-jstat"}},[s._v("#")]),s._v(" 2. jstat")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jstat.html#GUID-5F72A7F9-5D5A-4486-8201-E1D1BA8ACCB5",target:"_blank",rel:"noopener noreferrer"}},[s._v("jstat"),t("OutboundLink")],1),s._v("：打印目标 Java 进程的性能数据。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("jstat outputOptions "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-h lines"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" vmid "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("interval "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("-t：在首列打印出目标 Java 进程的启动时间，单位为 s")]),s._v(" "),t("li",[s._v("-h：每过 n 行打印一次 header，默认为 0，仅在首行打印一次")])]),s._v(" "),t("p",[s._v("其中的 outputOptions 如下：")]),s._v(" "),t("ul",[t("li",[s._v("-class：打印类加载器的行为统计信息。")]),s._v(" "),t("li",[s._v("-compiler：打印 JIT 编译器的行为统计信息。")]),s._v(" "),t("li",[s._v("-gc")]),s._v(" "),t("li",[s._v("-gccapacity")]),s._v(" "),t("li",[s._v("-gccause")]),s._v(" "),t("li",[s._v("-gcmetacapacity")]),s._v(" "),t("li",[s._v("-gcnew")]),s._v(" "),t("li",[s._v("-gcnewcapacity")]),s._v(" "),t("li",[s._v("-gcold")]),s._v(" "),t("li",[s._v("-gcoldcapacity")]),s._v(" "),t("li",[s._v("-gcutil")]),s._v(" "),t("li",[s._v("-printcompilation：打印 JVM 编译方法的统计信息。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Usage: jstat -outputOptions [-t] [-hlines] VMID [interval [count]]")]),s._v("\n$ jstat -gc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22126")]),s._v(" 1s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nS0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT   \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("139904,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47146,4")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("349568,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21321,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30020,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28001,8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4673,4")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,080")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,270")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,350")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("420,6")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("139904,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11178,4")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("349568,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21321,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30020,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28090,1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4674,2")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,084")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,270")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,354")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("403,9")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("139904,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("139538,4")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("349568,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21323,4")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30020,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28137,2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4674,2")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,088")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,359")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,446")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17472,0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("139904,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("349568,0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21326,1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30020,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28093,6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864,0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4673,4")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,091")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,445")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,000")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0,536")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("jstat 还可以用于判断是否出现了内存泄漏，每隔一段时间，通过 jstat 获取 OU 的情况，取其最小值，如果这些值随着时间呈上涨趋势，那么意味着无法回收的对象在不断增加，因此很可能出现了内存泄漏。")]),s._v(" "),t("p",[s._v("使用 G1 GC 时，jstat 的输出会存在一些特征：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ jstat -gc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22208")]),s._v(" 1s\nS0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT   \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("210944.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192512.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("133120.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5332.5")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28848.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26886.4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4620.5")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.067")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.016")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.084")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("210944.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83968.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("133120.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5749.9")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29104.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27132.8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4621.0")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.078")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.016")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.095")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("71680.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18432.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45056.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20285.1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29872.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27952.4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4671.6")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.089")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.063")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.153")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("69632.0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28672.0")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45056.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18608.1")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30128.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28030.4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4864.0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4672.4")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.093")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.063")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.158")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("可以看到 S0C、S0U 始终为 0 ，而 S1C、S10 有时会变为 0。")]),s._v(" "),t("ul",[t("li",[s._v("S0 区域：由于 G1 中不再设置 Eden、Survivor、Old 区的内存边界，而是将对划分为若干个等长内存区域，因此也就没有以前 GC 算法中 FROM、TO 之间的划分了。")]),s._v(" "),t("li",[s._v("S1 区域：G1 GC 时，可能会出现 Survivor 区内的所有对象都被回收或者晋升的对象，此时内存中完全没有 Survivor 区域。")]),s._v(" "),t("li",[s._v("CGC & CGCT：分别代表并发 GC Stop-The-World 的次数和时间。")])]),s._v(" "),t("h2",{attrs:{id:"_3-jmap"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-jmap"}},[s._v("#")]),s._v(" 3. jmap")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jmap.html#GUID-D2340719-82BA-4077-B0F3-2803269B7F41",target:"_blank",rel:"noopener noreferrer"}},[s._v("jmap"),t("OutboundLink")],1),s._v("：可以用于分析 Java 虚拟机堆中的对象。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("jmap "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" pid\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("options 如下：")]),s._v(" "),t("ul",[t("li",[s._v("-clstats，该子命令将打印被加载类的信息。")]),s._v(" "),t("li",[s._v("-finalizerinfo，该子命令将打印所有待 finalize 的对象。")]),s._v(" "),t("li",[s._v("-histo，该子命令将统计各个类的实例数目以及占用内存，并按照内存使用量从多至少的顺序排列。此外，-histo:live 只统计堆中的存活对象。")]),s._v(" "),t("li",[s._v("-dump，该子命令将导出 Java 虚拟机堆的快照。同样，-dump:live只保存堆中的存活对象。")])]),s._v(" "),t("p",[s._v("通常使用 "),t("code",[s._v("jmap -dump:live,format=b,file=filename.bin")]),s._v(" 命令将堆中存活的对象导出到一个文件中。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ jmap -histo "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22574")]),s._v("\n num     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#instances         #bytes  class name (module)")]),s._v("\n-------------------------------------------------------\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("500004")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000160")]),s._v("  org.python.core.PyComplex\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("570866")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18267712")]),s._v("  org.python.core.PyFloat\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("360295")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18027024")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("B "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("339394")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11429680")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Lorg.python.core.PyObject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("308637")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11194264")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Ljava.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("301378")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9291664")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("I "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("225103")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9004120")]),s._v("  java.math.BigInteger "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("507362")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8117792")]),s._v("  org.python.core.PySequence"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("285009")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6840216")]),s._v("  org.python.core.PyLong\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("282908")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6789792")]),s._v("  java.lang.String "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2281")]),s._v(":             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  traceback"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$py")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2282")]),s._v(":             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  unicodedata"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$py")]),s._v("\nTotal       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5151277")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("167944400")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("jmap 将会访问堆中所有的对象，为了保证此过程不会受到应用程序线程干扰，jmap 需要借助安全点机制，让所有线程停留在不改变堆中数据的状态。")]),s._v(" "),t("blockquote",[t("p",[s._v("如果某个线程长时间无法跑到安全点，jmap将一直等下去。与 jstat 不同，垃圾回收器会主动将jstat所需要的摘要数据保存至固定位置之中，而jstat只需直接读取即可。")])]),s._v(" "),t("h2",{attrs:{id:"_4-jstack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-jstack"}},[s._v("#")]),s._v(" 4. jstack")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jstack.html#GUID-721096FC-237B-473C-A461-DBBBB79E4F6A",target:"_blank",rel:"noopener noreferrer"}},[s._v("jstack"),t("OutboundLink")],1),s._v("：打印目标 Java 进程中各个线程的栈轨迹，以及这些线程所持有的锁。")]),s._v(" "),t("p",[s._v("jstack的其中一个应用场景便是死锁检测：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ jstack "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31634")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#12 prio=5 os_prio=31 cpu=1.32ms elapsed=34.24s tid=0x00007fb08601c800 nid=0x5d03 waiting for monitor entry  [0x000070000bc7e000]")]),s._v("\n   java.lang.Thread.State: BLOCKED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on object monitor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at DeadLock.foo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DeadLock.java:18"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - waiting to lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904c"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904b"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at DeadLock"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("/0x0000000800060840.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at java.lang.Thread.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11/Thread.java:834"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#13 prio=5 os_prio=31 cpu=1.43ms elapsed=34.24s tid=0x00007fb08601f800 nid=0x5f03 waiting for monitor entry  [0x000070000bd81000]")]),s._v("\n   java.lang.Thread.State: BLOCKED "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("on object monitor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at DeadLock.bar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DeadLock.java:33"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - waiting to lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904b"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904c"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at DeadLock"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("/0x0000000800063040.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at java.lang.Thread.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11/Thread.java:834"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nJNI global refs: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(", weak refs: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n\nFound one Java-level deadlock:\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  waiting to lock monitor 0x00007fb083015900 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object 0x000000061ff904c0, a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" is held by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n  waiting to lock monitor 0x00007fb083015800 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object 0x000000061ff904b0, a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" is held by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),s._v("\n\nJava stack information "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the threads listed above:\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-0"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n at DeadLock.foo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DeadLock.java:18"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - waiting to lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904c"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904b"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at DeadLock"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("/0x0000000800060840.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at java.lang.Thread.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11/Thread.java:834"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Thread-1"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n at DeadLock.bar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DeadLock.java:33"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - waiting to lock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904b"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n - locked "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("0x000000061ff904c"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a java.lang.Object"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at DeadLock"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$$")]),s._v("Lambda"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("/0x0000000800063040.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown Source"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n at java.lang.Thread.run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("java.base@11/Thread.java:834"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nFound "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" deadlock.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])]),t("p",[s._v("可以看到，jstack不仅会打印线程的栈轨迹、线程状态（BLOCKED）、持有的锁（locked …）以及正在请求的锁（waiting to lock …），而且还会分析出具体的死锁。")]),s._v(" "),t("h2",{attrs:{id:"_5-jinfo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-jinfo"}},[s._v("#")]),s._v(" 5. jinfo")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jinfo.html#GUID-69246B58-28C4-477D-B375-278F5F9830A5",target:"_blank",rel:"noopener noreferrer"}},[s._v("jinfo"),t("OutboundLink")],1),s._v("：可用来查看目标 Java 进程的参数，如传递给 Java 虚拟机的-X（即输出中的 jvm_args）、-XX参数（即输出中的 VM Flags），以及可在 Java 层面通过System.getProperty获取的-D参数（即输出中的 System Properties）。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ jinfo "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31185")]),s._v("\nJava System Properties:\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gopherProxySet")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\nawt.toolkit"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sun.lwawt.macosx.LWCToolkit\njava.specification.version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\nsun.cpu.isalist"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nsun.jnu.encoding"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("UTF-8\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nVM Flags:\n-XX:CICompilerCount"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" -XX:ConcGCThreads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -XX:G1ConcRefinementThreads"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" -XX:G1HeapRegionSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2097152")]),s._v(" -XX:GCDrainStackTargetSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" -XX:InitialHeapSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("536870912")]),s._v(" -XX:MarkStackSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4194304")]),s._v(" -XX:MaxHeapSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8589934592")]),s._v(" -XX:MaxNewSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5152702464")]),s._v(" -XX:MinHeapDeltaBytes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2097152")]),s._v(" -XX:NonNMethodCodeHeapSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5835340")]),s._v(" -XX:NonProfiledCodeHeapSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122911450")]),s._v(" -XX:ProfiledCodeHeapSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122911450")]),s._v(" -XX:ReservedCodeCacheSize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("251658240")]),s._v(" -XX:+SegmentedCodeCache -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseG1GC\n\nVM Arguments:\njvm_args: -Xlog:gc -Xmx1024m\njava_command: org.example.Foo\njava_class_path "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("initial"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nLauncher Type: SUN_STANDARD\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("jinfo还可以用来修改目标 Java 进程的 “manageable” 虚拟机参数（如 HeapDumpAfterFullGC）：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 manageable 参数")]),s._v("\n$ java -XX:+PrintFlagsFinal -version "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" manageable   \n     intx CMSAbortablePrecleanWaitMillis           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("                                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     intx CMSTriggerInterval                       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" -1                                     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     intx CMSWaitDuration                          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("                                   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     bool HeapDumpAfterFullGC                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     bool HeapDumpBeforeFullGC                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     bool HeapDumpOnOutOfMemoryError               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    ccstr HeapDumpPath                             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("                                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    uintx MaxHeapFreeRatio                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("                                     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    uintx MinHeapFreeRatio                         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("                                     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     bool PrintClassHistogram                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     bool PrintConcurrentLocks                     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                                  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("manageable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\njava version "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-09-25\nJava"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" SE Runtime Environment "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("+28"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nJava HotSpot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TM"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("+28, mixed mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h2",{attrs:{id:"_6-jcmd（瑞士军刀）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-jcmd（瑞士军刀）"}},[s._v("#")]),s._v(" 6. jcmd（瑞士军刀）")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jcmd.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("jcmd"),t("OutboundLink")],1),s._v("：可以用于替代前面除了jstat之外的所有命令。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("jcmd "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("pid "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" main-class"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" command"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PerfCounter.print"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" \n-f filename\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("pid，Java 进程的 id。")]),s._v(" "),t("li",[s._v("main-class，jcmd 会将命令发送给所有匹配到该 main 方法类的 Java 进程。")]),s._v(" "),t("li",[s._v("command，传递给 JVM 的命令才行，可以通过 "),t("code",[s._v("jcmd pid help")]),s._v(" 查看有效命令。如果 pid 为 0，则命令将会被发送给所有 Java 进程。")]),s._v(" "),t("li",[s._v("-f，从指定的文件读取并执行命令。")])]),s._v(" "),t("p",[s._v("监控项如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# example： jcmd <pid> Compiler.CodeHeap_Analytics")]),s._v("\nCompiler.CodeHeap_Analytics\nCompiler.codecache\nCompiler.codelist\nCompiler.directives_add\nCompiler.directives_clear\nCompiler.directives_print\nCompiler.directives_remove\nCompiler.queue\nGC.class_histogram\nGC.class_stats\nGC.finalizer_info\nGC.heap_dump\nGC.heap_info\nGC.run\nGC.run_finalization\nVM.class_hierarchy\nVM.classloader_stats\nVM.classloaders\nVM.command_line\nVM.dynlibs\nVM.flags\nVM.info\nVM.log\nVM.metaspace\nVM.native_memory\nVM.print_touched_methods\nVM.set_flag\nVM.stringtable\nVM.symboltable\nVM.system_properties\nVM.systemdictionary\nVM.unlock_commercial_features\nVM.uptime\nVM.version\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("h2",{attrs:{id:"_7-jmc-与-jfr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-jmc-与-jfr"}},[s._v("#")]),s._v(" 7. JMC 与 JFR")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://jdk.java.net/jmc/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Java Mission Control（JMC)"),t("OutboundLink")],1),s._v(" 是 Java 虚拟机平台上的性能监控工具。它包含一个 GUI 客户端，以及众多用来收集 Java 虚拟机性能数据的插件，如 JMX Console（能够访问用来存放虚拟机各个子系统运行数据的 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Java_Management_Extensions#Managed_beans",target:"_blank",rel:"noopener noreferrer"}},[s._v("MXBeans"),t("OutboundLink")],1),s._v("），以及虚拟机内置的高效 profiling 工具 "),t("strong",[s._v("Java Flight Recorder（JFR）")]),s._v("。")]),s._v(" "),t("p",[s._v("JFR 的性能开销很小，在默认配置下平均低于 1%。与其他工具相比，JFR 能够直接访问虚拟机内的数据，并且不会影响虚拟机的优化，适用于生产环境下满负荷运行的 Java 程序。")]),s._v(" "),t("p",[s._v("当启用时，JFR 将记录运行过程中发生的一系列事件。其中包括 Java 层面的事件，如线程事件、锁事件，以及 Java 虚拟机内部的事件，如新建对象、垃圾回收和即时编译事件：")]),s._v(" "),t("ol",[t("li",[s._v("瞬时事件（Instant Event），用户关心的是它们发生与否，例如异常、线程启动事件。")]),s._v(" "),t("li",[s._v("持续事件（Duration Event），用户关心的是它们的持续时间，例如垃圾回收事件。")]),s._v(" "),t("li",[s._v("计时事件（Timed Event），是时长超出指定阈值的持续事件。")]),s._v(" "),t("li",[s._v("取样事件（Sample Event），是周期性取样的事件。取样事件的其中一个常见例子便是方法抽样（Method Sampling），即每隔一段时间统计各个线程的栈轨迹。如果在这些抽样取得的栈轨迹中存在一个反复出现的方法，那么我们可以推测该方法是热点方法。")])]),s._v(" "),t("p",[s._v("开启 JFR 的几种方式：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("启动 JVM 时添加 "),t("code",[s._v("-XX:StartFlightRecording=xxx")]),s._v(" 参数，如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Time fixed")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# JFR 将会在 Java 虚拟机启动 5s 后（对应delay=5s）收集数据，持续 20s（对应duration=20s）。当收集完毕后，JFR 会将收集得到的数据保存至指定的文件中。")]),s._v("\n$ java -XX:StartFlightRecording"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("delay"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5s,duration"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("20s,filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myrecording.jfr,settings"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("profile MyApp\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Continuous, dump on exit")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dumponexit=true 指定 JVM 在退出时保存 JFR 的数据到制定的文件")]),s._v("\n$ java -XX:StartFlightRecording"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dumponexit"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true,filename"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myrecording.jfr MyApp\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Continuous, dump on demand")]),s._v("\n$ java -XX:StartFlightRecording"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("maxage"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("10m,maxsize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("100m,name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SomeLabel MyApp\nStarted recording "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上述 JVM 不会在退出时主动保存 JFR 信息，需要使用 jcmd 输出到文件中。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Use jcmd 38502 JFR.dump name=SomeLabel filename=FILEPATH to copy recording data to file.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("blockquote",[t("p",[s._v("settings=profile 指定了 JFR 所收集的事件类型。默认情况下，JFR 将加载配置文件"),t("em",[s._v("JDK/lib/jfr/default.jfc")]),s._v("，并识别其中所包含的事件类型。当使用了 settings=profile 配置时，JFR 将加载配置文件 "),t("em",[s._v("JDK/lib/jfr/profile.jfc")]),s._v("。该配置文件所包含的事件类型要多于默认的 default.jfc，因此性能开销也要大一些（约为 2%）。default.jfc以及profile.jfc均为 XML 文件。")])])]),s._v(" "),t("li",[t("p",[s._v("使用 jcmd 开启 JFR，有 JFR.start、JFR.dump 和 JFR.stop 三种命令：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("\n$ jcmd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("PID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" JFR.start "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("settings")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("profile "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxage")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("10m "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maxsize")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("150m "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SomeLabel\n\n$ jcmd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("PID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" JFR.dump "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SomeLabel "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("filename")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myrecording.jfr\n\n$ jcmd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("PID"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" JFR.stop "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("SomeLabel\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("更详细的方法见 "),t("a",{attrs:{href:"https://docs.oracle.com/javacomponents/jmc-5-5/jfr-runtime-guide/comline.htm#JFRRT185",target:"_blank",rel:"noopener noreferrer"}},[s._v("帮助文档"),t("OutboundLink")],1),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("使用 JMC 中的 JFR 插件，在图形界面中连接上 Java 进程后，便可以通过图形界面开启 JFR。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/resource/image/39/16/395900f606fd93570196a6dcbac75e16.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://static001.geekbang.org/resource/image/31/6a/31f86bc1cafc569f51e0364d716cab6a.png",alt:""}})])])])])}),[],!1,null,null,null);a.default=e.exports}}]);