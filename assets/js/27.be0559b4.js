(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{752:function(s,a,n){"use strict";n.r(a);var t=n(70),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"ulimit修改最大打开文件数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ulimit修改最大打开文件数"}},[s._v("#")]),s._v(" ulimit修改最大打开文件数")]),s._v(" "),n("p",[s._v("当一个系统有较多socket连接，或者需要打开很多文件时，若某个用户允许打开的最大文件数以及进程数不足，将会导致还用户的任务阻塞。")]),s._v(" "),n("p",[s._v("用户最大打开文件数以及进程数受到系统两个参数制约：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有进程总的最大打开文件数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/fs/file-max\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单个进程的最大进程数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/fs/nr_open\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 系统能够分配的最大 pid")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/kernel/pid_max \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("查看当前进程打开的文件数以及进程数：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大文件数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" -n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大进程数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" -u\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("编辑"),n("code",[s._v("/etc/security/limits.conf")]),s._v("，修改允许打开的最大文件数：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件打开数")]),s._v("\n* soft nofile "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n* hard nofile "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程数")]),s._v("\n* soft proc "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n* hard proc "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("code",[s._v("*")]),s._v("代表所有用户，但如果没有指定特定用户，则"),n("code",[s._v("/etc/security/limits.conf")]),s._v("会被子目录下的"),n("code",[s._v("/etc/security/limits.d/90-nproc.conf")]),s._v("下指定的用户覆盖。因此，为了能够让配置真正的生效，还需要对该文件进行配置：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程数")]),s._v("\n* soft proc "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n* hard proc "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("验证配置是否生效，可以先找到进程的 pid，然后到 "),n("code",[s._v("/proc/{pid}/limits")]),s._v(" 下查看：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("limit                     Soft Limit           Hard Limit           Units     \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("    \nMax stack size            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10485760")]),s._v("             unlimited            bytes     \nMax core "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" size        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                    unlimited            bytes     \nMax resident "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("          unlimited            unlimited            bytes     \nMax processes             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("                processes \nMax "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" files            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v("                files     \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("       \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("参考："),n("a",{attrs:{href:"https://feichashao.com/ulimit_demo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://feichashao.com/ulimit_demo/"),n("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);