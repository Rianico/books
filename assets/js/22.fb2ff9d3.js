(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{747:function(s,t,a){"use strict";a.r(t);var e=a(70),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"修复postfix邮件服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修复postfix邮件服务"}},[s._v("#")]),s._v(" 修复postfix邮件服务")]),s._v(" "),a("p",[s._v("由于CDH集群的Alert Publisher服务依赖于操作系统的postfix服务，然而在按照网上教程配置并启动postfix服务后，Alert Publisher服务输出日志如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-04-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":43:15,174 ERROR org.apache.camel.processor.DefaultErrorHandler: Failed delivery "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" exchangeId: ID-xx-xx-xxxx-44049-1553768893026-0-177733. Exhausted after delivery attempt: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" caught: org.springframework.mail.MailSendException: Mail server connection failed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" nested exception is javax.mail.MessagingException: Could not connect to SMTP host: localhost, port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  nested exception is:\n        java.net.ConnectException: 拒绝连接. Failed messages: javax.mail.MessagingException: Could not connect to SMTP host: localhost, port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-05-30 02:21:22,415 ERROR com.cloudera.enterprise.SafeAvroResponderServlet: Error procesing Avro request\njava.io.IOException: Unexpected length "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("too long"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1010792557")]),s._v(", max:10485760\n        at com.cloudera.enterprise.SafeAvroHttpTransceiver.checkLength"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SafeAvroHttpTransceiver.java:137"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("从日志可以看出，Alert Publisher会对本地25端口发送请求消息，但在多次失败后，最终导致请求消息累积过长，从而抛出异常，服务停止输出日志。")]),s._v(" "),a("p",[s._v("查看25端口占用，发现没有任何服务，因此postfix服务实质上没有启动成功，在"),a("code",[s._v("/var/log/mail.log")]),s._v("下有没有看到任何关于启动相关的日志，最后通过启动"),a("code",[s._v("rsyslog")]),s._v("服务来监听25端口的相关日志，可以看到日志以下输出：")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("cm postfix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4322")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fatal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("postfix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("main"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("cf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" parameter default_privs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" unknown user name value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nobody\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其实就是由于没有"),a("code",[s._v("nobody")]),s._v("用户，执行"),a("code",[s._v("postfix check")]),s._v("命令也可以看到这个报错，再结合这篇文章"),a("a",{attrs:{href:"https://amoldighe.github.io/2016/09/14/gitlab-postfix-issue/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Gitlab - postfix setup issues"),a("OutboundLink")],1),s._v("，在"),a("code",[s._v("/etc/passd")]),s._v("中添加如下用户：")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("nobody"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("Nobody"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sbin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nologin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再次启动postfix服务，启动成功。")])])}),[],!1,null,null,null);t.default=n.exports}}]);