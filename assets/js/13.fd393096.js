(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{739:function(e,s,n){"use strict";n.r(s);var a=n(70),t=Object(a.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"关于-mkfs-ex4-的-inode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关于-mkfs-ex4-的-inode"}},[e._v("#")]),e._v(" 关于 mkfs.ex4 的 inode")]),e._v(" "),n("p",[e._v("最近在工作中遇到服务器磁盘格式化的问题，对相关查询命令进行了一点挖掘，命令如下：")]),e._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[e._v("mkfs.ext4 /dev/sda1\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br")])]),n("p",[e._v("查询资料后发现，上述命令存在着优化空间，可以增大bytes per inode来节省部分磁盘空间，默认按照"),n("strong",[e._v("每16k建立一个inode")]),e._v("来得到inode数量。 inode：用于存储文件的元数据，inode越多，磁盘可以存放的文件数量越多，但是过多的inode会占用磁盘空间（一个inode占用128/256字节），若磁盘上的文件都是大文件，显然16k会导致建立较多不必要的inode，从而浪费磁盘空间。")]),e._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# -T 指定默认参数，其中largefile 每1M建立一个inode")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# -n 为模拟运行，但不格式化")]),e._v("\nmkfs.ext4 -T largefile /dev/sdc1\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 查看每个inode占用的字节")]),e._v("\ndumpe2fs -h /dev/sda1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Inode size"')]),e._v("\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("访问文件的实际流程： 访问("),n("code",[e._v("ls -i")]),e._v(")文件（夹）名对应的 inode 号码 -> 通过 inode 号码，获取 inode 信息 -> 根据 inode 信息，找到文件数据所在的 block，读取数据。")]),e._v(" "),n("p",[e._v("所以目录实际上只存储了名字跟inode号码，如果只有读权限，那么只能访问到目录内的名字，其余信息都存在inode里，而访问inode则需要执行权限（X），这也可以解释为什么目录下文件的权限为"),n("code",[e._v("-rwx")]),e._v("，由于目录只有"),n("code",[e._v("-r--")]),e._v(",从而导致有文件权限的用户无法访问目录下文件的原因。")]),e._v(" "),n("p",[e._v("由此可以看出，Linux的-rwx权限是通过inode来实现的。")])])}),[],!1,null,null,null);s.default=t.exports}}]);