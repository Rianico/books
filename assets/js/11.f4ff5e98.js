(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{737:function(t,s,e){"use strict";e.r(s);var a=e(70),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"_1-xfs安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-xfs安装"}},[t._v("#")]),t._v(" 1. xfs安装")]),t._v(" "),e("p",[t._v("最新搭建Hadoop集群，了解到了xfs文件系统，xfs官网地址："),e("a",{attrs:{href:"https://xfs.org/index.php/Main_Page",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://xfs.org/index.php/Main_Page"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("磁盘：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("device")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("parted")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("comment")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("/dev/sdb")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("/data1")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("HDD，7200转")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("/dev/sdc")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("/data2")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("HDD，7200转")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("...")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("...")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("...")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("/dev/sdm")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("/data12")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("HDD，7200转")])])])]),t._v(" "),e("p",[t._v("1.首先安装xfs")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" xfsprogs\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("2.对磁盘进行分区，可参考下列脚本，注意parted的时候使用"),e("code",[t._v("mkpart primary 1 100%")]),t._v("达到逻辑分区对齐的作用")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#! /bin/bash")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" -le "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("j")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" $i"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{printf "%c",97+'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("umount")]),t._v(" /data"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("parted")]),t._v(" /dev/sd"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$j")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("FORMAT\nrm 1\nmklabel gpt\nIgnore\nYes\nmkpart primary 1 100%\nquit\nFORMAT")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("let")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("i+1\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br")])]),e("p",[t._v("3.格式化分区并挂载")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#! /bin/bash")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" -le "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("j")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" $i"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{printf "%c",97+'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\nmkfs.xfs -f /dev/sd"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${j}")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" /dev/sd"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${j}")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" /data"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("\nFORMAT\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("let")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("i+1\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br")])]),e("p",[t._v("4.修改"),e("code",[t._v("/etc/fstab")]),t._v("添加以下配置")]),t._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("/dev/sdb1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("             /data1                  xfs    defaults        1 2")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("/dev/sdc1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("             /data2                  xfs    defaults        1 2")]),t._v("\n...\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("/dev/sdm1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("             /data12                  xfs    defaults        1 2")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("p",[t._v("5.执行"),e("code",[t._v("df -Th")]),t._v("检查挂载以及格式化")]),t._v(" "),e("div",{staticClass:"language-properties line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-properties"}},[e("code",[e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("/dev/sdb1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     xfs    5.5T   34M  5.5T   1% /data1")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("/dev/sdc1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     xfs    5.5T   34M  5.5T   1% /data2")]),t._v("\n...\n"),e("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("/dev/sdm1")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("     xfs    5.5T   34M  5.5T   1% /data12")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("h2",{attrs:{id:"_2-xfs-与ext4-的性能对比"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-xfs-与ext4-的性能对比"}},[t._v("#")]),t._v(" 2. xfs 与ext4 的性能对比")]),t._v(" "),e("p",[t._v("为验证 xfs 对比原来 ext4 的读写性能，现对两种文件系统的 I/O 表现做一个测试对比")]),t._v(" "),e("p",[t._v("各磁盘文件系统参数如下：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# xfs,默认配置")]),t._v("\nmkfs.xfs -f /dev/sdb1\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ext4,默认配置")]),t._v("\nmkfs.ext4 /dev/sdc1\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br")])]),e("h3",{attrs:{id:"_2-1-dd命令测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-dd命令测试"}},[t._v("#")]),t._v(" 2.1 dd命令测试")]),t._v(" "),e("p",[t._v("首先使用 dd 命令进行测试，总共 10G 文件读取写入，测试磁盘的顺序读写性能，绕过磁盘 cache，测试命令如下（以 "),e("code",[t._v("/dev/sdb1")]),t._v(" 挂载在 "),e("code",[t._v("/data1")]),t._v(" 为例）：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写测试，每次写入4K，共10G,使用oflag=direct绕过cache")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/zero "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data1/test.log "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("4k "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2500000")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("oflag")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 读测试，每次读取4K，共10G,使用iflag=direct绕过cache")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/sdb1 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("4k "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2500000")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("iflag")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写测试，每次写入1M，共10G,使用oflag=direct绕过cache")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/zero "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data1/test.log "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1M "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("oflag")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 读测试，每次读取1M，共10G,使用iflag=direct绕过cache")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/sdb1 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/null "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1M "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("iflag")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br")])]),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("磁盘类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("读速度(4KB/per block)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("写速度（4KB/per block)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("读速度(1MB/per block)")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("写速度（1MB/per block)")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("xfs")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("47.8 MB/秒")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("42.2 MB/秒")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("225 MB/秒")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("265 MB/秒")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("ext4")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("47.2 MB/秒")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("38.3 MB/秒")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("225 MB/秒")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("264 MB/秒")])])])]),t._v(" "),e("p",[t._v("结论：从上面可以看出，xfs 从综合读写来看，都会比 ext4 略强，但差距十分小，还不能够说有明显提升。")]),t._v(" "),e("h3",{attrs:{id:"_2-2-fio测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-fio测试"}},[t._v("#")]),t._v(" 2.2 fio测试")]),t._v(" "),e("p",[t._v("接下来使用 fio 工具进行更加具体的测试，安装详见"),e("a",{attrs:{href:"https://github.com/axboe/fio",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("p",[t._v("fio 执行命令如下（以"),e("code",[t._v("/dev/sdb1")]),t._v("为例）：")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("fio -name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("disktest -runtime"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" -iodepth"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" -ioengine"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("libaio -group_reporting -direct"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -numjobs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -thread -rw"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rw -bs"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("4k -filename"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/sdb1\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("ul",[e("li",[t._v("name：测试名称，随便取个即可")]),t._v(" "),e("li",[t._v("runtime：运行时间为 300s")]),t._v(" "),e("li",[t._v("rw：读写模式，以 rw（读写混合），randrw（随机读写混合）为测试用例")]),t._v(" "),e("li",[t._v("bs：测试使用的块大小")]),t._v(" "),e("li",[t._v("iodepth：io 队列最大深度")]),t._v(" "),e("li",[t._v("filename：测试的磁盘")]),t._v(" "),e("li",[t._v("direct：1 表示绕过磁盘 cache")]),t._v(" "),e("li",[t._v("numjobs：指定线程数量")]),t._v(" "),e("li",[t._v("thread：fio 默认会使用 fork() 创建 job，如果这个选项设置的话，fio 将使用 pthread_create 来创建线程")]),t._v(" "),e("li",[t._v("group_reporting：查看统计后的综合报告")])]),t._v(" "),e("p",[e("strong",[t._v("单线程下的吞吐量 & iops（numjobs=1）")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_4k")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_4k")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_1M")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_1M")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("118MB/s & 28.8k")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("120MB/s & 29.3k")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("145MB/s & 138")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("151MB/s & 143")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("118MB/s & 28.8k")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("120MB/s & 29.3k")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("144MB/s & 137")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("151MB/s & 142")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("随机读")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("780kB/s & 190")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("791kB/s & 193")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("50.6MB/s & 48")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("38.2MB/s & 36")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("随机写")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("776kB/s & 189")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("788kB/s & 192")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("50.4MB/s & 48")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("37.0MB/s & 36")])])])]),t._v(" "),e("p",[e("strong",[t._v("16 线程下的吞吐量 & iops（numjobs=16）")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_4k")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_4k")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_1M")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_1M")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("194MB/s & 47.5k")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("196MB/s & 47.9k")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("2268MB/s & 2182")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("2229MB/s & 2125")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("195MB/s & 47.5k")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("197MB/s & 47.0k")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("2279MB/s & 2172")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("2241MB/s & 2136")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("随机读")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("850kB/s & 207")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("845kB/s & 206")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("49.0MB/s & 47")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("50.7MB/s & 48")])])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("随机写")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("858kB/s & 209")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("852kB/s & 208")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("50.8MB/s & 48")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("51.5MB/s & 49")])])])])]),t._v(" "),e("p",[e("strong",[t._v("32 线程下的吞吐量 & iops（numjobs=32）")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_4k")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_4k")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_1M")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_1M")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("199MB/s & 48.6k")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("195MB/s & 47.6k")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("2208MB/s & 2107")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("2207MB/s & 2104")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("199MB/s & 48.6k")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("195MB/s & 47.6k")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("2211MB/s & 2109")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("2209MB/s & 2107")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("随机读")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("809kB/s & 197")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("804kB/s & 196")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("49.9MB/s & 47")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("49.8MB/s & 47")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("随机写")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("809kB/s & 197")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("802kB/s & 195")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("50.2MB/s & 47")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("50.1MB/s & 47")])])])]),t._v(" "),e("p",[t._v("可以看到，随着线程数增加，xfs 性能逐渐超过 ext4，但差距仍然很小，最后再看下 32 线程下，5MB（取Kafka接收消息的最大大小）顺序读写的对比。")]),t._v(" "),e("p",[e("strong",[t._v("32 线程，5MB 的吞吐量 & iops（numjobs=32）")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_5M")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_5M")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("1399MB/s & 266")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("1392MB/s & 265")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[e("strong",[t._v("1396MB/s & 266")])]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("1390MB/s & 265")])])])]),t._v(" "),e("p",[t._v("由上趋势可以看出，"),e("strong",[t._v("xfs 并不能带来显著的提升，但是可以看出在负载越大的情况下，xfs的稳定性相对会更好")]),t._v("。")]),t._v(" "),e("blockquote",[e("p",[t._v("NOTE：xfs 其实已经相当成熟，基本不需要其他优化，网上的调优资料都是好几年前的了，按着调整只会造成反效果（个人亲身经历，瞎折腾一天），官网也写明了默认参数基本已经有了最好的性能表现。")])]),t._v(" "),e("p",[t._v("上述测试是在 HDD 硬盘上进行的，在 HDD 硬盘方面得出的结论跟 "),e("a",{attrs:{href:"https://scalegrid.io/blog/xfs-vs-ext4-comparing-mongodb-performance-on-aws-ec2",target:"_blank",rel:"noopener noreferrer"}},[t._v("XFS vs EXT4 – Comparing MongoDB Performance on AWS EC2"),e("OutboundLink")],1),t._v(" 基本一致，文章大致表达的意思是：在高性能磁盘下，xfs 对比 ext4 性能上高了一个级别，而在中小型机器的资源下，xfs 并没法带来肉眼可见的提升。由于没有条件进行 SDD 的测试，所以这篇文章对 SDD 的测试可以作为一个参考。")]),t._v(" "),e("h2",{attrs:{id:"_3-结论"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-结论"}},[t._v("#")]),t._v(" 3. 结论")]),t._v(" "),e("p",[t._v("关于 xfs 以及 ext4 的对比网上有很多资料，结合知乎的一个问答"),e("a",{attrs:{href:"https://www.zhihu.com/question/24413471/answer/38883787",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么CENTOS 7.0开始选择XFS作为默认的文件系统？XFS相比ext有什么优点？"),e("OutboundLink")],1),t._v("，个人认为，在未来数据量未来越大的情况下，ext4 的单个文件大小最大只支持到 16T，未来可能会做改进或者出现 ext5 等新格式，但是省电事情总是好的，因此 xfs 从稳定性上来看会更好。")]),t._v(" "),e("h2",{attrs:{id:"_4-xfs-的一些注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-xfs-的一些注意事项"}},[t._v("#")]),t._v(" 4. xfs 的一些注意事项")]),t._v(" "),e("p",[t._v("xfs 格式化的时候，可以指定 block 块的大小，但需要主要不能超过系统的 "),e("code",[t._v("PAGE_SIZE")]),t._v("，否则会挂载失败。")]),t._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("mkfs.xfs -f /dev/sda1 -b "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("size")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);