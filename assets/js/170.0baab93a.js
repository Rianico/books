(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{893:function(s,a,t){"use strict";t.r(a);var n=t(70),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"spark-shell-快速测试代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spark-shell-快速测试代码"}},[s._v("#")]),s._v(" spark-shell 快速测试代码")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SPARK_DIST_CLASSPATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("hadoop classpath"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HADOOP_CONF_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/cloudera/parcels/CDH/etc/hadoop \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果需要用到 lzo 且有安装的话")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LD_LIBRARY_PATH")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("LD_LIBRARY_PATH:/opt/cloudera/parcels/HADOOP_LZO/lib/hadoop/lib/native:/opt/cloudera/parcels/CDH/lib/hadoop/lib/native/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("启动 spark2-shell：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("// kerberos\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JVMFLAGS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.auth.login.config=/path/to/kafka_client_jaas.conf -Dsun.security.krb5.debug=true"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KAFKA_OPTS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Djava.security.auth.login.config=/path/to/kafka_client_jaas.conf"')]),s._v("\nspark2-shell --master local"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --deploy-mode client  --keytab /path/to/xxx.keytab --principal xxx@xxx.xxx --jars /home/zxk/spark-sql-kafka-0-10_2.11-2.1.0.cloudera1.jar --files /path/to/kafka_client_jaas.conf --conf "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spark.driver.extraJavaOptions=-XX:+UseG1GC -Djava.security.auth.login.config=./kafka_client_jaas.conf"')]),s._v(" --conf "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spark.executor.extraJavaOptions=-XX:+UseG1GC -Djava.security.auth.login.config=./kafka_client_jaas.conf"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启 Schema 推测")]),s._v("\nspark.read.format"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"csv"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n.option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"header"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n.option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inferSchema"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n.load"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("mnmFile"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h2",{attrs:{id:"_1-dataframe-structtype"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-dataframe-structtype"}},[s._v("#")]),s._v(" 1. Dataframe + StructType")]),s._v(" "),t("div",{staticClass:"language-scala line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-scala"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("spark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("types")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("spark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("implicits")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// val structype = StructType(Seq(StructField("name", StringType), StructField("time", LongType)))')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("val")]),s._v(" structype "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" StructType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Seq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("StructField"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" StringType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" StructField"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" StringType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("val")]),s._v(" rdd "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parallelize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Seq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zxk,1584671303000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("row "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("=>")]),s._v(" Row"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fromSeq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("row"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("split"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('","')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// val rdd = sc.parallelize(Seq("zxk,1584671303000")).map(row => row.split(",")).map(row => Row(row(0), row(1).toLong))')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("val")]),s._v(" df "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" spark"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("createDataFrame"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rdd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" structype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("withColumn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" from_unixtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("show\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("commons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("StringEscapeUtils"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("write\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"badRecordsPath"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/haohan/zxk/data/badRecordsPath"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("option"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sep"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" StringEscapeUtils"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("unescapeJava"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sep"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SaveMode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/user/haohan/zxk/data"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h2",{attrs:{id:"_2-开启-tungsten-sort"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-开启-tungsten-sort"}},[s._v("#")]),s._v(" 2. 开启 tungsten-sort")]),s._v(" "),t("p",[s._v("Spark RDD 如果想要使用 tungsten-sort 功能，则需要开启堆外内存并指定大小："),t("code",[s._v("-conf spark.memory.offHeap.enabled=true --conf spark.memory.offHeap.size=1g")]),s._v("。")]),s._v(" "),t("p",[s._v("使用该功能需要满足几个条件：")]),s._v(" "),t("ol",[t("li",[s._v("partition > spark.shuffle.sort.bypassMergeThreshold（默认200），并且小于16777216")]),s._v(" "),t("li",[s._v("无聚合操作（如groupBy，reduceBy等）")]),s._v(" "),t("li",[s._v("序列化时，单条记录不能大于 128 MB")]),s._v(" "),t("li",[s._v("Serializer 需要支持 relocation，如 Kryo。")])]),s._v(" "),t("p",[s._v("目前 SparkSql 在开启 tungsten-sort 后，在符合条件的场景下会自动应用，而 RDD 编程需要自己注意下使用的算子。")]),s._v(" "),t("h2",{attrs:{id:"_3-spark-开启-kerberos-debug-信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-spark-开启-kerberos-debug-信息"}},[s._v("#")]),s._v(" 3. Spark 开启 Kerberos debug 信息")]),s._v(" "),t("p",[s._v("可以在 Hadoop 中设置环境变量开启 Kerberos 调试信息：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HADOOP_JAAS_DEBUG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("或者通过设置 Java 的系统参数来记录 Kerberos 以及 SPNEGO/REST 认证的日志：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("-Dsun.security.krb5.debug"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -Dsun.security.spnego.debug"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Spark 中可以在 AM 中开启：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("spark.yarn.appMasterEnv.HADOOP_JAAS_DEBUG true\nspark.yarn.am.extraJavaOptions -Dsun.security.krb5.debug=true -Dsun.security.spnego.debug=true\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_4-kerberos-环境下与-oozie-结合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-kerberos-环境下与-oozie-结合"}},[s._v("#")]),s._v(" 4. Kerberos 环境下与 Oozie 结合")]),s._v(" "),t("p",[s._v("这种场景下，Spark 需要的一些凭据都是交由 Oozie 完成：")]),s._v(" "),t("ul",[t("li",[s._v("The YARN resource manager.")]),s._v(" "),t("li",[s._v("The local HDFS filesystem.")]),s._v(" "),t("li",[s._v("Any remote HDFS filesystems used as a source or destination of I/O.")]),s._v(" "),t("li",[s._v("Hive —if used.")]),s._v(" "),t("li",[s._v("HBase —if used.")]),s._v(" "),t("li",[s._v("The YARN timeline server, if the application interacts with this.")])]),s._v(" "),t("p",[s._v("如果 Spark 再次去获取，很可能会导致异常退出，因此需要设置一些参数避免 Spark 主动去获取一些服务的凭据：")]),s._v(" "),t("p",[s._v("2.2 之前：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("spark.yarn.security.tokens.hive.enabled   false\nspark.yarn.security.tokens.hbase.enabled  false\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("2.2 开始：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[s._v("spark.yarn.security.credentials.hive.enabled false\nspark.yarn.security.credentials.hbase.enabled false\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("同时不能设置 "),t("code",[s._v("spark.yarn.access.namenodes")]),s._v(" 属性。")]),s._v(" "),t("h2",{attrs:{id:"_5-spark-写-hdfs-超时时间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-spark-写-hdfs-超时时间"}},[s._v("#")]),s._v(" 5. Spark 写 hdfs 超时时间")]),s._v(" "),t("div",{staticClass:"language-scala line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-scala"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// spark config")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("val")]),s._v(" sc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" SparkConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设定写 HDFS 超时时间")]),s._v("\n\tsetConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"spark.hadoop.dfs.datanode.socket.write.timeout"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" timeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("buildSparkContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);