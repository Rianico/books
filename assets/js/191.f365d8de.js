(window.webpackJsonp=window.webpackJsonp||[]).push([[191],{914:function(s,a,n){"use strict";n.r(a);var t=n(70),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"_1-部署环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-部署环境"}},[s._v("#")]),s._v(" 1. 部署环境")]),s._v(" "),n("ul",[n("li",[s._v("Python： 2.7.5")]),s._v(" "),n("li",[s._v("Nodejs： 10.23.0")]),s._v(" "),n("li",[s._v("Java： openjdk-1.8.0_181")]),s._v(" "),n("li",[s._v("OS： CentOs 7.6")])]),s._v(" "),n("h2",{attrs:{id:"_3-1-制作-rpm-包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-制作-rpm-包"}},[s._v("#")]),s._v(" 3.1 制作 rpm 包")]),s._v(" "),n("p",[s._v("安装必备组件：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libffi-devel "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" gcc gcc-c++ ant asciidoc cyrus-sasl-devel cyrus-sasl-gssapi cyrus-sasl-plain krb5-devel libtidy libxml2-devel libxslt-devel openldap-devel python-devel sqlite-devel openssl-devel mysql-devel openldap-devel python-devel sqlite-devel gmp-devel maven "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" rpmdevtools pip\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果系统没有安装 pip，则执行 yum -y install pip")]),s._v("\npip "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --upgrade pip\npip "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" wheel\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip install daemon")]),s._v("\npip "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" logilab-astng\npip "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ipython<6.0'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("为 maven 添加阿里云镜像：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/maven/settings.xml ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mirror"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("nexus-aliyun"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("mirrorOf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("central"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/mirrorOf"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Nexus aliyun"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("http://maven.aliyun.com/nexus/content/groups/public"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/url"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/mirror"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("配置 npm 为华为镜像源，并升级 node 到 10.23.0 版本：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry https://mirrors.huaweicloud.com/repository/npm/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g n\nyum -y remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v("\nn "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.23")]),s._v(".0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("生成 rpm 构建目录："),n("code",[s._v("rpmdev-setuptree && cd ~/rpmbuild")]),s._v("，会在当前用户的 $HOME 目录下生成一个 "),n("code",[s._v("rpmbuild")]),s._v(" 文件夹，结构如下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/rpmbuild/\n├── BUILD\n├── BUILDROOT\n├── RPMS\n├── SOURCES\n├── SPECS\n└── SRPMS\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("下载 hue 源码到 SOURCES 文件夹下："),n("code",[s._v("wget --no-check-certificate -P ~/rpmbuild/SOURCES https://github.com/cloudera/hue/archive/release-4.8.0.tar.gz")]),s._v("。")]),s._v(" "),n("p",[s._v("编写构建相关的描述文件 "),n("code",[s._v("vim ~/rpmbuild/SPECS/hue.spec")]),s._v("，内容如下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("%define __os_install_post %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("?__debug_package:/usr/lib/rpm/brp-strip %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("__strip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%define __debug_install_post %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_rpmconfigdir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/find-debuginfo.sh %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("?_find_debuginfo_opts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%{_builddir}/%{?buildsubdir}"')]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%define _python_bytecompile_errors_terminate_build "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n%define debug_package %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%define _unpackaged_files_terminate_build "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n%define _use_internal_dependency_generator "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n%define __jar_repack %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%define __prelink_undo_cmd %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("nil"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nName:           hue\nVersion:        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.8")]),s._v(".0\nRelease:        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("?dist"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nSummary:        Hue is a graphical user interface to operate and develop applications "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Apache Hadoop.\n\nLicense:        GPLv3\nURL:            https://github.com/cloudera/hue\nSource0:        %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".tgz\nAutoReqProv:    no\nPrefix:        /usr/hdp/current\n\n%description\nHue is a graphical user interface to operate and develop applications "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Apache Hadoop.\n\n%prep\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxf %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("_sourcedir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".tgz -C %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" -f %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("-%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("version"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%build\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/bin\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# export SYS_PYTHON=`which python`")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# export SKIP_PYTHONDEV_CHECK=true  ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry https://mirrors.huaweicloud.com/repository/npm/\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" apps\n\n%install\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RPM_BUILD_ROOT")]),s._v("/*\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RPM_BUILD_ROOT")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -rf %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$RPM_BUILD_ROOT")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%files\n%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("prefix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n%changelog\n- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("/11/05 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NEW"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 初次构建 hue "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" 包。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br")])]),n("p",[s._v("去掉 rpath 检查：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ~/.rpmmacros")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${QA_CHECK_RPATHS"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":-")]),s._v("}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1yY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" /usr/lib/rpm/check-rpaths "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注释该代码，位于倒数第二行：")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# case "${QA_CHECK_RPATHS:-}" in [1yY]*) /usr/lib/rpm/check-rpaths ;; esac \\')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("编写脚本 "),n("code",[s._v("vim ~/rpmbuild/build.sh")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/usr/bin/env bash")]),s._v("\nrpmbuild -bs ~/rpmbuild/SPECS/hue.spec\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("QA_RPATHS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" 0x0001"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("0x0002 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" rpmbuild --nodeps --rebuild ~/rpmbuild/SRPMS/hue-4.8.0-1.el7.src.rpm \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("执行脚本 "),n("code",[s._v("nohup sh ./build.sh &")]),s._v("，等待编译完成，过程一般需要持续两三个小时。")]),s._v(" "),n("p",[s._v("编译后的目录结构如下：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/rpmbuild/\n├── BUILD\n├── BUILDROOT\n├── build.sh\n├── nohup.out\n├── RPMS\n│   └── x86_64\n│       └── hue-4.8.0-1.el7.x86_64.rpm\n├── SOURCES\n│   └── hue-4.8.0.tgz\n├── SPECS\n│   └── hue.spec\n└── SRPMS\n    └── hue-4.8.0-1.el7.src.rpm\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("其中 "),n("code",[s._v("hue-4.8.0-1.el7.x86_64.rpm")]),s._v(" 就是 hue 的 rpm ，安装后位于 "),n("code",[s._v("/usr/hdp/current/hue")]),s._v(" 。")]),s._v(" "),n("blockquote",[n("p",[s._v("NOTE：由于 hue 在编译的时候，使用了内置的虚拟环境，会根据编译时的位置，将路径写死在编译出来后的文件里（包括编译后的二进制二建），因此这样也导致了按照网上的教程走下来， 很多地方都出现了问题。hue 安装后是不能移动位置的，官方给出的解决方案也只是删除目录下的 apps.reg 文件以及 apps 文件夹，然后重新编译。")])]),s._v(" "),n("blockquote",[n("p",[s._v("NOTE： Nodejs 版本一定要保证是 10.23.0，官方文档只宣称需要 node v10+ ，但实际测试的时候，使用 v10 的第一个版本，会与其中的某个依赖产生冲突，从而导致编译失败！")])]),s._v(" "),n("p",[s._v("参考教程：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://rpm-packaging-guide.github.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("RPM Packaging Guide"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://bbs.huaweicloud.com/forum/thread-38327-1-1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("RPM打包流程、示例及常见问题"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("最后将 "),n("code",[s._v("hue-4.8.0-1.el7.x86_64.rpm")]),s._v(" 放置于任意一个 yum 源仓库，即可通过 "),n("code",[s._v("yum -y install hue")]),s._v(" 安装。")])])}),[],!1,null,null,null);a.default=e.exports}}]);