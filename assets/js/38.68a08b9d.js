(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{763:function(s,a,t){"use strict";t.r(a);var e=t(70),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"iostat-磁盘分析工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iostat-磁盘分析工具"}},[s._v("#")]),s._v(" iostat 磁盘分析工具")]),s._v(" "),t("p",[s._v("iostat是I/O statistics（输入/输出统计）的缩写，用来动态监视系统的磁盘操作活动。")]),s._v(" "),t("p",[s._v("iostat 命令语法："),t("code",[s._v("iostat [参数] [时间间隔] [次数]")])]),s._v(" "),t("p",[s._v("通过 iostat 方便查看 CPU、网卡、tty设备、磁盘、CD-ROM 等设备的活动情况,及负载信息。")]),s._v(" "),t("ul",[t("li",[s._v("-C 显示CPU使用情况")]),s._v(" "),t("li",[s._v("-d 显示磁盘使用情况")]),s._v(" "),t("li",[s._v("-k 以 KB 为单位显示")]),s._v(" "),t("li",[s._v("-m 以 M 为单位显示")]),s._v(" "),t("li",[s._v("-N 显示磁盘阵列(LVM) 信息")]),s._v(" "),t("li",[s._v("-n 显示NFS 使用情况")]),s._v(" "),t("li",[s._v("-p[磁盘] 显示磁盘和分区的情况")]),s._v(" "),t("li",[s._v("-t 显示终端和CPU的信息")]),s._v(" "),t("li",[s._v("-x 显示详细信息")]),s._v(" "),t("li",[s._v("-V 显示版本信息")])]),s._v(" "),t("p",[t("strong",[s._v("常用命令")]),s._v("：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 I/O 具体信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iostat -x")]),s._v("\navg-cpu:  %user   %nice %system %iowait  %steal   %idle\n           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.07")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.33")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.46")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("97.14")]),s._v("\n\nDevice:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util\nsdv               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.00")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11680.00")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("315.68")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.09")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.74")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.74")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.89")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.00")]),s._v("\nsdw               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("106.00")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16704.00")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("315.17")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.80")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.25")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.25")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.65")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.50")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看磁盘吞吐")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iostat -mtx 1 1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[t("strong",[s._v("磁盘负载信息的一些经验")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("如果 %iowait 的值过高，表示硬盘存在 I/O 瓶颈；")]),s._v(" "),t("li",[s._v("如果 %idle 值高但系统响应慢时，有可能是 CPU 等待分配内存，此时应加大内存容量；")]),s._v(" "),t("li",[s._v("如果 %idle 值如果持续低于 10，表明系统中最需要解决的资源是 CPU。")])]),s._v(" "),t("p",[t("strong",[s._v("各项参数的解释")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("tps：该设备每秒的传输次数。多个逻辑请求可能会被合并为 “一次 I/O 请求”，“一次传输”请求的大小是未知的")]),s._v(" "),t("li",[s._v("rrqm/s、wrqm/s: 每秒进行 merge 的读、写操作数目，如果两个 I/O 发生在相邻区域，可以合并为一个 I/O\n"),t("ul",[t("li",[s._v("当前磁盘常见有三种调度算法：noop（固态）、deadline 和 cfq，可以通过 "),t("code",[s._v("/sys/block/磁盘设备/queue/scheduler")]),s._v(" 查看")])])]),s._v(" "),t("li",[s._v("r/s、w/s: 每秒完成的读、写 I/O 设备次数。即 rio/s")]),s._v(" "),t("li",[s._v("rsec/s、wsec/s: 每秒读、写扇区数")]),s._v(" "),t("li",[s._v("rkB/s、wkB/s: 每秒读、写的 KB 字节数。是 rsect/s、wsec/s 的一半，因为每扇区大小为512字节")]),s._v(" "),t("li",[t("strong",[s._v("avgrq-sz")]),s._v(": 平均每次设备 I/O 操作扇区数目，反应了是大 I/O 还是小 I/O，上限值取决于 "),t("code",[s._v("/sys/block/sdc/queue/max_sectors_kb")]),s._v("  除以扇区大小（512 bytes）。")]),s._v(" "),t("li",[t("strong",[s._v("avgqu-sz")]),s._v(": 平均 I/O 队列长度，可以反映出当前磁盘的负载\n"),t("ul",[t("li",[s._v("队列长度可以通过 "),t("code",[s._v("/sys/block/磁盘设备/queue/nr_requests")]),s._v(" 修改")])])]),s._v(" "),t("li",[s._v("await: 平均每次设备 I/O 操作的等待时间 (毫秒)。")]),s._v(" "),t("li",[s._v("svctm: 平均每次设备 I/O 操作的服务时间 (毫秒)，有争议的指标。")]),s._v(" "),t("li",[t("strong",[s._v("%util")]),s._v(": 一秒中有百分之多少的时间用于 I/O 操作，即被 io 消耗的 cpu 百分比 。\n"),t("ul",[t("li",[s._v("这个指标不能说明磁盘的极限，当采样时间为 1s，假设每个 I/O 需要 0.1s，并发提交（处理）与串行提交（处理）得到的分别为 10% 与 100%")])])])]),s._v(" "),t("p",[s._v("常用的一些磁盘优化手段：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("增大队列长度 "),t("code",[s._v("/sys/block/磁盘设备/queue/nr_requests")]),s._v(" 可以提高合并 I/O，但会增加内存占用，默认 128")])]),s._v(" "),t("li",[t("p",[s._v("增大预读 "),t("code",[s._v("/sys/block/磁盘设备/queue/read_ahead_kb")]),s._v(" ，默认 128 KB")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("os_dev")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" boot"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1p'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$3")]),s._v("}'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("}'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s![0-9]!!g'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disk_List")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("lsscsi "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" -F "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NF")]),s._v("}'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -vi Expander"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v $os_dev"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disk_List")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$disk_List")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$disk_List")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /sys/block/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v("/queue/read_ahead_kb\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])]),s._v(" "),t("p",[s._v("参考：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://bean-li.github.io/dive-into-iostat/",target:"_blank",rel:"noopener noreferrer"}},[s._v("深入理解iostat"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/cobbliu/p/5389556.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux IO Scheduler（Linux IO 调度器）"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);