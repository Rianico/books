(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{866:function(e,t,r){"use strict";r.r(t);var s=r(70),o=Object(s.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"cdh-集群修改-ip-為私網-ip"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#cdh-集群修改-ip-為私網-ip"}},[e._v("#")]),e._v(" CDH 集群修改 IP 為私網 IP")]),e._v(" "),r("h2",{attrs:{id:"设置私网地址"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#设置私网地址"}},[e._v("#")]),e._v(" 设置私网地址")]),e._v(" "),r("p",[e._v("最近因为网络改造，需要将集群节点内部通讯方式改为私网通讯，因此需要对集群配置做出更改，过程如下：")]),e._v(" "),r("ol",[r("li",[r("p",[e._v("cm 界面上所有服务都勾选 "),r("strong",[e._v("通配符")]),e._v(" 选项，开启多网卡监听。如果外部 client 仍需通过公网通信，还需设置 "),r("code",[e._v("dfs.client.use.datanode.hostname")]),e._v(" 为 true 以使用 hostname 而非私网 IP 通信。（详见 "),r("a",{attrs:{href:"https://hadoop.apache.org/docs/r2.6.0/hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("HDFS Support for Multihomed Networks"),r("OutboundLink")],1),e._v(")")])]),e._v(" "),r("li",[r("p",[e._v("暂停所有节点上的 "),r("code",[e._v("cloudera-scm-agent")]),e._v(" 服务，暂停cm主节点的 "),r("code",[e._v("cloudera-scm-server")]),e._v(" 服务。")])]),e._v(" "),r("li",[r("p",[e._v("批量修改所有节点上的 "),r("code",[e._v("/etc/cloudera-scm-agent/config.ini")]),e._v(" 配置，将 "),r("code",[e._v("server_host")]),e._v(" 为cm主节点的 IP 或者 hostname（推荐）：")]),e._v(" "),r("div",{staticClass:"language-vim line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-vim"}},[r("code",[e._v(" server_host"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("cm"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(".")]),e._v("stidc"),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v(".")]),e._v("gdyd\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])])]),e._v(" "),r("li",[r("p",[e._v("分发私网 IP 的hosts 到各节点下，记得先备份。")])]),e._v(" "),r("li",[r("p",[e._v("重启 server 节点上的 "),r("code",[e._v("cloudera-scm-server-db")]),e._v(" 服务。")])]),e._v(" "),r("li",[r("p",[e._v("启动 "),r("code",[e._v("cloudera-scm-server")]),e._v(" 以及 "),r("code",[e._v("cloudera-scm-agent")]),e._v(" 服务。")])]),e._v(" "),r("li",[r("p",[e._v("重启集群。")])]),e._v(" "),r("li",[r("p",[e._v("cm 上查看服务器，可以发现 IP 属性已变为私网 IP。")])])]),e._v(" "),r("h2",{attrs:{id:"绑定多网卡"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#绑定多网卡"}},[e._v("#")]),e._v(" 绑定多网卡")]),e._v(" "),r("p",[e._v("从 Hadoop 2.6 开始支持多网段通讯，主要是通过在 server 端绑定 host 到 0.0.0.0 ，从而能够通过不同网段进行服务/客户端之间的通信。")]),e._v(" "),r("p",[e._v("应用场景主要是：出于安全考虑，客户端通过公网与 Hadoop 集群进行外部通信，Hadoop 集群内部则通过内网进行数据交互，从而减少公网 IP 的占用，并且内网网络资源往往也更加充足。")]),e._v(" "),r("p",[e._v("具体配置可以参考："),r("a",{attrs:{href:"https://hadoop.apache.org/docs/r2.6.0/hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("HDFS Support for Multihomed Networks"),r("OutboundLink")],1),e._v(" 。")])])}),[],!1,null,null,null);t.default=o.exports}}]);