(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{782:function(s,n,a){"use strict";a.r(n);var e=a(70),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ulimit修改最大打开文件数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ulimit修改最大打开文件数"}},[s._v("#")]),s._v(" ulimit修改最大打开文件数")]),s._v(" "),a("p",[s._v("当一个系统有较多socket连接，或者需要打开很多文件时，若某个用户允许打开的最大文件数以及进程数不足，将会导致还用户的任务阻塞。")]),s._v(" "),a("p",[s._v("用户最大打开文件数以及进程数受到系统两个参数制约：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有进程总的最大打开文件数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/fs/file-max\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 单个进程的最大进程数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/fs/nr_open\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 系统能够分配的最大 pid")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /proc/sys/kernel/pid_max \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("查看当前进程打开的文件数以及进程数：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大文件数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" -n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大进程数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" -u\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("编辑"),a("code",[s._v("/etc/security/limits.conf")]),s._v("，修改允许打开的最大文件数：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件打开数")]),s._v("\n* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程数")]),s._v("\n* soft proc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n* hard proc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("code",[s._v("*")]),s._v("代表所有用户，但如果没有指定特定用户，则"),a("code",[s._v("/etc/security/limits.conf")]),s._v("会被子目录下的"),a("code",[s._v("/etc/security/limits.d/90-nproc.conf")]),s._v("下指定的用户覆盖。因此，为了能够让配置真正的生效，还需要对该文件进行配置：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程数")]),s._v("\n* soft proc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n* hard proc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655350")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("验证配置是否生效，可以先找到进程的 pid，然后到 "),a("code",[s._v("/proc/{pid}/limits")]),s._v(" 下查看：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("imit                     Soft Limit           Hard Limit           Units     \nMax cpu "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("              unlimited            unlimited            seconds   \nMax "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" size             unlimited            unlimited            bytes     \nMax data size             unlimited            unlimited            bytes     \nMax stack size            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10485760")]),s._v("             unlimited            bytes     \nMax core "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" size        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                    unlimited            bytes     \nMax resident "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("          unlimited            unlimited            bytes     \nMax processes             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("                processes \nMax "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" files            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v("                "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32768")]),s._v("                files     \nMax locked memory         unlimited            unlimited            bytes     \nMax address space         unlimited            unlimited            bytes     \nMax "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" locks            unlimited            unlimited            locks     \nMax pending signals       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1032708")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1032708")]),s._v("              signals   \nMax msgqueue size         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("819200")]),s._v("               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("819200")]),s._v("               bytes     \nMax "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nice")]),s._v(" priority         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                    \nMax realtime priority     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                    \nMax realtime "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v("      unlimited            unlimited            us        \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("参考："),a("a",{attrs:{href:"https://feichashao.com/ulimit_demo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://feichashao.com/ulimit_demo/"),a("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=t.exports}}]);