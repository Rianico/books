(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{737:function(s,t,a){"use strict";a.r(t);var n=a(70),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_12-散列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-散列表"}},[s._v("#")]),s._v(" 12 | 散列表")]),s._v(" "),a("p",[a("strong",[s._v("散列表")]),s._v("（Hash Table），是在数组的基础上，通过hash算法取得对象的hash值作为数组下标，将其存储到数组指定位置。当需要再访问对象时，再根据对象的hash值即可借助数组随机访问的特性来快速定位对象位置。")]),s._v(" "),a("h2",{attrs:{id:"_1-散列函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-散列函数"}},[s._v("#")]),s._v(" 1. 散列函数")]),s._v(" "),a("p",[s._v("散列函数，是散列表中的核心，它是一个函数，能够将对讲转化为一个hash值。假设对象的hash值为key，那么可以表示为 "),a("code",[s._v("key=hash(obj)")]),s._v(" ，伪代码如下：")]),s._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[s._v("int "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("String "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 获取后两位字符\n  string lastTwoChars "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("substr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 将后两位字符转换为整数\n  int hashValue "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" convert lastTwoChas "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" int"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" hashValue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("如何设计散列函数对于散列表来说至关重要，散列函数有三点设计要求：")]),s._v(" "),a("ol",[a("li",[s._v("散列函数得到的hash值必须是一个正整数，因为数组的下标只能是0以及正整数。")]),s._v(" "),a("li",[s._v("如果 obj1=obj2，那么 hash(obj1)=hash(obj2)。")]),s._v(" "),a("li",[s._v("如果 obj1!=obj2，那么 hash(obj1)!=hash(obj2)。")])]),s._v(" "),a("p",[s._v("然而在实际情况中，第三点是做不到的，即使像 "),a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/MD5",target:"_blank",rel:"noopener noreferrer"}},[s._v("MD5"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/SHA%E5%AE%B6%E6%97%8F",target:"_blank",rel:"noopener noreferrer"}},[s._v("SHA"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/%E5%BE%AA%E7%92%B0%E5%86%97%E9%A4%98%E6%A0%A1%E9%A9%97",target:"_blank",rel:"noopener noreferrer"}},[s._v("CRC"),a("OutboundLink")],1),s._v(" 等哈希算法，也无法完全做到避免这种"),a("strong",[s._v("散列冲突")]),s._v("。并且，在数组空间有限的情况下，冲突的概率会更大。")]),s._v(" "),a("h2",{attrs:{id:"_2-散列冲突"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-散列冲突"}},[s._v("#")]),s._v(" 2. 散列冲突")]),s._v(" "),a("p",[s._v("散列冲突无法避免，我们通常可以采用两种方法来处理散列冲突："),a("strong",[s._v("开放寻址法")]),s._v("（open addressing）和"),a("strong",[s._v("链表法")]),s._v("（chaining）")]),s._v(" "),a("h3",{attrs:{id:"_2-1-开放寻址法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-开放寻址法"}},[s._v("#")]),s._v(" 2.1 开放寻址法")]),s._v(" "),a("p",[s._v("开放寻址法的思想是，当探测到的位置已经存在数据时，则探寻另一个空闲的位置，最简单的探寻方法是"),a("strong",[s._v("线性探测")]),s._v("（Linear Probing）。")]),s._v(" "),a("p",[s._v("线性探测的做法是，当探测到一个位置已经有数据的时候，则继续往后探测，直到找到一个空间的位置，如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static001.geekbang.org/resource/image/5c/d5/5c31a3127cbc00f0c63409bbe1fbd0d5.jpg",alt:"线性探测"}})]),s._v(" "),a("p",[s._v("橙色表示已经存储了数据，当hash值探测到的位置已经有元素的时候，则继续往下找。")]),s._v(" "),a("p",[s._v("这种方法虽然简单，但是在更新、删除数据方面会有较多问题，比如当我们查找一个数据的时候，若有散列冲突，线性探测过程中若有一个数据被删除了，那么按照我们原本的查找算法， 遇到空闲的位置就停止不动了，从而导致在后面存在的数据，查找不到。")]),s._v(" "),a("p",[s._v("解决方法是不删除数据，而是将其标记为deleted，在线性查找的时候遇到deleted不停止，而是继续往下探测：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static001.geekbang.org/resource/image/fe/1d/fe7482ba09670cbe05a9dfe4dd49bd1d.jpg",alt:""}})]),s._v(" "),a("p",[s._v("线性探测存在的问题，就是在数据空间越来越少的时候，我们需要探测的位置越来越多，最终导致需要遍历整个数组，从O(1)的时间复杂度退化到了O(n)。")]),s._v(" "),a("p",[s._v("对于开放寻址冲突解决方法，除了线性探测方法之外，还有另外两种比较经典的探测方法，"),a("strong",[s._v("二次探测")]),s._v("（Quadratic probing）和"),a("strong",[s._v("双重散列")]),s._v("（Double hashing）。")]),s._v(" "),a("p",[s._v("二次探测，就是在线性探测的基础上进行改造的，若线性探测是hash(obj)+0，hash(obj)+1，hash(obj)+2……那么二次探测就是hash(obj)+0，hash(obj)+1^2， hash(obj)+2^2……也就是在线性探测步长的基础上进行开方。")]),s._v(" "),a("p",[s._v("双重散列，就是使用一组散列函数 hash1(obj)，hash2(obj)，hash3(obj) ，假如第一个散列函数造成了冲突，那么我们再使用第二个散列函数，直到找到空闲位置。")]),s._v(" "),a("h3",{attrs:{id:"_2-2-链表法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-链表法"}},[s._v("#")]),s._v(" 2.2 链表法")]),s._v(" "),a("p",[s._v("链表法是一种更加常用的散列冲突解决办法（也是Java中HashMap采用的做法），当发生散列冲突时，在对应的桶或者说是槽上，将冲突的元素组织成一个链表。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static001.geekbang.org/resource/image/a4/7f/a4b77d593e4cb76acb2b0689294ec17f.jpg",alt:"链表法"}})]),s._v(" "),a("p",[s._v("当我们需要插入的时候，只需要根据散列值访问对应的位置并追加进去即可，所以插入的时间复杂度是O(1)。查找 元素的时间复杂度取决于链表的长度 k ，所以当数据分布较均匀的时候，理论上查找的时间复杂度为 n/m ，n为数据个数，m为散列表的桶个数。")]),s._v(" "),a("h2",{attrs:{id:"_3-装载因子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-装载因子"}},[s._v("#")]),s._v(" 3. 装载因子")]),s._v(" "),a("p",[s._v("不管采用哪种方法，"),a("strong",[s._v("当散列表中空闲位置不多的时候，散列冲突的概率就会大大提高")]),s._v("。为了尽可能保证散列表的操作效率，一般情况下，"),a("strong",[s._v("我们会尽可能保证散列表中有一定比例的空闲槽位")]),s._v("。我们用装载因子（load factor）来表示空位的多少。")]),s._v(" "),a("p",[s._v("装载因子的计算公式是：")]),s._v(" "),a("blockquote",[a("p",[s._v("散列表的装载因子=填入表中的元素个数/散列表的长度")])]),s._v(" "),a("p",[s._v("装载因子越大，说明空闲位置越少，冲突越多，散列表的性能会下降。当数据个数与散列表桶个数达到装载因子的时候，通常为了性能，我们会对散列表进行扩容。")]),s._v(" "),a("h2",{attrs:{id:"_4-散列表存在的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-散列表存在的问题"}},[s._v("#")]),s._v(" 4. 散列表存在的问题")]),s._v(" "),a("p",[s._v("散列表虽然理论上各个操作都很高效，但在散列冲突严重的时候性能会大大下降，散列攻击就是通过一组精心设计的值，一直产生散列冲突，从而达到让服务器高负荷拒绝服务的目的。")]),s._v(" "),a("p",[s._v("散列表有两点因素直接决定了一个散列表设计的好坏：散列函数和装载因子。")]),s._v(" "),a("h3",{attrs:{id:"_4-1-散列函数的设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-散列函数的设计"}},[s._v("#")]),s._v(" 4.1 散列函数的设计")]),s._v(" "),a("p",[s._v("一个好的散列函数，能够很大程度上的减少散列碰撞的概率，从而提高散列表的性能，但同时又不能设计的太复杂，若过于复杂导致求散列值的性能下降，也就影响了散列表的性能。")]),s._v(" "),a("p",[s._v("以手机号码为例子，当我们对手机号求散列值的时候，我们往往可以忽略前面几位，因为很多手机号前面几位都是相同的，但到后面几个尾数往往就不尽相同了，以尾数来求散列值相比前面几位能够降低散列碰撞的概率。")]),s._v(" "),a("p",[s._v("再以单词举例，我们可以对字母进行进位相加操作，再对散列表长度进行求余从而得到散列值：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nice"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"n"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"i"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("78978")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("散列函数的设计方法还有很多，比如直接寻址法、平方取中法、折叠法、随机数法等，这些只要了解，不需要全都掌握。")]),s._v(" "),a("h3",{attrs:{id:"_4-2-装载因子的大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-装载因子的大小"}},[s._v("#")]),s._v(" 4.2 装载因子的大小")]),s._v(" "),a("p",[s._v("装载因子决定了散列表在内存空间与效率上的一个取舍，过大的装载因子会导致散列碰撞概率增大，过小又会导致频繁扩容浪费内存空间。")]),s._v(" "),a("p",[s._v("当装载因子过大时，比如0.8，我们就需要对散列表进行动态扩容，否则会导致散列碰撞严重从而大大降低性能。假如散列表容量扩大一倍，那么负载因子就变成了0.4，但同时也需要进行数据迁移，并且数据位置往往也会发生变化，如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static001.geekbang.org/resource/image/67/43/67d12e07a7d673a9c1d14354ad029443.jpg",alt:""}})]),s._v(" "),a("p",[s._v("也就是在某次插入时会发生扩容，时间复杂度为 O(n) ，但根据均摊算法，插入的操作的平均时间复杂度为 O(1) 。")]),s._v(" "),a("h3",{attrs:{id:"_4-3-避免低效扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-避免低效扩容"}},[s._v("#")]),s._v(" 4.3 避免低效扩容")]),s._v(" "),a("p",[s._v("按照前面提到的，一旦某个时刻发生了扩容，由于需要进行一个 O(n) 的数据迁移操作，那么在那个时间点性能就会大大降低，从而影响使用。这里讨论一些思路可以尽可能优化这些操作。")]),s._v(" "),a("p",[s._v("当发生扩容时，我们申请一个新的数组，但并不立刻将旧数组的数据迁移到新数组，而是在每次有新的数据插入到新数组的时候，也跟着将旧数组的一个数据插入到新数组，这样一来就可以将扩容操作的代价均摊到多次操作中。")]),s._v(" "),a("p",[s._v("至于数据查询的话，可以先到旧数组进行查询，查询不到再到新数组中。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static001.geekbang.org/resource/image/6d/cb/6d6736f986ec4b75dabc5472965fb9cb.jpg",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_5-开放寻址法-vs-链表法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-开放寻址法-vs-链表法"}},[s._v("#")]),s._v(" 5. 开放寻址法 VS 链表法")]),s._v(" "),a("p",[s._v("前面提到了两种解决散列冲突的方法：开放寻址法、链表法。")]),s._v(" "),a("p",[s._v("开放寻址法实现简单，而且都是存储在数组中，可以利用CPU缓存，不需要额外的链表空间，指针等，序列化起来也较为简单，但是在进行删除操作的时候较为麻烦，需要特殊的操作，并且由于都存在一个数组中，比起链表法发生冲突的概率更高。因此综合来说，"),a("strong",[s._v("开放寻址法更适合数据量以及装载因子都比较小的场景")]),s._v("，比如Java中ThreadLocalMap就是采用开放寻址法。")]),s._v(" "),a("p",[s._v("链表法使用了额外的链表空间来存储同个数组位置的元素，因此可以大大减少散列碰撞的概率，对负载因子大小的容忍度更高，但由于使用了链表，对内存空间的消耗也会增多（若存储的对象更大则可以忽略不计），对CPU缓存也是不友好的。所以"),a("strong",[s._v("链表法更适用于大数据量的场景")]),s._v("。")]),s._v(" "),a("p",[s._v("链表法实际还能再优化，比如Java8中的HashMap，当链表的长度大于8时，会将链表转化为红黑树，从而将查找的时间复杂度降为 O(logn) 。")]),s._v(" "),a("h2",{attrs:{id:"_6-java中hashmap分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-java中hashmap分析"}},[s._v("#")]),s._v(" 6. Java中HashMap分析")]),s._v(" "),a("p",[s._v("Java中的HashMap就是一个典型的工业级数据结构的实现。一个工业级的数据结构，通常要考虑以下几点：")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("查找、删除、更新等操作的高效。")])]),s._v(" "),a("li",[a("strong",[s._v("对内存空间的合理占用")]),s._v("。")]),s._v(" "),a("li",[a("strong",[s._v("性能稳定，能够应对对各种异常情况")]),s._v("。")])]),s._v(" "),a("h3",{attrs:{id:"_6-1-初始大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-初始大小"}},[s._v("#")]),s._v(" 6.1 初始大小")]),s._v(" "),a("p",[s._v("HashMap 默认的初始大小是 16，这个默认值是可以设置的，如果事先知道大概的数据量有多大，可以通过修改默认初始大小，减少动态扩容的次数，这样会大大提高 HashMap 的性能。")]),s._v(" "),a("p",[s._v("HashMap中有很多操作为了效率都是位运算，所以这也是HashMap中的默认初始容量 16 为 2 的幂次方的原因，并且即使自己手动指定初始容量， HashMap 也会自动将其向上取值到最近的 2 的幂次方。")]),s._v(" "),a("h3",{attrs:{id:"_6-2-装载因子和动态扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-装载因子和动态扩容"}},[s._v("#")]),s._v(" 6.2 装载因子和动态扩容")]),s._v(" "),a("p",[s._v("HashMap 的负载因子为 0.75 ，是一种在性能与空间占用折衷的做法。当 HashMap 中元素个数超过 0.75*capacity（capacity 表示散列表的容量）的时候，就会启动扩容，每次扩容都会扩容为原来的两倍大小。")]),s._v(" "),a("h3",{attrs:{id:"_6-3-散列冲突解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-散列冲突解决方法"}},[s._v("#")]),s._v(" 6.3 散列冲突解决方法")]),s._v(" "),a("p",[s._v("HashMap 底层采用链表法来解决冲突。即使负载因子和散列函数设计得再合理，也免不了会出现拉链过长的情况，一旦出现拉链过长，则会严重影响 HashMap 的性能。")]),s._v(" "),a("p",[s._v("在 JDK1.8 版本中，为了对 HashMap 做进一步优化，引入了红黑树。当链表长度太长（默认超过 8）时，链表就转换为红黑树。我们可以利用红黑树快速增删改查的特点，提高 HashMap 的性能。当红黑树结点个数少于 8 个的时候，又会将红黑树转化为链表。在数据量较小的情况下，红黑树要维护平衡，比起链表来，性能上的优势并不明显。")]),s._v(" "),a("h3",{attrs:{id:"_6-4-散列函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-散列函数"}},[s._v("#")]),s._v(" 6.4 散列函数")]),s._v(" "),a("p",[s._v("HashMap的散列函数设计并不复杂，追求的是简单高效，分布均匀：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),s._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" h "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("；\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("capicity "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//capicity表示散列表的大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("此处的 "),a("code",[s._v("(h ^ (h >>> 16)) & (capicity -1)")]),s._v(" 是一个位操作，相当于十进制中的求余操作。")]),s._v(" "),a("p",[s._v("其中，hashCode() 返回的是 Java 对象的 hash code。比如 String 类型的对象的 hashCode() 就是下面这样：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hashCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" var1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("var1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" var2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" var3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" var3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("var3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      var1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" var1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" var2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("var3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hash "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" var1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" var1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"_7-散列表＆链表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-散列表＆链表"}},[s._v("#")]),s._v(" 7. 散列表＆链表")]),s._v(" "),a("p",[s._v("散列表经常链表一起出现，链表插入、删除操作的时间复杂度为 O(1) ，而查找操作的时间复杂度为 O(n) ，和散列表一起结合使用的时候，可以借助散列表的特性将查找操作缩短到 O(1) ，从而大大提高性能。")]),s._v(" "),a("p",[s._v("之前学习链表的时候，借助链表实现了LRU缓存淘汰算法，一个缓存（cache）系统主要包含下面这几个操作：")]),s._v(" "),a("ul",[a("li",[s._v("往缓存中添加一个数据；")]),s._v(" "),a("li",[s._v("从缓存中删除一个数据；")]),s._v(" "),a("li",[s._v("在缓存中查找一个数据。")])]),s._v(" "),a("p",[s._v("如果单纯使用链表来实现的话，每次更新、删除元素的时候都需要经过时间复杂度为 O(n) 的查找操作，因此这里可以结合"),a("strong",[s._v("散列表 + 链表")]),s._v("来提高效率：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://static001.geekbang.org/resource/image/ea/6e/eaefd5f4028cc7d4cfbb56b24ce8ae6e.jpg",alt:"散列表&链表"}})]),s._v(" "),a("p",[s._v("在上面的数据结构图中，使用的是双向链表，但在双向链表的双向指针（"),a("code",[s._v("prev")]),s._v("、"),a("code",[s._v("next")]),s._v("）的基础上，还增加了"),a("code",[s._v("hnext")]),s._v("指针，这个 "),a("code",[s._v("hnext")]),s._v(" 指针是用于散列表中的链表法的，也就是在这个数据结构中有两条链："),a("strong",[s._v("双向链表")]),s._v("以及"),a("strong",[s._v("散列表用来解决散列冲突的链表")]),s._v("。")]),s._v(" "),a("p",[s._v("这样一来，当我们需要查找某个元素的时候，就可以借助散列表快速定位元素，添加、删除元素则利用双向链表的的 O(1) 操作，同时由于存在双向链表，我们又可以有序遍历序列（散列表经过散列函数后顺序是打乱的）。")]),s._v(" "),a("p",[s._v("实际上 Java 的 LinkedHashMap 就是这么实现的，其中的 Linked 不仅仅指使用了链表法来解决散列冲突，还指使用了双向链表来保证其有序性以及插入、删除等操作的高效性。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedHashMap")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Entry")]),s._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("entrySet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// output:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("如上代码，输出的结果是按照我们添加元素的顺序输出的，就是利用了双向链表来记录其顺序。除此之外，我们来可以选择根据元素访问时间来输出：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 10是初始大小，0.75是装载因子，true是表示按照访问时间排序")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedHashMap")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.75f")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Entry")]),s._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("entrySet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// output:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("第二行代码中的 true 代表开启根据访问时间调整元素顺序的位置，该特性会将最近一次有访问操作（如查找、更新、插入等）的元素移动到双向链表队尾，其实这就是一个 LRU缓存淘汰算法 。")]),s._v(" "),a("h2",{attrs:{id:"_8-redis有序集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-redis有序集合"}},[s._v("#")]),s._v(" 8. Redis有序集合")]),s._v(" "),a("p",[s._v("在跳表那一节提到了 Redis 的有序集合，一个Redis 有序集合可以细化为以下几个操作：")]),s._v(" "),a("ul",[a("li",[s._v("添加一个成员对象；")]),s._v(" "),a("li",[s._v("按照键值来删除一个成员对象；")]),s._v(" "),a("li",[s._v("按照键值来查找一个成员对象；")]),s._v(" "),a("li",[s._v("按照分值区间查找数据，比如查找积分在 [100, 356] 之间的成员对象；")]),s._v(" "),a("li",[s._v("按照分值从小到大排序成员变量；")])]),s._v(" "),a("p",[s._v("实际上，一个有序集合会有两个属性， "),a("strong",[s._v("key")]),s._v(" （键值）和 "),a("strong",[s._v("socre")]),s._v(" （分值）。比如一个用户积分系统，一个用户有着 ID（key） 和 积分（score），假如我们根据积分来组织一个跳表，那么当我们需要根据用户 ID 来操作元素的时候，效率就会很低。")]),s._v(" "),a("p",[s._v("解决思路跟前面一节一样，就是根据用户 ID 来组织一个散列表，这样一来查找、删除元素的操作就为 O(1) ，同时借助跳表的操作结构，其他操作也非常高效。")]),s._v(" "),a("p",[s._v("实际上，Redis 有序集合的操作还有另外一类，也就是查找成员对象的排名（Rank）或者根据排名区间查找成员对象。这个功能单纯用刚刚讲的这种组合结构就无法高效实现了。这块内容后面再学习。")]),s._v(" "),a("h2",{attrs:{id:"_9-思考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-思考"}},[s._v("#")]),s._v(" 9. 思考")]),s._v(" "),a("p",[a("strong",[s._v("Q：在散列表和链表结合使用的例子里，使用的都是双向链表。如果把双向链表改成单链表，还能否正常工作呢？为什么呢？")])]),s._v(" "),a("blockquote",[a("p",[s._v("改为单链表后仍然能够正常工作，只不过当需要删除、移动中间结点的时候，需要重新从头遍历找到目标节点的前驱节点，从而导致操作的时间复杂度变为了 O(n) 。")])]),s._v(" "),a("p",[a("strong",[s._v("Q：假设猎聘网有 10 万名猎头，每个猎头都可以通过做任务（比如发布职位）来积累积分，然后通过积分来下载简历。假设你是猎聘网的一名工程师，如何在内存中存储这 10 万个猎头 ID 和积分信息，让它能够支持这样几个操作：")])]),s._v(" "),a("ul",[a("li",[s._v("根据猎头的 ID 快速查找、删除、更新这个猎头的积分信息；")]),s._v(" "),a("li",[s._v("查找积分在某个区间的猎头 ID 列表；")]),s._v(" "),a("li",[s._v("查找按照积分从小到大排名在第 x 位到第 y 位之间的猎头 ID 列表。")])]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("可以根据猎头 ID 建立散列表，从而可以通过 O(1) 时间复杂度定位到猎头操作其信息。")]),s._v(" "),a("li",[s._v("根据猎头积分简历跳表，跳表更适合于区间查找。")]),s._v(" "),a("li",[s._v("当前还无法实现。")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);