(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{922:function(s,t,a){"use strict";a.r(t);var e=a(70),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"postgres-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#postgres-安装"}},[s._v("#")]),s._v(" Postgres 安装")]),s._v(" "),a("p",[s._v("OS：CentOS 7.6")]),s._v(" "),a("p",[s._v("Postgres Version：9.6.19")]),s._v(" "),a("p",[s._v("默认安装路径： "),a("code",[s._v("/var/lib/pgsql/9.6")])]),s._v(" "),a("p",[s._v("组件说明：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("Component")]),s._v(" "),a("th",[s._v("Comment")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("postgresql-client")]),s._v(" "),a("td",[s._v("libraries and client binaries")])]),s._v(" "),a("tr",[a("td",[s._v("postgresql-server")]),s._v(" "),a("td",[s._v("core database server")])]),s._v(" "),a("tr",[a("td",[s._v("postgresql-contrib")]),s._v(" "),a("td",[s._v("additional supplied modules")])]),s._v(" "),a("tr",[a("td",[s._v("postgresql-devel")]),s._v(" "),a("td",[s._v("libraries and headers for C language development")])]),s._v(" "),a("tr",[a("td",[s._v("pgadmin4")]),s._v(" "),a("td",[s._v("pgAdmin 4 graphical administration utility")])])])]),s._v(" "),a("h2",{attrs:{id:"_1-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装"}},[s._v("#")]),s._v(" 1. 安装")]),s._v(" "),a("h3",{attrs:{id:"_1-1-在线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-在线安装"}},[s._v("#")]),s._v(" 1.1 在线安装")]),s._v(" "),a("p",[s._v("这里通过 yum 方式安装 pg："),a("code",[s._v("yum -y install postgresql-server postgresql-contrib")]),s._v("，如果存在系统语言问题，则执行 "),a("code",[s._v("echo 'LC_ALL=\"en_US.UTF-8\"' >> /etc/locale.conf")]),s._v("。")]),s._v(" "),a("p",[s._v("如果不需要修改路径，直接执行："),a("code",[s._v("postgresql96-setup initdb && systemctl start postgresql-9.6 && systemctl enable postgresql-9.6")]),s._v(" 即可。")]),s._v(" "),a("p",[s._v("postgres 可以在启动的时候指定路径："),a("code",[s._v("pg_ctl -D /path/to/pg/data -l /path/to/pg/log/pgsql.log start")]),s._v("，但这样只是临时的，永久修改启动路径的操作如下：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("编辑 systemctl 的配置文件：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/postgresql-9.6.service \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or use 'systemctl edit postgresql-9.6.service'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("NOTE：如果是在 CentOS 6 下，则是修改 /etc/rc.d/init.d/postgresql-9.2 文件。")])])]),s._v(" "),a("li",[a("p",[s._v("找到 PGDATA , 修改如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PGDATA"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path/to/pg/data\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("重新加载 systemctl 服务： "),a("code",[s._v("systemctl daemon-reload")])])]),s._v(" "),a("li",[a("p",[s._v("创建对应目录，用户为 postgres，权限为 700：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R postgres:postgres /path/to/pg\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /path/to/pg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("执行初始化数据库命令并启动："),a("code",[s._v("postgresql-setup initdb")])])]),s._v(" "),a("li",[a("p",[s._v("开启服务以及开机启动："),a("code",[s._v("systemctl start postgresql && systemctl enable postgresql")])])])]),s._v(" "),a("h3",{attrs:{id:"_1-2-离线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-离线安装"}},[s._v("#")]),s._v(" 1.2 离线安装")]),s._v(" "),a("p",[s._v("首先到 Postgres 的"),a("a",{attrs:{href:"https://yum.postgresql.org/packages/",target:"_blank",rel:"noopener noreferrer"}},[s._v("仓库"),a("OutboundLink")],1),s._v("下载 client、contrib、libs、server 模块到一个目录下，接着执行："),a("code",[s._v("rpm -ivh postgresql96-*.rpm")]),s._v(" ，剩余操作同上。")]),s._v(" "),a("h1",{attrs:{id:"_2-登录设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-登录设置"}},[s._v("#")]),s._v(" 2. 登录设置")]),s._v(" "),a("p",[s._v("根据具体需求修改登录权限，编辑 "),a("code",[s._v("/path/to/pg/data/pg_hba.conf")]),s._v("， trust 表示免密：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE  DATABASE        USER            ADDRESS                 METHOD")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("    all             all             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/32            trust\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("    all             all             xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可以设置网段"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         md5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("编辑 "),a("code",[s._v("/path/to/pg/data/postgresql.conf")]),s._v(" ，开启全 ip 监听：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# listen_addresses = 'localhost'")]),s._v("\nlisten_addresses "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h1",{attrs:{id:"_3-配置修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置修改"}},[s._v("#")]),s._v(" 3. 配置修改")]),s._v(" "),a("h2",{attrs:{id:"_3-1-修改最大连接数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-修改最大连接数"}},[s._v("#")]),s._v(" 3.1 修改最大连接数")]),s._v(" "),a("p",[s._v("如果需要修改最大连接数 ，还需要修改信号量：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /path/to/pg/data/postgresql.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_connections")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/sysctl.conf ")]),s._v("\nkernel.sem"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'250 32000 32 128'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("NOTE：信号量类似于 Java 中的 monitor，一个进程获取到信号量后才可以执行临界区的代码，在高并发场景下会存在信号量竞争。")])]),s._v(" "),a("ul",[a("li",[s._v("250 SEMMSL max semaphores per array #信号集容纳最大信号数量")]),s._v(" "),a("li",[s._v("32000 SEMMNS max semaphores system wide #所有信号的最大数量")]),s._v(" "),a("li",[s._v("32 SEMOPM max ops per semop call #调用单个信号集中最大信号数量")]),s._v(" "),a("li",[s._v("128 SEMMNI max number of arrays #信号集的最大值")])]),s._v(" "),a("p",[s._v("查看信号量："),a("code",[s._v("cat /proc/sys/kernel/sem")])]),s._v(" "),a("h2",{attrs:{id:"_3-2-设置远程连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-设置远程连接"}},[s._v("#")]),s._v(" 3.2 设置远程连接")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /var/lib/pgsql/data/postgresql.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# listen_addresses = 'localhost'")]),s._v("\nlisten_addresses "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("之后设置远程访问规则")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /var/lib/pgsql/data/pg_hba.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "local" is for Unix domain socket connections only')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v("   all             all                                     trust\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IPv4 local connections:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许 192.168.x.x 地址段通过密码登录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("    all             all             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/16          md5\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IPv6 local connections:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("    all             all             ::1/128                 md5\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"_4-迁移数据目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-迁移数据目录"}},[s._v("#")]),s._v(" 4. 迁移数据目录")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("首先优雅的停止 postgres："),a("code",[s._v("systemctl stop postgresql")])])]),s._v(" "),a("li",[a("p",[s._v("接着将默认的数据目录迁移到新路径上：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /var/lib/pgsql /path/to/pg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("修改新路径权限：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R postgres:postgres /path/to/pg\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /path/to/pg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("这里有两种方式可以修改数据目录：")]),s._v(" "),a("ul",[a("li",[s._v("通过软连接的方式："),a("code",[s._v("ln -s /path/to/pg/ /var/lib/pgsql")]),s._v("，较为简单，但是有时候难免会给人造成困惑。")]),s._v(" "),a("li",[s._v("这种与安装 pg 时修改路径差不多：\n"),a("ol",[a("li",[s._v("修改 "),a("code",[s._v("/usr/lib/systemd/system/postgresql.service")]),s._v("  中的 "),a("code",[s._v("Environment=PGDATA=/path/to/pg/data")]),s._v("；")]),s._v(" "),a("li",[s._v("（多了这一步）修改 "),a("code",[s._v("/path/to/pg/data/postgres.conf")]),s._v(" 中的 "),a("code",[s._v("data_directory = '/path/to/pg/data'")])]),s._v(" "),a("li",[s._v("执行"),a("code",[s._v("systemctl daemon-reload")])])])])])]),s._v(" "),a("li",[a("p",[s._v("最后启动即可："),a("code",[s._v("systemctl start postgresql && systemctl enable postgresql")]),s._v("。")])])]),s._v(" "),a("h1",{attrs:{id:"_5-相关命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-相关命令"}},[s._v("#")]),s._v(" 5. 相关命令")]),s._v(" "),a("ol",[a("li",[s._v("登录 pg："),a("code",[s._v("psql -h <hostname or ip> -p <端口> [数据库名称] [用户名称]")]),s._v("。")]),s._v(" "),a("li",[s._v("创建用户："),a("code",[s._v("CREATE USER xxx WITH PASSWORD 'xxx'")]),s._v("。")]),s._v(" "),a("li",[s._v("授权数据库权限给某用户："),a("code",[s._v("GRANT ALL PRIVILEGES ON DATABASE xxx TO xxx")]),s._v("。")]),s._v(" "),a("li",[s._v("查看所有数据库："),a("code",[s._v("\\l")]),s._v("。")]),s._v(" "),a("li",[s._v("显示更加详细的信息："),a("code",[s._v("\\d+")]),s._v("。")]),s._v(" "),a("li",[s._v("切换数据库："),a("code",[s._v("\\c")]),s._v("：\n"),a("ul",[a("li",[s._v("显示所有相关表："),a("code",[s._v("\\dt")]),s._v("；")]),s._v(" "),a("li",[s._v("显示特定表结构："),a("code",[s._v("\\d tablename")]),s._v("。")]),s._v(" "),a("li",[s._v("显示相关索引："),a("code",[s._v("\\di")]),s._v("；")]),s._v(" "),a("li",[s._v("显示特定索引结构："),a("code",[s._v("\\d indexname")]),s._v("。")]),s._v(" "),a("li",[s._v("显示相关序列："),a("code",[s._v("\\ds")]),s._v("；")]),s._v(" "),a("li",[s._v("显示相关视图："),a("code",[s._v("\\dv")]),s._v("；")]),s._v(" "),a("li",[s._v("显示相关函数："),a("code",[s._v("\\df")]),s._v("。")])])]),s._v(" "),a("li",[s._v("显示表权限："),a("code",[s._v("\\dp")]),s._v("。")]),s._v(" "),a("li",[s._v("显示表空间："),a("code",[s._v("\\db")]),s._v("。")]),s._v(" "),a("li",[s._v("显示 schema："),a("code",[s._v("\\dn")]),s._v("。")]),s._v(" "),a("li",[s._v("显示用户："),a("code",[s._v("\\du")]),s._v("。")]),s._v(" "),a("li",[s._v("切换编码："),a("code",[s._v("\\encoding UTF8")]),s._v("。")]),s._v(" "),a("li",[s._v("显示 sql 执行时间："),a("code",[s._v("timing")]),s._v("。")]),s._v(" "),a("li",[s._v("显示所有："),a("code",[s._v("\\d *。")])]),s._v(" "),a("li",[s._v("将每列数据拆分为行显示："),a("code",[s._v("\\x")]),s._v("。")]),s._v(" "),a("li",[s._v("列出当前连接信息："),a("code",[s._v("\\conninfo")]),s._v("。")]),s._v(" "),a("li",[s._v("显示所有命令："),a("code",[s._v("\\?")]),s._v("。")]),s._v(" "),a("li",[s._v("导入 csv 数据到表："),a("code",[s._v("COPY <table_name> FROM '<file_path>' WITH csv;")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);