(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{847:function(t,a,r){"use strict";r.r(a);var s=r(70),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"_1-门电路"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-门电路"}},[t._v("#")]),t._v(" 1. 门电路")]),t._v(" "),r("p",[t._v("最原始通用的数据传输方式，通常是通过烽火、声音、光等形式，这些方式都只能表示很简单的信息，因此基本可以抽象为 “0” 和 “1” 两种信号。")]),t._v(" "),r("p",[t._v("在出现电报之后，人们可以很方便的通过"),r("strong",[t._v("门电路")]),t._v("来表示 “0” 和 “1”，电报传输的信号有两种，一种是短促的"),r("strong",[t._v("点信号")]),t._v("（dot 信号），一种是长一点的"),r("strong",[t._v("划信号")]),t._v("（dash 信号）。")]),t._v(" "),r("p",[t._v("电报机本质上就是一个“蜂鸣器 + 长长的电线 + 按钮开关”，通电与不通电可以表示 “0” 和 “1” ：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/28/12/283742f3a72eba22f6b4ae97e21c4112.jpg",alt:""}})]),t._v(" "),r("p",[t._v("当距离一长，电阻也会变大，因此需要一个中间件能够"),r("strong",[t._v("接力传输")]),t._v("电报信号，即"),r("strong",[t._v("继电器")]),t._v("（Relay，也称作"),r("strong",[t._v("电驿")]),t._v("）：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/11/ea/1186a10341202ea36df27cba95f1cbea.jpg",alt:""}})]),t._v(" "),r("p",[t._v("受益于信号只有两种状态，因此可以"),r("strong",[t._v("很容易的原样传输信号")]),t._v("。")]),t._v(" "),r("p",[t._v("通过这些线圈和开关，可以很容易地创建出 “与（AND）”、“或（OR）”、“非（NOT）” 的逻辑：")]),t._v(" "),r("ul",[r("li",[t._v("在输入端的电路上，提供串联的两个开关，只有两个开关都打开，输出的开关也才能接通，模拟了计算机里面的 “与” 操作。")]),t._v(" "),r("li",[t._v("在输入端的电路上，提供并联的两个开关，只要有其中一个开关打开，输出的开关就能接通，模拟了计算机里面的 “或” 操作。")]),t._v(" "),r("li",[t._v("提供两个开关，输出端的开关默认打开，在输入端的电路上接通开关的时候，输出端开关会因为磁场而关闭，输出端开和关正好和输入端相反。这个在数字电路中，也叫作"),r("strong",[t._v("反向器")]),t._v("（Inverter）。")])]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/97/5e/977b09f3a334304c2861c6b420217b5e.jpg",alt:""}})]),t._v(" "),r("p",[t._v("与、或、非的电路都非常简单，并借助这些简单的门电路，组合出复杂的功能，这也体现了现代计算机体系中一个重要的思想："),r("strong",[t._v("通过分层和组合，逐步搭建起更加强大的功能")]),t._v("。")]),t._v(" "),r("p",[t._v("电报是现代计算机的一个最简单的原型，一方面，我们可以通过继电器或者中继，进行长距离的信号传输。另一方面，通过设置不同的线路和开关状态，实现更多不同的信号表示和处理方式。")]),t._v(" "),r("p",[t._v("门电路也是创建 CPU 和内存的基本逻辑单元。各种对于计算机二进制的“0”和“1”的操作，本质就是操作门电路，称为"),r("strong",[t._v("组合逻辑电路")]),t._v("。")]),t._v(" "),r("hr"),t._v(" "),r("h2",{attrs:{id:"_2-加法器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-加法器"}},[t._v("#")]),t._v(" 2. 加法器")]),t._v(" "),r("p",[t._v("加法器是通过几个简单的门电路组成的，各个门电路标识如下：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/94/f6/94194480bcfd3b5366e4649ee80de4f6.jpg",alt:""}})]),t._v(" "),r("p",[t._v("二进制加法各场景如下：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/18/d1/1854b98fcac2c6bf4949ac5e2247d9d1.jpg",alt:""}})]),t._v(" "),r("p",[t._v("可以看到，求进位其实就是做"),r("strong",[t._v("与门（AND）")]),t._v("，求和则是做"),r("strong",[t._v("异或门（XOR）")]),t._v("，也就是说一个加法用到了两个门电路，我们将这两个门电路打包成一个"),r("strong",[t._v("半加器（Half Adder）")]),t._v("：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/58/1e/5860fd8c4ace079b40e66b9568d2b81e.jpg",alt:""}})]),t._v(" "),r("p",[t._v("全加器是由"),r("strong",[t._v("两个半加器")]),t._v(" + "),r("strong",[t._v("一个或门")]),t._v("组成的：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/3f/2a/3f11f278ba8f24209a56fb3ee1ca9e2a.jpg",alt:""}})]),t._v(" "),r("p",[t._v("全加器可用于做加法运算，比如两个数相加，在二位上先对加数与被加数使用半加器进行计算，得到进位标志 "),r("strong",[t._v("X")]),t._v(" 以及和 "),r("strong",[t._v("Y")]),t._v("，接着 "),r("strong",[t._v("Y")]),t._v(" 与前一位的进位信号信号在经过半加器，得到最终的和 "),r("strong",[t._v("W")]),t._v(" 以及一个进位信号，再将该进位信号与 "),r("strong",[t._v("X")]),t._v(" 经过或门得出最终的进位信号 "),r("strong",[t._v("V")]),t._v("，后面的计算则如此反复。")]),t._v(" "),r("p",[t._v("有了全加器，一旦我们需要对两个 8 bit 的数求和，则串联 8 个全加器即可：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/68/a1/68cd38910f526c149d232720b82b6ca1.jpeg",alt:""}})]),t._v(" "),r("p",[t._v("需要注意的是，个位只需要一个半加器即可。")]),t._v(" "),r("blockquote",[r("p",[t._v("NOTE：实际上，也可以让个位的全加器的进位信号为 0 ，进位信号则表示当前位是否发生溢出，并可以将最后一位的进位信号，输出到硬件中，能够让计算机直到是否发生溢出，现代计算机也是这么做的。")]),t._v(" "),r("p",[t._v("真实的加法器，使用的是一种叫作超前进位加法器的东西。你可以找到北京大学在 Coursera 上开设的《计算机组成》课程中的 Video-306 “加法器优化”一节，了解一下超前进位加法器的实现原理，以及我们为什么要使用它")])]),t._v(" "),r("p",[t._v("硬件层面，通过门电路 -> 半加器 -> 全加器 一层层搭出了加法器这样的功能组件，这类用来做算术逻辑计算的组件叫作 ALU，也就是算术逻辑单元。")]),t._v(" "),r("hr"),t._v(" "),r("h2",{attrs:{id:"_3-乘法的实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-乘法的实现"}},[t._v("#")]),t._v(" 3. 乘法的实现")]),t._v(" "),r("p",[t._v("二进制做乘法，跟十进制做乘法类似，且结算更简单，因为只有 0 跟 1 两种结果：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/49/4b/498fdfa2dc95631068d65e0ff5769c4b.jpg",alt:""}})]),t._v(" "),r("p",[t._v("可以看到，乘法也是可以使用加法器来实现的，并不需要额外构造其他更复杂的新东西。")]),t._v(" "),r("h3",{attrs:{id:"_3-1-顺序乘法"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-顺序乘法"}},[t._v("#")]),t._v(" 3.1 顺序乘法")]),t._v(" "),r("p",[t._v("为了节约晶体管数量，我们并不需要将 4 次单位相乘的结果存储起来，而是用 1 组开关来实现，这种方法称为"),r("strong",[t._v("顺序乘法")]),t._v("。")]),t._v(" "),r("p",[t._v("首先我们将乘数与被乘数的第一组结果写入一组结果里，接下来我们将"),r("strong",[t._v("乘数左移一位，被乘数右移一位")]),t._v("，得到的第二组结果直接加到第一组结果里，如此反复，直到无法再左移与右移。这样一来，只需要一个可以左移的电路、右移的电路以及加法器即可实现：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/cb/e9/cb809de19088d08767279715f07482e9.jpg",alt:""}})]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/06/71/0615e5e4406617ee6584adbb929f9571.jpeg",alt:""}})]),t._v(" "),r("p",[t._v("这种方式存在一个缺点，就是慢。乘法展开被转化为”"),r("strong",[t._v("加法 + 位移")]),t._v("“的方式来实现，且每一组计算依赖于上一组的计算结果，导致 4 组运算无法同时进行。")]),t._v(" "),r("p",[t._v("这样一来，一个顺序乘法的时间复杂度为 "),r("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[r("svg",{staticStyle:{"vertical-align":"-0.566ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"5.495ex",height:"2.262ex",viewBox:"0 -750 2429 1000"}},[r("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"matrix(1 0 0 -1 0 0)"}},[r("g",{attrs:{"data-mml-node":"math"}},[r("g",{attrs:{"data-mml-node":"mi"}},[r("path",{attrs:{"data-c":"4F",d:"M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(763, 0)"}},[r("path",{attrs:{"data-c":"28",d:"M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"}})]),r("g",{attrs:{"data-mml-node":"mi",transform:"translate(1152, 0)"}},[r("path",{attrs:{"data-c":"4E",d:"M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(2040, 0)"}},[r("path",{attrs:{"data-c":"29",d:"M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"}})])])])])]),t._v(" ，N 取决于乘法里的"),r("strong",[t._v("位数")]),t._v("。")],1),t._v(" "),r("h3",{attrs:{id:"_3-2-并行加速"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-并行加速"}},[t._v("#")]),t._v(" 3.2 并行加速")]),t._v(" "),r("p",[t._v("在顺序乘法中，每次只能进行一组结果的计算：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/07/ef/07f7b0eedbf1a00fc72be7e2bd0d96ef.jpg",alt:""}})]),t._v(" "),r("p",[t._v("加速的办法，就是通过使用更多的开关来同时进行好几组运算，从而将时间复杂度变为 "),r("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[r("svg",{staticStyle:{"vertical-align":"-0.566ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"9.259ex",height:"2.262ex",viewBox:"0 -750 4092.6 1000"}},[r("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"matrix(1 0 0 -1 0 0)"}},[r("g",{attrs:{"data-mml-node":"math"}},[r("g",{attrs:{"data-mml-node":"mi"}},[r("path",{attrs:{"data-c":"4F",d:"M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(763, 0)"}},[r("path",{attrs:{"data-c":"28",d:"M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"}})]),r("g",{attrs:{"data-mml-node":"mi",transform:"translate(1152, 0)"}},[r("path",{attrs:{"data-c":"6C",d:"M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"}})]),r("g",{attrs:{"data-mml-node":"mi",transform:"translate(1450, 0)"}},[r("path",{attrs:{"data-c":"6F",d:"M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"}})]),r("g",{attrs:{"data-mml-node":"msub",transform:"translate(1935, 0)"}},[r("g",{attrs:{"data-mml-node":"mi"}},[r("path",{attrs:{"data-c":"67",d:"M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"}})]),r("g",{attrs:{"data-mml-node":"mn",transform:"translate(477, -150) scale(0.707)"}},[r("path",{attrs:{"data-c":"32",d:"M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"}})])]),r("g",{attrs:{"data-mml-node":"mi",transform:"translate(2815.6, 0)"}},[r("path",{attrs:{"data-c":"4E",d:"M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"}})]),r("g",{attrs:{"data-mml-node":"mo",transform:"translate(3703.6, 0)"}},[r("path",{attrs:{"data-c":"29",d:"M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"}})])])])])]),t._v("：")],1),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/66/98/6646b90ea563c6b87dc20bbd81c54b98.jpeg",alt:""}})]),t._v(" "),r("p",[t._v("即"),r("strong",[t._v("通过并联更多的 ALU，加上更多的寄存器加速乘法")]),t._v("，但这种方式又需要较多的开关，较为笨重。")]),t._v(" "),r("h3",{attrs:{id:"_3-3-电路并行"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-电路并行"}},[t._v("#")]),t._v(" 3.3 电路并行")]),t._v(" "),r("p",[t._v("顺序惩罚中，每一个全加器，都要等待上一个全加器，把对应的进入输入结果算出来，才能算下一位的输出。位数越多，越往高位走，等待前面的步骤就越多，这个等待的时间有个专门的名词，叫作"),r("strong",[t._v("门延迟")]),t._v("（Gate Delay）。")]),t._v(" "),r("p",[t._v("一个全加器的门延迟为 3T，当我们进行 64 位乘法运算的时候，最后一位要等待的门延迟为 63*3T=189T。")]),t._v(" "),r("p",[t._v("除了门延迟之外，还存在"),r("strong",[t._v("时钟频率")]),t._v("的问题，当我们需要将中间结果存到寄存器中时，需要等待下一个时钟周期的到来，这个延迟比门延迟更大。")]),t._v(" "),r("p",[t._v("可以从这个角度出发，一旦两个数是固定的，那么高位的进位也是固定，我们不需要按照人脑的方式来进行顺序计算，而是可以通过将电路连得更复杂，将进位部分的电路完全展开，利用电路天然的并行性进行加速：")]),t._v(" "),r("p",[r("img",{attrs:{src:"https://static001.geekbang.org/resource/image/6e/a8/6e9f630389c566d72f57f5b196a711a8.jpeg",alt:""}})]),t._v(" "),r("p",[t._v("上述这个门电路可以直接获得前 4 位是否需要进位。")]),t._v(" "),r("blockquote",[r("p",[t._v("NOTE：这个优化，本质上是利用了电路天然的并行性。电路只要接通，输入的信号自动传播到了所有接通的线路里面，这其实也是硬件和软件最大的不同。")])]),t._v(" "),r("p",[t._v("这里更复杂的电路也意味着，需要用到的晶体管更多了，通过更多的晶体管，就可以拿到更低的门延迟，以及用更少的时钟周期完成一个计算指令。")]),t._v(" "),r("p",[t._v("指令也存在着两种争执：是用更少更简单的电路，但是需要更长的门延迟和时钟周期；还是用更复杂的电路，但是更短的门延迟和时钟周期来计算一个复杂的指令，这之间的权衡，其实就是计算机体系结构中 RISC 和 CISC 的经典历史路线之争。")])])}),[],!1,null,null,null);a.default=e.exports}}]);