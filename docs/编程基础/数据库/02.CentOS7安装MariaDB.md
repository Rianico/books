---
title: CentOS 7 安装 MariaDB
date: 2020-07-22 10:57:05
---
## CentOS 7 安装 MariaDB

CentOS 7 下默认的数据库改为 MariaDB 了，使用方式跟 MySQL 基本一致，兼容 MySQL，如果要强行安装 MySQL 还需要更换 yum 源等，较为麻烦，因此决定使用默认的 MariaDB，这里记录下一些相关步骤。

### 1. 安装 MariaDB

```vim
yum install mariadb mariadb-server    # 安装客户端与服务端
systemctl start mariadb   #启动mariadb
systemctl enable mariadb  #设置开机自启动

mysql_secure_installation #设置root密码等相关
mysql -uroot -p           #测试登录
```

这里我安装完后是 5.5.60 版本。

### 2. 开启远程登录

```bash
vim /etc/my.cnf    # 修改配置文件

# 在 mysqld 模块下下配置允许远程登陆
[mysqld]
bind-address=0.0.0.0

# 登录 mysql，执行下列 sql 语句：
grant all privileges on *.* to 'root'@'%' identified by 'password';
flush privileges;

# 解除授权
revoke ALL ON *.* from 'root'@'%';
delete from mysql.user where user='root' and host='%'
flush privileges;

# 验证，在其他主机执行下列命令，$ip 替换为 mariadb 节点的 ip
mysql -uroot -h $ip -p
```

### 3. 修改数据库编码

由于历史原因，MySQL、MariaDB 的 utf8 编码都不是当前我们常说的 utf-8 编码，应将其修改为 `utf8mb4`，步骤如下：

```bash
# vim /etc/my.cnf.d/server.cnf
[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
init_connect='SET NAMES utf8mb4'
skip-character-set-client-handshake=true

# /etc/my.cnf.d/client.cnf
[client]
default-character-set=utf8mb4

# vim /etc/my.cnf
[mysql]
default_character_set=utf8mb4
```

### 4. 信号量

查看当前数据库正在等待获取信号量的线程，通常应该为空：

```sql
mariadb> SHOW ENGINE INNODB STATUS\G;
----------
SEMAPHORES
----------
OS WAIT ARRAY INFO: reservation count 68581015, signal count 218437328 
--Thread 140653057947392 has waited at btr0pcur.c line 437 for 0.00 seconds the semaphore:
S-lock on RW-latch at 0x7ff536c7d3c0 created in file buf0buf.c line 916
a writer (thread id 140653057947392) has reserved it in mode exclusive
Mutex spin waits 1157217380, rounds 1783981614, OS waits 10610359
RW-shared spins 103830012, rounds 1982690277, OS waits 52051891
RW-excl spins 43730722, rounds 602114981, OS waits 3495769
```

