---
title: 04-栈
date: 2020-07-22 14:48:49
---
栈也是线性表的一种，但其数据的操作方式较为特殊：**后进先出，且只允许在一端能进出**。

从前面提到的特点来看，**栈是一种“操作受限”的线性表，只允许在一端插入和删除数据**。

最形象的一种比喻就是“洗盘子”，先洗好的盘子放在下面，后洗好的盘子放上面，取盘子的时候取到的就是后洗好的盘子。

![&#x6D17;&#x76D8;&#x5B50;](https://static001.geekbang.org/resource/image/3e/0b/3e20cca032c25168d3cc605fa7a53a0b.jpg)

使用数组跟链表也能实现栈的语义，但是数组跟链表暴露了过多操作，从而导致使用上比较不可控，容易出bug。栈则是专门针对**后进先出、先进后出**这种场景特化的。

## 1. 如何实现栈？

栈可以使用数组（称为**顺序栈**）以及链表（称为**链式栈**）来实现。

### 1.1 顺序栈

```java
// 基于数组实现的顺序栈
public class ArrayStack {
  private String[] items;  // 数组
  private int count;       // 栈中元素个数
  private int n;           //栈的大小

  // 初始化数组，申请一个大小为n的数组空间
  public ArrayStack(int n) {
    this.items = new String[n];
    this.n = n;
    this.count = 0;
  }

  // 入栈操作
  public boolean push(String item) {
    // 数组空间不够了，直接返回false，入栈失败。
    if (count == n) return false;
    // 将item放到下标为count的位置，并且count加一
    items[count] = item;
    ++count;
    return true;
  }

  // 出栈操作
  public String pop() {
    // 栈为空，则直接返回null
    if (count == 0) return null;
    // 返回下标为count-1的数组元素，并且栈中元素个数count减一
    String tmp = items[count-1];
    --count;
    return tmp;
  }
}
```

从时间复杂度来看每次只涉及数组末尾的插入、删除操作，因此时间复杂度为$O(1)$，而空间复杂度也为$O(1)$。

## 1.2 链式栈

```java

```

## 2. 栈在函数调用中的应用

栈在软件工程中一个非常经典的使用场景就是**函数调用栈**。

操作系统给每个线程分配了一块内存空间，这块内存空间以栈的形式组织起来，以用来存储临时函数的变量。

当调用一个函数时，就会将一个临时变量放入栈中（“**压栈**”），当函数执行完返回时，则会将该临时变量取出来（“**出栈**”）。

以下面代码为例：

```c
int main() {
   int a = 1;
   int ret = 0;
   int res = 0;
   ret = add(3, 5);
   res = a + ret;
   printf("%d", res);
   reuturn 0;
}

int add(int x, int y) {
   int sum = 0;
   sum = x + y;
   return sum;
}
```

从代码中可以看到，main函数调用了add\(...\)函数，获取计算结果并与a相加，最后打印res的值，下面这张图描述了调用到了add\(...\)的时候栈里的情况：

![add&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;](https://static001.geekbang.org/resource/image/17/1c/17b6c6711e8d60b61d65fb0df5559a1c.jpg)

## 3. 栈在表达式求值中的应用

接下来再看下栈在表达式求值的时候是如何运作的。

我们这里只执行加减乘除四则运算，如 $34+13*9+44-12/3$ 。这里计算机使用了两个栈来执行四则运算，栈1用于存储操作数，栈2用于存储运算符。

当遇到操作数时，将其入栈栈1。遇到操作数时，将其入栈栈2，但若此时栈2里有操作符，那么待入栈的操作符需要先与栈2里的操作符比较优先级，若优先级高于栈中操作符，则入栈，否则会将两个栈中的内容取出并做计算，再将其入栈。

![&#x8868;&#x8FBE;&#x5F0F;&#x6C42;&#x503C;](https://static001.geekbang.org/resource/image/bc/00/bc77c8d33375750f1700eb7778551600.jpg)

同时，栈也能来做括号（e.g. `{[] ()[{}]}`）的匹配，这里不再详细赘述。

## 4. 总结

栈是一种操作首先的链表，只能执行入栈、出栈的操作，**后进先出**以及只能在一端进行操作是其特点。

栈能够使用数组或者链表实现，且入栈、出栈操作时间复杂度均为$O(1)$。

**Q**：我们在讲栈的应用时，讲到用函数调用栈来保存临时变量，为什么函数调用要用“栈”来保存临时变量呢？用其他数据结构不行吗？

> 当我们调用函数的时候，一旦需要进行运算，我们往往是希望后面到来的函数是先执行的，栈的后进先出特别符合这种场景，且只有入栈、出栈两种操作，可控性更高。

**Q**：我们都知道，JVM 内存管理中有个“堆栈”的概念。栈内存用来存储局部变量和方法调用，堆内存用来存储 Java 中的对象。那 JVM 里面的“栈”跟我们这里说的“栈”是不是一回事呢？如果不是，那它为什么又叫作“栈”呢？

> JVM 中的堆栈是真实的物理结构，但也是抽象成了栈的数据结构，符合后进先出的特点。JVM中的栈针对于临时变量的存储有所区别，若为基本类型，则直接存储，若是一个对象，则存储相关的对象引用/指针。

leetcode上关于栈的题目大家可以先做20,155,232,844,224,682,496.

