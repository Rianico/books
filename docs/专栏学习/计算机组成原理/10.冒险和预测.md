---
title: 10. 冒险和预测
date: 2021-03-06
---

## 1. 三种冒险

### 1.1 结构冒险

如果内存只有一个地址译码器作为地址输入，那就只能在一个时钟周期里面读取一条数据。这样一来，同一时钟周期只能有一条指令对内存进行读取（造成硬件资源的竞争），访问内存数据以及读取内存指令就会造成冲突。

现代处理器借鉴了 “哈佛架构” 的思想，将 CPU 的高速缓存划分为**存放指令的缓存**和**存放数据的缓存**。

现代的 CPU 并不会直接从内存中读取数据以及指令，而是将其加载到高速缓存中在再进行访问，避免了硬件资源的竞争。

### 1.2 数据冒险

数据依赖可以分为先写后读（Read After Write）、先读后写（Write After Read）、写后再写（Write After Write）。

如果后面一条指令依依赖于前一条指令的结果，由于流水线，可能导致后一条指令的流水级先行发生于前一条指令发生，导致结果错误。

目前解决数据冒险的方式为**流水线停顿（Pipeline Stall）**，或者叫**流水线冒泡（Pipeline Bubbling）**。如果检测到指令之间有数据冒险，则根据依赖关系，在后面指令的流水线前面添加 NOP 来填充时钟周期，推迟指令流水线的运行。

最坏情况下，会让 CPU 退化为单指令周期 CPU。