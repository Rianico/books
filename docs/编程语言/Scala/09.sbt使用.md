---
title: 09. sbt 使用
date: 2021-07-17
---

## sbt 使用

### 目录结构

一个标准的 sbt 目录结构如下：

![image-20210717193557623](https://gitee.com/zhxuankun/Image/raw/master/ARTS_Tips/image-20210717193557623.png)

图中圈起来部分的属于默认的 project，名称为 `root`，`0711` 则属于新建的 subproject，名称可以在 `build.sbt` 中指定：

```scala
lazy val sub1 = (project in file("sub1"))
  .settings(...)
```

在 `build.sbt` 添加了上述代码后，sbt 会自动生成 `0711` 路径，同时 subproject 名称也为 `0711`；如果不指定 project 的目录，则默认生成与变量名一样的目录名。

如果只想只在 `sub1` 模块执行一些命令，则输入 `sub1 / xxx` 即可。

## 打包

进入 sbt-shell 后，执行 `package` 即可生成一个 jar 包。

### 添加插件

`project` 通常用来存放构建时的一些环境信息，如插件、sbt 版本等。

可以在 project 目录下新建一个 `plugins.sbt` 文件，添加 `sbt-assembly` 插件：

```scala
addSbtPlugin("com.eed3si9n" % "sbt-assembly" % "0.15.0")
```

接着便可以在 sbt-shell 中执行 assembly 命令打出一个 fat jar。

### 公共配置

可以在 `build.sbt` 中定义一个公共配置，并在各个 subproject 中使用：

```scala
val commonSettings = Seq(
  scalaVersion := "2.13.6",
  // 添加 cdh 仓库
  resolvers += "Cloudera Repository" at "https://repository.cloudera.com/artifactory/cloudera-repos/"
)

lazy val sub1 = (project in file("sub1"))
  .settings(
      commonSettings
  )
```

### 添加仓库

```
resolvers += "Sonatype OSS Snapshots" at "https://oss.sonatype.org/content/repositories/snapshots"
resolvers += "Cloudera Repository" at "https://repository.cloudera.com/artifactory/cloudera-repos/"
```

