(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{823:function(t,s,a){"use strict";a.r(s);var e=a(70),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"xfs-vs-ext4-文件系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xfs-vs-ext4-文件系统"}},[t._v("#")]),t._v(" xfs VS ext4 文件系统")]),t._v(" "),a("h3",{attrs:{id:"xfs安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xfs安装"}},[t._v("#")]),t._v(" xfs安装")]),t._v(" "),a("p",[t._v("最新搭建Hadoop集群，了解到了xfs文件系统，xfs官网地址："),a("a",{attrs:{href:"https://xfs.org/index.php/Main_Page",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://xfs.org/index.php/Main_Page"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("磁盘：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("device")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("parted")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("comment")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("/dev/sdb")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("/data1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("HDD，7200转")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("/dev/sdc")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("/data2")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("HDD，7200转")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("...")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("...")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("/dev/sdm")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("/data12")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("HDD，7200转")])])])]),t._v(" "),a("p",[t._v("1.首先安装xfs")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" xfsprogs\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("2.对磁盘进行分区，可参考下列脚本，注意parted的时候使用"),a("code",[t._v("mkpart primary 1 100%")]),t._v("达到逻辑分区对齐的作用")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#! /bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" -le "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("j")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" $i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{printf "%c",97+'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("umount")]),t._v(" /data"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parted")]),t._v(" /dev/sd"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$j")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("FORMAT\nrm 1\nmklabel gpt\nIgnore\nYes\nmkpart primary 1 100%\nquit\nFORMAT")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("i+1\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("p",[t._v("3.格式化分区并挂载")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#! /bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" -le "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("j")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" $i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{printf "%c",97+'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\nmkfs.xfs -f /dev/sd"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${j}")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" /dev/sd"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${j}")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" /data"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v("\nFORMAT\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("let")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("i")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("i+1\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("4.修改"),a("code",[t._v("/etc/fstab")]),t._v("添加以下配置")]),t._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdb1              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data1                  xfs    defaults        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdc1              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data2                  xfs    defaults        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdm1              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data12                  xfs    defaults        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("5.执行"),a("code",[t._v("df -Th")]),t._v("检查挂载以及格式化")]),t._v(" "),a("div",{staticClass:"language-vim line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vim"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdb1      xfs    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("5T   34M  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("5T   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data1\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdc1      xfs    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("5T   34M  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("5T   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data2\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("sdm1      xfs    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("5T   34M  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("5T   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data12\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h3",{attrs:{id:"xfs-与ext4-的性能对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xfs-与ext4-的性能对比"}},[t._v("#")]),t._v(" xfs 与ext4 的性能对比")]),t._v(" "),a("p",[t._v("为验证xfs对比原来ext4的读写性能，现对两种文件系统的I/O表现做一个测试对比")]),t._v(" "),a("p",[t._v("各磁盘文件系统参数如下：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# xfs,默认配置")]),t._v("\nmkfs.xfs -f /dev/sdb1\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ext4,默认配置")]),t._v("\nmkfs.ext4 /dev/sdc1\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"dd命令测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dd命令测试"}},[t._v("#")]),t._v(" dd命令测试")]),t._v(" "),a("p",[t._v("首先使用dd命令进行测试，总共10G文件读取写入，测试磁盘的顺序读写性能，绕过磁盘cache，测试命令如下（以"),a("code",[t._v("/dev/sdb1")]),t._v("挂载在"),a("code",[t._v("/data1")]),t._v("为例）：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写测试，每次写入4K，共10G,使用oflag=direct绕过cache")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/zero "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data1/test.log "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("4k "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2500000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("oflag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 读测试，每次读取4K，共10G,使用iflag=direct绕过cache")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/sdb1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("4k "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2500000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("iflag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 写测试，每次写入1M，共10G,使用oflag=direct绕过cache")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/zero "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data1/test.log "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("oflag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 读测试，每次读取1M，共10G,使用iflag=direct绕过cache")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/sdb1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("bs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1M "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("iflag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("direct\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("磁盘类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("读速度(4KB/per block)")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("写速度（4KB/per block)")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("读速度(1MB/per block)")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("写速度（1MB/per block)")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("xfs")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("47.8 MB/秒")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("42.2 MB/秒")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("225 MB/秒")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("265 MB/秒")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ext4")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("47.2 MB/秒")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("38.3 MB/秒")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("225 MB/秒")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("264 MB/秒")])])])]),t._v(" "),a("p",[t._v("结论：从上面可以看出，xfs从综合读写来看，都会比ext4略强，但差距十分小，还不能够说有明显提升。")]),t._v(" "),a("h4",{attrs:{id:"fio测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fio测试"}},[t._v("#")]),t._v(" fio测试")]),t._v(" "),a("p",[t._v("接下来使用fio工具进行更加具体的测试，安装详见"),a("a",{attrs:{href:"https://github.com/axboe/fio",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("fio执行命令如下（以"),a("code",[t._v("/dev/sdb1")]),t._v("为例）：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("fio -name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("disktest -runtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v(" -iodepth"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v(" -ioengine"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("libaio -group_reporting -direct"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -numjobs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -thread -rw"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("rw -bs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("4k -filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/dev/sdb1\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ul",[a("li",[t._v("name：测试名称，随便取个即可")]),t._v(" "),a("li",[t._v("runtime：运行时间为300s")]),t._v(" "),a("li",[t._v("rw：读写模式，以rw（读写混合），randrw（随机读写混合）为测试用例")]),t._v(" "),a("li",[t._v("bs：测试使用的块大小")]),t._v(" "),a("li",[t._v("iodepth：io队列最大深度")]),t._v(" "),a("li",[t._v("filename：测试的磁盘")]),t._v(" "),a("li",[t._v("direct：1表示绕过磁盘cache")]),t._v(" "),a("li",[t._v("numjobs：指定线程数量")]),t._v(" "),a("li",[t._v("thread：fio默认会使用fork()创建job，如果这个选项设置的话，fio将使用pthread_create来创建线程")]),t._v(" "),a("li",[t._v("group_reporting：查看统计后的综合报告")])]),t._v(" "),a("p",[a("strong",[t._v("单线程下的吞吐量 & iops（numjobs=1）")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_4k")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_4k")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_1M")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_1M")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("118MB/s & 28.8k")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("120MB/s & 29.3k")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("145MB/s & 138")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("151MB/s & 143")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("118MB/s & 28.8k")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("120MB/s & 29.3k")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("144MB/s & 137")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("151MB/s & 142")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("随机读")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("780kB/s & 190")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("791kB/s & 193")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("50.6MB/s & 48")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("38.2MB/s & 36")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("随机写")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("776kB/s & 189")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("788kB/s & 192")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("50.4MB/s & 48")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("37.0MB/s & 36")])])])]),t._v(" "),a("p",[a("strong",[t._v("16线程下的吞吐量 & iops（numjobs=16）")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_4k")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_4k")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_1M")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_1M")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("194MB/s & 47.5k")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("196MB/s & 47.9k")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("2268MB/s & 2182")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2229MB/s & 2125")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("195MB/s & 47.5k")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("197MB/s & 47.0k")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("2279MB/s & 2172")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2241MB/s & 2136")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("随机读")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("850kB/s & 207")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("845kB/s & 206")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("49.0MB/s & 47")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("50.7MB/s & 48")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("随机写")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("858kB/s & 209")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("852kB/s & 208")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("50.8MB/s & 48")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("51.5MB/s & 49")])])])])]),t._v(" "),a("p",[a("strong",[t._v("32线程下的吞吐量 & iops（numjobs=32）")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_4k")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_4k")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_1M")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_1M")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("199MB/s & 48.6k")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("195MB/s & 47.6k")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("2208MB/s & 2107")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2207MB/s & 2104")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("199MB/s & 48.6k")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("195MB/s & 47.6k")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("2211MB/s & 2109")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("2209MB/s & 2107")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("随机读")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("809kB/s & 197")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("804kB/s & 196")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("49.9MB/s & 47")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("49.8MB/s & 47")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("随机写")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("809kB/s & 197")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("802kB/s & 195")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("50.2MB/s & 47")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("50.1MB/s & 47")])])])]),t._v(" "),a("p",[t._v("可以看到，随着线程数增加，xfs性能逐渐超过ext4，但差距仍然很小，最后再看下32线程下，5MB（取Kafka接收消息的最大大小）顺序读写的对比。")]),t._v(" "),a("p",[a("strong",[t._v("32线程，5MB的吞吐量 & iops（numjobs=32）")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("读写类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("xfs_5M")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("ext4_5M")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序读")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("1399MB/s & 266")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1392MB/s & 265")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("顺序写")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("1396MB/s & 266")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("1390MB/s & 265")])])])]),t._v(" "),a("p",[t._v("由上趋势可以看出，"),a("strong",[t._v("xfs并不能带来显著的提升，但是可以看出在负载越大的情况下，xfs的稳定性相对会更好")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[t._v("NOTE：xfs其实已经相当成熟，基本不需要其他优化，网上的调优资料都是好几年前的了，按着调整只会造成反效果（个人亲身经历，瞎折腾一天），官网也写明了默认参数基本已经有了最好的性能表现。")])]),t._v(" "),a("p",[t._v("上述测试是在HDD硬盘上进行的，在HDD硬盘方面得出的结论跟"),a("a",{attrs:{href:"https://scalegrid.io/blog/xfs-vs-ext4-comparing-mongodb-performance-on-aws-ec2",target:"_blank",rel:"noopener noreferrer"}},[t._v("XFS vs EXT4 – Comparing MongoDB Performance on AWS EC2"),a("OutboundLink")],1),t._v(" 基本一致，文章大致表达的意思是：在高性能磁盘下，xfs对比ext4性能上高了一个级别，而在中小型机器的资源下下，xfs并没法带来肉眼可见的提升。由于没有条件进行SDD的测试，所以这篇文章对SDD的测试可以作为一个参考。")]),t._v(" "),a("h3",{attrs:{id:"结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),a("p",[t._v("关于xfs以及ext4的对比网上有很多资料，结合知乎的一个问答"),a("a",{attrs:{href:"https://www.zhihu.com/question/24413471/answer/38883787",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么CENTOS 7.0开始选择XFS作为默认的文件系统？XFS相比ext有什么优点？"),a("OutboundLink")],1),t._v("，个人认为，在未来数据量未来越大的情况下，ext4的单个文件大小最大只支持到16T，而xfs则没有此限制，从扩展性上来看会更好。")])])}),[],!1,null,null,null);s.default=n.exports}}]);