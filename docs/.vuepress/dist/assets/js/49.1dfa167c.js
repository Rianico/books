(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{777:function(s,t,e){"use strict";e.r(t);var a=e(70),v=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"postgres-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#postgres-安装"}},[s._v("#")]),s._v(" Postgres 安装")]),s._v(" "),e("p",[s._v("OS：CentOS 7.6")]),s._v(" "),e("p",[s._v("Postgres Version：9.2.24")]),s._v(" "),e("p",[s._v("默认安装路径： /var/lib/pgsql")]),s._v(" "),e("h1",{attrs:{id:"_1-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装"}},[s._v("#")]),s._v(" 1. 安装")]),s._v(" "),e("p",[s._v("这里通过 yum 方式安装 pg："),e("code",[s._v("yum -y install postgresql-server postgresql-contrib")]),s._v("，如果存在系统语言问题，则执行 "),e("code",[s._v("echo 'LC_ALL=\"en_US.UTF-8\"' >> /etc/locale.conf")]),s._v("。")]),s._v(" "),e("p",[s._v("如果不需要修改路径，直接执行："),e("code",[s._v("postgresql-setup initdb && systemctl start postgresql && systemctl enable postgresql")]),s._v(" 即可。")]),s._v(" "),e("p",[s._v("postgres 可以在启动的时候指定路径："),e("code",[s._v("pg_ctl -D /path/to/pg/data -l /path/to/pg/log/pgsql.log start")]),s._v("，但这样只是临时的，永久修改启动路径的操作如下：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("编辑 systemctl 的配置文件：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/postgresql.service \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("NOTE：如果是在 CentOS 6 下，则是修改 /etc/rc.d/init.d/postgresql-9.x 文件")])])]),s._v(" "),e("li",[e("p",[s._v("找到 PGDATA , 修改如下：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PGDATA"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/path/to/pg/data\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("重新加载 systemctl 服务： "),e("code",[s._v("systemctl daemon-reload")])])]),s._v(" "),e("li",[e("p",[s._v("创建对应目录，用户为 postgres，权限为 700：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("chown -R postgres:postgres /path/to/pg\nchmod -R 700 /path/to/pg\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("执行初始化数据库命令并启动："),e("code",[s._v("postgresql-setup initdb")])])]),s._v(" "),e("li",[e("p",[s._v("开启服务以及开机启动："),e("code",[s._v("systemctl start postgresql && systemctl enable postgresql")])])])]),s._v(" "),e("h1",{attrs:{id:"_2-登录设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-登录设置"}},[s._v("#")]),s._v(" 2. 登录设置")]),s._v(" "),e("p",[s._v("根据具体需求修改登录权限，编辑 "),e("code",[s._v("/var/lib/pgsql/data/pg_hba.conf")]),s._v("， trust 表示免密：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# TYPE  DATABASE        USER            ADDRESS                 METHOD\nhost    all             all             127.0.0.1/32            trust\nhost    all             all             localhost               trust\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h1",{attrs:{id:"_3-配置修改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置修改"}},[s._v("#")]),s._v(" 3. 配置修改")]),s._v(" "),e("h2",{attrs:{id:"_3-1-修改最大连接数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-修改最大连接数"}},[s._v("#")]),s._v(" 3.1 修改最大连接数")]),s._v(" "),e("p",[s._v("如果需要修改最大连接数 ，还需要修改信号量：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /var/lib/pgsql/data/postgresql.conf")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("max_connections")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/sysctl.conf ")]),s._v("\nkernel.sem"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'250 250000 32 1000'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[s._v("NOTE：信号量类似于 Java 中的 monitor，一个进程获取到信号量后才可以执行临界区的代码。通常信号量都不需要设置，除了遇到 oracle、zabbix、postgres 这类程序。")])]),s._v(" "),e("h2",{attrs:{id:"_3-2-迁移数据目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-迁移数据目录"}},[s._v("#")]),s._v(" 3.2 迁移数据目录")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("首先优雅的停止 postgres："),e("code",[s._v("systemctl stop postgresql")])])]),s._v(" "),e("li",[e("p",[s._v("接着将默认的数据目录迁移到新路径上：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /var/lib/pgsql /path/to/pg\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("修改新路径权限：")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R postgres:postgres /path/to/pg\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" -R "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /path/to/pg\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("这里有两种方式可以修改数据目录：")]),s._v(" "),e("ul",[e("li",[s._v("通过软连接的方式："),e("code",[s._v("ln -s /path/to/pg/ /var/lib/pgsql")]),s._v("，较为简单，但是有时候难免会给人造成困惑。")]),s._v(" "),e("li",[s._v("这种与安装 pg 时修改路径差不多：\n"),e("ol",[e("li",[s._v("修改 "),e("code",[s._v("/usr/lib/systemd/system/postgresql.service")]),s._v("  中的 "),e("code",[s._v("Environment=PGDATA=/path/to/pg/data")]),s._v("；")]),s._v(" "),e("li",[s._v("（多了这一步）修改 "),e("code",[s._v("/path/to/pg/data/postgres.conf")]),s._v(" 中的 "),e("code",[s._v("data_directory = '/path/to/pg/data'")])]),s._v(" "),e("li",[s._v("执行"),e("code",[s._v("systemctl daemon-reload")])])])])])]),s._v(" "),e("li",[e("p",[s._v("最后启动即可："),e("code",[s._v("systemctl start postgresql && systemctl enable postgresql")]),s._v("。")])])]),s._v(" "),e("h1",{attrs:{id:"_4-相关命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-相关命令"}},[s._v("#")]),s._v(" 4. 相关命令")]),s._v(" "),e("ol",[e("li",[s._v("登录 pg："),e("code",[s._v("psql -h <hostname or ip> -p <端口> [数据库名称] [用户名称]")]),s._v("。")]),s._v(" "),e("li",[s._v("查看所有数据库："),e("code",[s._v("\\l")]),s._v("。")]),s._v(" "),e("li",[s._v("显示更加详细的信息："),e("code",[s._v("\\d+")]),s._v("。")]),s._v(" "),e("li",[s._v("切换数据库："),e("code",[s._v("\\c")]),s._v("：\n"),e("ul",[e("li",[s._v("显示所有相关表："),e("code",[s._v("\\dt")]),s._v("；")]),s._v(" "),e("li",[s._v("显示特定表结构："),e("code",[s._v("\\d tablename")]),s._v("。")]),s._v(" "),e("li",[s._v("显示相关索引："),e("code",[s._v("\\di")]),s._v("；")]),s._v(" "),e("li",[s._v("显示特定索引结构："),e("code",[s._v("\\d indexname")]),s._v("。")]),s._v(" "),e("li",[s._v("显示相关序列："),e("code",[s._v("\\ds")]),s._v("；")]),s._v(" "),e("li",[s._v("显示相关视图："),e("code",[s._v("\\dv")]),s._v("；")]),s._v(" "),e("li",[s._v("显示相关函数："),e("code",[s._v("\\df")]),s._v("。")])])]),s._v(" "),e("li",[s._v("显示表权限："),e("code",[s._v("\\dp")]),s._v("。")]),s._v(" "),e("li",[s._v("显示表空间："),e("code",[s._v("\\db")]),s._v("。")]),s._v(" "),e("li",[s._v("显示 schema："),e("code",[s._v("\\dn")]),s._v("。")]),s._v(" "),e("li",[s._v("显示用户："),e("code",[s._v("\\du")]),s._v("。")]),s._v(" "),e("li",[s._v("切换编码："),e("code",[s._v("\\encoding UTF8")]),s._v("。")]),s._v(" "),e("li",[s._v("显示 sql 执行时间："),e("code",[s._v("timing")]),s._v("。")]),s._v(" "),e("li",[s._v("显示所有："),e("code",[s._v("\\d *。")])]),s._v(" "),e("li",[s._v("将每列数据拆分为行显示："),e("code",[s._v("\\x")]),s._v("。")]),s._v(" "),e("li",[s._v("列出当前连接信息："),e("code",[s._v("\\conninfo")]),s._v("。")]),s._v(" "),e("li",[s._v("显示所有命令："),e("code",[s._v("\\?")]),s._v("。")])])])}),[],!1,null,null,null);t.default=v.exports}}]);