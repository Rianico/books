---
title:  排查磁盘文件占满问题
date: 2020-07-23 09:54:36
---
# Linux下排查磁盘文件占满

1.首先查看真实文件占用

```bash
# -s, --summarize 只分别计算当前路径下每个文件(夹)的总占用
# -x, --one-file-system  忽略处于不同文件系统上的目录
du -shx /xxx
```

2.查看对应目录下逻辑上的磁盘占用情况

```vim
df -h /xxx
```

3.查看被进程占用的文件，并kill对应的pid

```bash
# sort：-n 作为number排序， -k1 以第一列作为key排序，-t 可以指定分隔符
lsof -s|grep deleted|sort -n -k1
```

4.如果df与du仍然不一致，根据具体场景，umount掉不必要的**硬盘**后，再次使用du查看占用，之后`rm -rf`占用大的文件夹内容，再重新挂载。

