---
title: 关于 mkfs.ex4 的 inode
date: 2020-07-23 09:52:02
---

# 关于 mkfs.ex4 的 inode

最近在工作中遇到服务器磁盘格式化的问题，对相关查询命令进行了一点挖掘，命令如下：

```bash
mkfs.ext4 /dev/sda1
```

查询资料后发现，上述命令存在着优化空间，可以增大bytes per inode来节省部分磁盘空间，默认按照**每16k建立一个inode**来得到inode数量。 inode：用于存储文件的元数据，inode越多，磁盘可以存放的文件数量越多，但是过多的inode会占用磁盘空间（一个inode占用128/256字节），若磁盘上的文件都是大文件，显然16k会导致建立较多不必要的inode，从而浪费磁盘空间。

```bash
# -T 指定默认参数，其中largefile 每1M建立一个inode
# -n 为模拟运行，但不格式化
mkfs.ext4 -T largefile /dev/sdc1

# 查看每个inode占用的字节
dumpe2fs -h /dev/sda1 | grep "Inode size"
```

访问文件的实际流程： 访问\(`ls -i`\)文件（夹）名对应的inode号码-&gt;通过inode号码，获取inode信息-&gt;根据inode信息，找到文件数据所在的block，读取数据。

所以目录实际上只存储了名字跟inode号码，如果只有读权限，那么只能访问到目录内的名字，其余信息都存在inode里，而访问inode则需要执行权限（X），这也可以解释为什么目录下文件的权限为`-rwx`，由于目录只有`-r--`,从而导致有文件权限的用户无法访问目录下文件的原因。

由此可以看出，Linux的-rwx权限是通过inode来实现的。

