---
title: nethogs进程流量统计
date: 2021-05-06
---

## NetHogs

NetHogs 是一款可以按照进程分组来统计带宽占用的工具，CentOS 下需要先安装 epel 库，再执行 `yum -y install nethogs`。

### 1. 安装

如果是内网环境，则需要自行编译，先到 [Releases · raboof/nethogs](https://github.com/raboof/nethogs/releases) 下载发布包，之后系统安装以下编译软件：

```bash
# Yum-based distro's
yum install gcc-c++ libpcap-devel.x86_64 libpcap.x86_64 "ncurses*"

# Debian/Ubuntu
apt-get install build-essential libncurses5-dev libpcap-dev
```

解压发布包到任意位置，进入软件目录，构建后即可使用：

```bash
make
sudo ./src/nethogs
```

如果想要安装到系统中，则执行以下命令：

```bash
sudo make install
hash -r
sudo nethogs
```

### 2. 使用

查看帮助命令：

```bash
$ ./src/nethogs -h
usage: nethogs [-V] [-h] [-b] [-d seconds] [-v mode] [-c count] [-t] [-p] [-s] [-a] [-l] [-f filter] [-C][device [device [device ...]]]
                -V : prints version.
                -h : prints this help.
                -b : bughunt mode - implies tracemode.
                -d : delay for update refresh rate in seconds. default is 1.
                -v : view mode (0 = KB/s, 1 = total KB, 2 = total B, 3 = total MB, 4 = MB/s, 5 = GB/s). default is 0.
                -c : number of updates. default is 0 (unlimited).
                -t : tracemode.
                -p : sniff in promiscious mode (not recommended).
                -s : sort output by sent column.
                -l : display command line.
                -a : monitor all devices, even loopback/stopped ones.
                -C : capture TCP and UDP.
                -f : EXPERIMENTAL: specify string pcap filter (like tcpdump). This may be removed or changed in a future version.
                device : device(s) to monitor. default is all interfaces up and running excluding loopback

When nethogs is running, press:
 q: quit
 s: sort by SENT traffic
 r: sort by RECEIVE traffic
 l: display command line
 m: switch between total (KB, B, MB) and throughput (KB/s, MB/s, GB/s) mode
```

启动 nethogs 后输出如下：

```bash
NetHogs version 0.8.6

    PID USER     PROGRAM                        	DEV         SENT      RECEIVED      
  30885 hdfs     /usr/java/jdk1.8.0_181/bin/java	eth4       45.280     231.313 KB/sec
  31191 mapred   /usr/java/jdk1.8.0_181/bin/java	eth4       25.250      34.734 KB/sec
    600 spark    /usr/java/jdk1.8.0_181/bin/java	eth4        1.716       7.107 KB/sec
   4708 hue      python2.6                      	eth4       13.640       6.064 KB/sec
  25509 hdfs     /usr/java/jdk1.8.0_181/bin/java	eth4        1.044       1.092 KB/sec
  22785 hdfs     /usr/java/jdk1.8.0_181/bin/java	eth4        0.773       0.809 KB/sec
```

在此界面下，可以交互式的修改显示效果：

- s：按照 SENT 排序
- r：按照 RECEIVE 排序
- l：显示进程命令
- m：在总流量（KB、B、MB）以及吞吐量（KB/s、MB/s、GB/s）之间切换显示