---
title: Kafka 常用命令
date: 2020-07-22 10:57:03
permalink: /pages/2e9aa9/
---
# Kafka 常用命令

### 查询 Under-replicated 分区

```bash
export ZK="--zookeeper zk01,zk02,zk03:2181"
/opt/kafka/bin/kafka-topics.sh $ZK --describe --under-replicated-partitions
```

### 查询 Unavailable 分区

```bash
export ZK="--zookeeper zk01,zk02,zk03:2181"
/opt/kafka/bin/kafka-topics.sh $ZK --describe --unavailable-partitions
```

### 获取 Kaka offset \(Kerberos\)

```bash
export COMMAND_CONFIG="--command-config /path/to/group.properties"
kafka-consumer-groups.sh $COMMAND_CONFIG --bootstrap-server kafka01:9092 --describe --group TEST_TOPIC_GROUP

# group.properties 配置
security.protocol=SASL_PLAINTEXT
sasl.kerberos.service.name=kafka
```

### 重置 Kafka Offset (Kerberos)

```bash
export COMMAND_CONFIG="--command-config /path/to/group.properties"
kafka-consumer-groups $COMMAND_CONFIG --bootstrap-server kafka01:9092 --reset-offsets --to-latest --execute --topic CY_PLAYLOAD_JY_XDR --group TEST_TOPIC_GROUP
```

### Kafka Prefix Acl \(Kafka &gt; 2.0\)

```bash
kafka-acls.sh  --authorizer kafka.security.auth.SimpleAclAuthorizer \
               --authorizer-properties zookeeper.connect=zk01:2181 \
               --add --allow-principal User:'zxk' --operation READ \
               --topic TEST_TOPIC --group='spark-kafka-source-' \
               --resource-pattern-type prefixed
```

### 生产和消费

```bash
# 生产者产生资源
kafka-console-producer.sh --broker-list kafka01:9092 --topic TEST_TOPIC

# 消费者消费资源
kafka-console-consumer.sh --bootstrap-server kafka01:9092 --from-beginning --topic TEST_TOPIC
```

### 生产和消费测试

```bash
# 生产测试
kafka-producer-perf-test.sh --topic topic1 --num-records 10000000  --record-size 1024 --throughput -1 --producer-props bootstrap.servers=kafka1:6667

# 消费测试
## --num-fetch-threads 消费 Kafka topic 的线程
## --threads Consumer 的处理线程
kafka-consumer-perf-test.sh --group group1 --num-fetch-threads 1 --threads 10 --topic topic1 --messages 200000000 --broker-list kafka1:6667
```

