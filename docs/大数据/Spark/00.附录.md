---
title: 00. 附录
date: 2021-05-01
---

## 备用代码

1. 预估 dataframe 在内存中的大小

   ```scala
   val df: DataFrame = _
   df.cache.count
   val plan = df.queryExecution.logical
   val estimated: BigInt = spark
   .sessionState
   .executePlan(plan)
   .optimizedPlan
   .stats
   .sizeInBytes
   ```

2. 嵌套 json：

   ```scala
     val inputJson = """|{
                        | "name":"John",
                        | "age":30,
                        | "bike":{
                        |	"name":"Bajaj", "models":["Dominor", "Pulsar"]
                        |	},
                        | "cars": [
                        |   { "name":"Ford", "models":[ "Fiesta", "Focus", "Mustang" ] },
                        |   { "name":"BMW", "models":[ "320", "X3", "X5" ] },
                        |   { "name":"Fiat", "models":[ "500", "Panda" ] }
                        | ]
                        |}""".stripMargin('|')
   ```

3. 列转行：stack

## 常用链接

- [Spark SQL, Built-in Functions](https://spark.apache.org/docs/latest/api/sql/)

