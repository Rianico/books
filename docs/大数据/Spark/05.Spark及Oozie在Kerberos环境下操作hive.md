---
title: Spark+Oozie在Kerberos环境下操作hive
date: 2020-07-21 21:38:06
---



# Spark + Oozie 在Kerberos环境下操作hive

Kerberos 环境下，若 spark 要操作 hive，还需要在 oozie 中需要配置 `<credentials/>` 模块，并在 spark action 中指定该凭据，同时添加 `hive-site.xml` 文件，如下：

```markup
      <credentials>
         <credential name='credhive' type='hcat'>
            <property>
               <name>hcat.metastore.uri</name>
               <value>thrift://service1.com.cn:9083</value>
            </property>
            <property>
               <name>hcat.metastore.principal</name>
               <value>hive/service1.com.cn@XXX.CN</value>
            </property>
         </credential>
      </credentials>

      <action name='spark_action'  cred='credhive'>
              <spark xmlns="uri:oozie:spark-action:0.1">
              <job-xml>./lib/hive-site.xml</job-xml>
              .........
        </spark>
        <ok to="end"/>
        <error to="kill"/>
      </action>
```

其中 `hcat.metastore.uri` 的 `thrift`  地址可以在 `hive-site.xml` 中找到。  
由于 oozie 调度 spark 的时候，代理用户为 oozie，因此 hive 还需要在 `hadoop.proxyuser.hive.groups` 属性添加 `oozie` 用户组，允许 oozie 代理访问，否则因权限问题会报错。

