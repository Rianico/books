---
title: Spark 3.0 Monitoring with Prometheus 
date: 2021-05-06
---

## Spark 3.0 Monitoring with Prometheus 

[Spark 3.0 Monitoring with Prometheus](https://dzlab.github.io/bigdata/2020/07/03/spark3-monitoring-1/)

## Spark 3.0 Monitoring with SparkPlugins

https://github.com/cerndb/SparkPlugins

## spark.task.reaper.enabled	

这是 Spark 内部对 task 的一个监控，旨在发现异常 task 时将其 kill 掉并重新调度。

| Property Name                       | **Default** | **Meaning**                                                  | Since Version |
| :---------------------------------- | :---------: | ------------------------------------------------------------ | :-----------: |
| `spark.task.reaper.enabled`         |    false    | Enables monitoring of killed / interrupted tasks. When set to true, any task which is killed will be monitored by the executor until that task actually finishes executing. See the other `spark.task.reaper.*` configurations for details on how to control the exact behavior of this monitoring. When set to false (the default), task killing will use an older code path which lacks such monitoring. |     2.0.3     |
| `spark.task.reaper.pollingInterval` |     10s     | When `spark.task.reaper.enabled = true`, this setting controls the frequency at which executors will poll the status of killed tasks. If a killed task is still running when polled then a warning will be logged and, by default, a thread-dump of the task will be logged (this thread dump can be disabled via the `spark.task.reaper.threadDump` setting, which is documented below). |     2.0.3     |
| `spark.task.reaper.threadDump`      |    true     | When `spark.task.reaper.enabled = true`, this setting controls whether task thread dumps are logged during periodic polling of killed tasks. Set this to false to disable collection of thread dumps. |     2.0.3     |
| `spark.task.reaper.killTimeout`     |     -1      | When `spark.task.reaper.enabled = true`, this setting specifies a timeout after which the executor JVM will kill itself if a killed task has not stopped running. The default value, -1, disables this mechanism and prevents the executor from self-destructing. The purpose of this setting is to act as a safety-net to prevent runaway noncancellable tasks from rendering an executor unusable. |     2.0.3     |
