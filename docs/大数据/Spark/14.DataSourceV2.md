---
title: 14. DataSourceV2
date: 2021-08-13
---

## DataSourceV2

Spark DataSourceV2 是 Spark 对于存储层的一个抽象，属于 Spark2.3 一个最重要的特性之一，具有以下两点：

1. 通用性，支持读/写多种数据管理/存储系统
2. 灵活性，基于不同系统提供的能力，定制与优化读写方式

Data Source API V1

提供了简单易实现且适用于大部分场景的接口：

```scala
trait RelationProvider {
  def createRelation(sqlContext: SQLContext, parameters: Map[String, String]): BaseRelation
}

abstract class BaseRelation {
  def sizeInBytes: Long = sqlContext.conf.defaultSizeInBytes
}

trait TableScan {
  def buildScan(): RDD[Row]
}

trait InsertableRelation {
  def insert(data: DataFrame, overwrite: Boolean): Unit
}
...
```

但存在以下缺点：

1. 扩展性差，每当需要实现一种场景（如新的 Push Down）就需要新实现一个类，最后需要维护一大堆类
2. 耦合了其他 API，如 SQLContext、RDD、DataFrame
3. 难以

http://blog.madhukaraphatak.com/spark-datasource-v2-part-1/