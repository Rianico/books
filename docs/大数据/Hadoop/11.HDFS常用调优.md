---
title: 11.HDFS 常用调优
date: 2021-05-23
---

## HDFS 常用调优

1. 适当提高 block size，减少大文件的 block 个数
2. 配置 HDFS 机架感知，一来可以提高容错性，二来可以实现短路读：
   - *dfs.client.read.shortcircuit*，true
   - *dfs.domain.socket.path*，`/var/lib/hadoop-hdfs/dn_socket`
   - *dfs.client.read.shortcircuit.streams.cache.size*，指定 DFSClient 端缓存最近打开 fd 的数量
   - 同时还需要在本地安装 Hadoop 的 lib 库，详见 [Native Libraries Guide](https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/NativeLibraries.html)
3. 配置 edits log 到固态盘上，高版本还可以开启 cache，加快 edits log 拉取速度：
   - *dfs.ha.tail-edits.in-progress*，true，默认为 false
4. 使用 HAR 打包小文件，减少小文件数量。
5. 开启慢节点感知（Hadoop 2.9.0）：
   - *dfs.datanode.peer.stats.enabled*
   - *dfs.datanode.fileio.profiling.sampling.percentage*
   - *dfs.datanode.outliers.report.interval*
6. 避免从较长时间为返回心跳信息的节点进行读写：
   - *dfs.namenode.avoid.read.stale.datanode*
   - *dfs.namenode.avoid.read.stale.datanode*
7. 使用基于 JNI 的实现进行组查找：
   - *hadoop.security.group.mapping=org.apache.hadoop.security.JniBasedUnixGroupsMappingWithFallback*

